<!DOCTYPE html>
<!-- Generated by Cython 0.20.1post0 (Debian 0.20.1+git90-g0e6e38e-1ubuntu2) on Tue Sep  6 17:42:01 2016 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display != 'block') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.20.1post0 (Debian 0.20.1+git90-g0e6e38e-1ubuntu2) on Tue Sep  6 17:42:01 2016
<p>Raw output: <a href="word2vec_inner.c">word2vec_inner.c</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: #!/usr/bin/env cython</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>  __pyx_t_7 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_7) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: # cython: boundscheck=False</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: # cython: wraparound=False</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line4")'> 4: # cython: cdivision=True</pre>
<pre id='line4' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: # coding: utf-8</pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: #</pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: # Copyright (C) 2013 Radim Rehurek &lt;me@radimrehurek.com&gt;</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: # Licensed under the GNU LGPL v2.1 - http://www.gnu.org/licenses/lgpl.html</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: </pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: import cython</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line11")'> 11: import numpy as np</pre>
<pre id='line11' class='code' style='background-color: #FFFF8d'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: cimport numpy as np</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: </pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: from libc.math cimport exp</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15: from libc.math cimport log</pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: from libc.string cimport memset, strcpy, strcat</pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17: from libc.stdlib cimport malloc, free</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: from libc.stdio cimport printf</pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19: from libc.stdio cimport FILE, fopen, fwrite, fscanf, fclose, fprintf</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20: cimport libc.string</pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21: </pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22: # scipy &lt;= 0.15</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: try:</pre>
<pre id='line23' class='code' style='background-color: #FFFFff'>  {
    /*try:*/ {
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line24")'> 24:     from scipy.linalg.blas import fblas</pre>
<pre id='line24' class='code' style='background-color: #FFFF4b'>      __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L2_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_fblas);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_fblas);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_fblas);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_linalg_blas, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L2_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_5, __pyx_n_s_fblas);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L2_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_fblas, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L2_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L9_try_end;
    __pyx_L2_error:;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line25")'> 25: except ImportError:</pre>
<pre id='line25' class='code' style='background-color: #FFFF86'>    __pyx_t_6 = <span class='py_c_api'>PyErr_ExceptionMatches</span>(__pyx_builtin_ImportError);
    if (__pyx_t_6) {
      <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (<span class='pyx_c_api'>__Pyx_GetException</span>(&amp;__pyx_t_5, &amp;__pyx_t_1, &amp;__pyx_t_7) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L4_except_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line26")'> 26:     # in scipy &gt; 0.15, fblas function has been removed</pre>
<pre id='line26' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line27")'> 27:     import scipy.linalg.blas as fblas</pre>
<pre id='line27' class='code' style='background-color: #FFFF4d'>      __pyx_t_8 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L4_except_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s__17);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 0, __pyx_n_s__17);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s__17);
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_linalg_blas, __pyx_t_8, -1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L4_except_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_fblas, __pyx_t_9) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L4_except_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L3_exception_handled;
    }
    goto __pyx_L4_except_error;
    __pyx_L4_except_error:;
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_2);
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_4);
    <span class='pyx_c_api'>__Pyx_ExceptionReset</span>(__pyx_t_2, __pyx_t_3, __pyx_t_4);
    goto __pyx_L1_error;
    __pyx_L3_exception_handled:;
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_2);
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_4);
    <span class='pyx_c_api'>__Pyx_ExceptionReset</span>(__pyx_t_2, __pyx_t_3, __pyx_t_4);
    __pyx_L9_try_end:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28: </pre>
<pre id='line28' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line29")'> 29: REAL = np.float32</pre>
<pre id='line29' class='code' style='background-color: #FFFF79'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_REAL, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30: </pre>
<pre id='line30' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31: DEF MAX_SENTENCE_LEN = 10000</pre>
<pre id='line31' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32: </pre>
<pre id='line32' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line33")'> 33: cdef scopy_ptr scopy=&lt;scopy_ptr&gt;PyCObject_AsVoidPtr(fblas.scopy._cpointer)  # y = x</pre>
<pre id='line33' class='code' style='background-color: #FFFF86'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_fblas);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_scopy);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_cpointer);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_14word2vec_inner_scopy = ((__pyx_t_14word2vec_inner_scopy_ptr)PyCObject_AsVoidPtr(__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line34")'> 34: cdef saxpy_ptr saxpy=&lt;saxpy_ptr&gt;PyCObject_AsVoidPtr(fblas.saxpy._cpointer)  # y += alpha * x</pre>
<pre id='line34' class='code' style='background-color: #FFFF86'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_fblas);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_saxpy);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_cpointer);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_14word2vec_inner_saxpy = ((__pyx_t_14word2vec_inner_saxpy_ptr)PyCObject_AsVoidPtr(__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line35")'> 35: cdef sdot_ptr sdot=&lt;sdot_ptr&gt;PyCObject_AsVoidPtr(fblas.sdot._cpointer)  # float = dot(x, y)</pre>
<pre id='line35' class='code' style='background-color: #FFFF86'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_fblas);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sdot);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_cpointer);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_14word2vec_inner_sdot = ((__pyx_t_14word2vec_inner_sdot_ptr)PyCObject_AsVoidPtr(__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line36")'> 36: cdef dsdot_ptr dsdot=&lt;dsdot_ptr&gt;PyCObject_AsVoidPtr(fblas.sdot._cpointer)  # double = dot(x, y)</pre>
<pre id='line36' class='code' style='background-color: #FFFF86'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_fblas);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sdot);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_cpointer);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_14word2vec_inner_dsdot = ((__pyx_t_14word2vec_inner_dsdot_ptr)PyCObject_AsVoidPtr(__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line37")'> 37: cdef snrm2_ptr snrm2=&lt;snrm2_ptr&gt;PyCObject_AsVoidPtr(fblas.snrm2._cpointer)  # sqrt(x^2)</pre>
<pre id='line37' class='code' style='background-color: #FFFF86'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_fblas);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_snrm2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_cpointer);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_14word2vec_inner_snrm2 = ((__pyx_t_14word2vec_inner_snrm2_ptr)PyCObject_AsVoidPtr(__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line38")'> 38: cdef sscal_ptr sscal=&lt;sscal_ptr&gt;PyCObject_AsVoidPtr(fblas.sscal._cpointer) # x = alpha * x</pre>
<pre id='line38' class='code' style='background-color: #FFFF86'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_fblas);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sscal);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_cpointer);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_14word2vec_inner_sscal = ((__pyx_t_14word2vec_inner_sscal_ptr)PyCObject_AsVoidPtr(__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line39")'> 39: cdef sgemv_ptr sgemv=&lt;sgemv_ptr&gt;PyCObject_AsVoidPtr(fblas.sgemv._cpointer) # float y= alpha * A * x + beta * y</pre>
<pre id='line39' class='code' style='background-color: #FFFF86'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_fblas);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sgemv);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_cpointer);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_14word2vec_inner_sgemv = ((__pyx_t_14word2vec_inner_sgemv_ptr)PyCObject_AsVoidPtr(__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line40")'> 40: cdef sgemm_ptr sgemm=&lt;sgemm_ptr&gt;PyCObject_AsVoidPtr(fblas.sgemm._cpointer) # float y= alpha * A * B + beta * C</pre>
<pre id='line40' class='code' style='background-color: #FFFF86'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_fblas);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sgemm);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_cpointer);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_14word2vec_inner_sgemm = ((__pyx_t_14word2vec_inner_sgemm_ptr)PyCObject_AsVoidPtr(__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41: </pre>
<pre id='line41' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42: DEF EXP_TABLE_SIZE = 1000</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line43")'> 43: DEF MAX_EXP = 6</pre>
<pre id='line43' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44: </pre>
<pre id='line44' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45: cdef REAL_t[EXP_TABLE_SIZE] EXP_TABLE</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46: cdef REAL_t[EXP_TABLE_SIZE] LOG_TABLE</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47: </pre>
<pre id='line47' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48: cdef int ONE = 1</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_ONE = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49: cdef REAL_t ONEF = &lt;REAL_t&gt;1.0</pre>
<pre id='line49' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_ONEF = ((__pyx_t_14word2vec_inner_REAL_t)1.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50: cdef REAL_t ONEF_M = &lt;REAL_t&gt; -1.0</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_ONEF_M = ((__pyx_t_14word2vec_inner_REAL_t)-1.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51: cdef REAL_t ZEROF = &lt;REAL_t&gt;0.0</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_ZEROF = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52: </pre>
<pre id='line52' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53: # for when fblas.sdot returns a double</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54: cdef REAL_t our_dot_double(const int *N, const float *X, const int *incX, const float *Y, const int *incY) nogil:</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'>static __pyx_t_14word2vec_inner_REAL_t __pyx_f_14word2vec_inner_our_dot_double(int const *__pyx_v_N, float const *__pyx_v_X, int const *__pyx_v_incX, float const *__pyx_v_Y, int const *__pyx_v_incY) {
  __pyx_t_14word2vec_inner_REAL_t __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55:     return &lt;REAL_t&gt;dsdot(N, X, incX, Y, incY)</pre>
<pre id='line55' class='code' style='background-color: #FFFFff'>  __pyx_r = ((__pyx_t_14word2vec_inner_REAL_t)__pyx_v_14word2vec_inner_dsdot(__pyx_v_N, __pyx_v_X, __pyx_v_incX, __pyx_v_Y, __pyx_v_incY));
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line56")'> 56: </pre>
<pre id='line56' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line57")'> 57: # for when fblas.sdot returns a float</pre>
<pre id='line57' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58: cdef REAL_t our_dot_float(const int *N, const float *X, const int *incX, const float *Y, const int *incY) nogil:</pre>
<pre id='line58' class='code' style='background-color: #FFFFff'>static __pyx_t_14word2vec_inner_REAL_t __pyx_f_14word2vec_inner_our_dot_float(int const *__pyx_v_N, float const *__pyx_v_X, int const *__pyx_v_incX, float const *__pyx_v_Y, int const *__pyx_v_incY) {
  __pyx_t_14word2vec_inner_REAL_t __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line59")'> 59:     return &lt;REAL_t&gt;sdot(N, X, incX, Y, incY)</pre>
<pre id='line59' class='code' style='background-color: #FFFFff'>  __pyx_r = ((__pyx_t_14word2vec_inner_REAL_t)__pyx_v_14word2vec_inner_sdot(__pyx_v_N, __pyx_v_X, __pyx_v_incX, __pyx_v_Y, __pyx_v_incY));
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60: </pre>
<pre id='line60' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line61")'> 61: # for when no blas available</pre>
<pre id='line61' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line62")'> 62: cdef REAL_t our_dot_noblas(const int *N, const float *X, const int *incX, const float *Y, const int *incY) nogil:</pre>
<pre id='line62' class='code' style='background-color: #FFFFff'>static __pyx_t_14word2vec_inner_REAL_t __pyx_f_14word2vec_inner_our_dot_noblas(int const *__pyx_v_N, float const *__pyx_v_X, CYTHON_UNUSED int const *__pyx_v_incX, float const *__pyx_v_Y, CYTHON_UNUSED int const *__pyx_v_incY) {
  int __pyx_v_i;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_a;
  __pyx_t_14word2vec_inner_REAL_t __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line63")'> 63:     # not a true full dot()-implementation: just enough for our cases</pre>
<pre id='line63' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64:     cdef int i</pre>
<pre id='line64' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line65")'> 65:     cdef REAL_t a</pre>
<pre id='line65' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line66")'> 66:     a = &lt;REAL_t&gt;0.0</pre>
<pre id='line66' class='code' style='background-color: #FFFFff'>  __pyx_v_a = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67:     for i from 0 &lt;= i &lt; N[0] by 1:</pre>
<pre id='line67' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_N[0]);
  for (__pyx_v_i = 0; __pyx_v_i &lt; __pyx_t_1; __pyx_v_i+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68:         a += X[i] * Y[i]</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'>    __pyx_v_a = (__pyx_v_a + ((__pyx_v_X[__pyx_v_i]) * (__pyx_v_Y[__pyx_v_i])));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69:     return a</pre>
<pre id='line69' class='code' style='background-color: #FFFFff'>  __pyx_r = __pyx_v_a;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line70")'> 70: </pre>
<pre id='line70' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71: # for when no blas available</pre>
<pre id='line71' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line72")'> 72: cdef void our_saxpy_noblas(const int *N, const float *alpha, const float *X, const int *incX, float *Y, const int *incY) nogil:</pre>
<pre id='line72' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_our_saxpy_noblas(int const *__pyx_v_N, float const *__pyx_v_alpha, float const *__pyx_v_X, int const *__pyx_v_incX, float *__pyx_v_Y, int const *__pyx_v_incY) {
  int __pyx_v_i;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line73")'> 73:     cdef int i</pre>
<pre id='line73' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74:     for i from 0 &lt;= i &lt; N[0] by 1:</pre>
<pre id='line74' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_N[0]);
  for (__pyx_v_i = 0; __pyx_v_i &lt; __pyx_t_1; __pyx_v_i+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line75")'> 75:         Y[i * (incY[0])] = (alpha[0]) * X[i * (incX[0])] + Y[i * (incY[0])]</pre>
<pre id='line75' class='code' style='background-color: #FFFFff'>    (__pyx_v_Y[(__pyx_v_i * (__pyx_v_incY[0]))]) = (((__pyx_v_alpha[0]) * (__pyx_v_X[(__pyx_v_i * (__pyx_v_incX[0]))])) + (__pyx_v_Y[(__pyx_v_i * (__pyx_v_incY[0]))]));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76: </pre>
<pre id='line76' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77: cdef void matrix_transpose(const int *M, const int *N, float *X, float *Y, const int *inc) nogil:</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_matrix_transpose(int const *__pyx_v_M, int const *__pyx_v_N, float *__pyx_v_X, float *__pyx_v_Y, int const *__pyx_v_inc) {
  int __pyx_v_i;
  int __pyx_v_j;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78:     cdef int i,j</pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79:     for i from 0 &lt;= i &lt; M[0] by 1:</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_M[0]);
  for (__pyx_v_i = 0; __pyx_v_i &lt; __pyx_t_1; __pyx_v_i+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80:         for j from 0 &lt;= j &lt; N[0] by 1:</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = (__pyx_v_N[0]);
    for (__pyx_v_j = 0; __pyx_v_j &lt; __pyx_t_2; __pyx_v_j+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81:             Y[j * (inc[0]) * (M[0]) + i * (inc[0])] = X[i * (inc[0]) * (M[0]) + j * (inc[0])]</pre>
<pre id='line81' class='code' style='background-color: #FFFFff'>      (__pyx_v_Y[(((__pyx_v_j * (__pyx_v_inc[0])) * (__pyx_v_M[0])) + (__pyx_v_i * (__pyx_v_inc[0])))]) = (__pyx_v_X[(((__pyx_v_i * (__pyx_v_inc[0])) * (__pyx_v_M[0])) + (__pyx_v_j * (__pyx_v_inc[0])))]);
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82: </pre>
<pre id='line82' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83: cdef void our_multi_mat_vec(const char *T, const int *M, const int *N, const float *alpha, const float *A, const int *LDA, const float *X, const int *incX, const float *beta, const float *Y, const int *incY) nogil:</pre>
<pre id='line83' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_our_multi_mat_vec(char const *__pyx_v_T, int const *__pyx_v_M, int const *__pyx_v_N, float const *__pyx_v_alpha, float const *__pyx_v_A, int const *__pyx_v_LDA, float const *__pyx_v_X, int const *__pyx_v_incX, float const *__pyx_v_beta, float const *__pyx_v_Y, int const *__pyx_v_incY) {
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84:     sgemv(T,M,N,alpha,A,LDA,X,incX,beta,Y,incY)</pre>
<pre id='line84' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_sgemv(__pyx_v_T, __pyx_v_M, __pyx_v_N, __pyx_v_alpha, __pyx_v_A, __pyx_v_LDA, __pyx_v_X, __pyx_v_incX, __pyx_v_beta, __pyx_v_Y, __pyx_v_incY);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85: </pre>
<pre id='line85' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86: </pre>
<pre id='line86' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87: cdef void our_multi_mat_mat(const char *T1, const char *T2, const int *M, const int *N, const int *K, const float *alpha, const float *A, const int *LDA, const float *B, const int *LDB, const float *beta, const float *C, const int *LDC) nogil:</pre>
<pre id='line87' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_our_multi_mat_mat(char const *__pyx_v_T1, char const *__pyx_v_T2, int const *__pyx_v_M, int const *__pyx_v_N, int const *__pyx_v_K, float const *__pyx_v_alpha, float const *__pyx_v_A, int const *__pyx_v_LDA, float const *__pyx_v_B, int const *__pyx_v_LDB, float const *__pyx_v_beta, float const *__pyx_v_C, int const *__pyx_v_LDC) {
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88:     sgemm(T1,T2, M, N, K, alpha, A, LDA, B, LDB, beta, C, LDC)</pre>
<pre id='line88' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_sgemm(__pyx_v_T1, __pyx_v_T2, __pyx_v_M, __pyx_v_N, __pyx_v_K, __pyx_v_alpha, __pyx_v_A, __pyx_v_LDA, __pyx_v_B, __pyx_v_LDB, __pyx_v_beta, __pyx_v_C, __pyx_v_LDC);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89: </pre>
<pre id='line89' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90: </pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91: cdef void hTanh(const int N, const REAL_t *V1, REAL_t *V2) nogil:</pre>
<pre id='line91' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_hTanh(int const __pyx_v_N, __pyx_t_14word2vec_inner_REAL_t const *__pyx_v_V1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_V2) {
  int __pyx_v_i;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92:     cdef int i</pre>
<pre id='line92' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93: </pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94:     for i from 0 &lt;=i &lt;N by 1:</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_N;
  for (__pyx_v_i = 0; __pyx_v_i &lt; __pyx_t_1; __pyx_v_i+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95:         if V1[i]&lt;-1.0:</pre>
<pre id='line95' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = (((__pyx_v_V1[__pyx_v_i]) &lt; -1.0) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96:             V2[i]=ONEF_M</pre>
<pre id='line96' class='code' style='background-color: #FFFFff'>      (__pyx_v_V2[__pyx_v_i]) = __pyx_v_14word2vec_inner_ONEF_M;
      goto __pyx_L5;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line97")'> 97:         elif V1[i]&gt;1.0:</pre>
<pre id='line97' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = (((__pyx_v_V1[__pyx_v_i]) &gt; 1.0) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line98")'> 98:             V2[i]=ONEF</pre>
<pre id='line98' class='code' style='background-color: #FFFFff'>      (__pyx_v_V2[__pyx_v_i]) = __pyx_v_14word2vec_inner_ONEF;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99:         else:</pre>
<pre id='line99' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line100")'> 100:             V2[i]=V1[i]</pre>
<pre id='line100' class='code' style='background-color: #FFFFff'>      (__pyx_v_V2[__pyx_v_i]) = (__pyx_v_V1[__pyx_v_i]);
    }
    __pyx_L5:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101: </pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line102")'> 102: cdef void init_mat(const int M, const int N, REAL_t *A, const REAL_t value) nogil:</pre>
<pre id='line102' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_init_mat(int const __pyx_v_M, int const __pyx_v_N, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_A, __pyx_t_14word2vec_inner_REAL_t const __pyx_v_value) {
  int __pyx_v_i;
  int __pyx_v_j;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line103")'> 103:     cdef int i,j</pre>
<pre id='line103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104:     for i from 0 &lt;=i &lt; M by 1:</pre>
<pre id='line104' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_M;
  for (__pyx_v_i = 0; __pyx_v_i &lt; __pyx_t_1; __pyx_v_i+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line105")'> 105:         for j from 0 &lt;=j &lt; N by 1:</pre>
<pre id='line105' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = __pyx_v_N;
    for (__pyx_v_j = 0; __pyx_v_j &lt; __pyx_t_2; __pyx_v_j+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line106")'> 106:             A[i+j*N]=value</pre>
<pre id='line106' class='code' style='background-color: #FFFFff'>      (__pyx_v_A[(__pyx_v_i + (__pyx_v_j * __pyx_v_N))]) = __pyx_v_value;
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line107")'> 107:     #free(A)</pre>
<pre id='line107' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line108")'> 108: </pre>
<pre id='line108' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109: cdef void fast_sentence_sg_hs(</pre>
<pre id='line109' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_fast_sentence_sg_hs(__pyx_t_5numpy_uint32_t const *__pyx_v_word_point, __pyx_t_5numpy_uint8_t const *__pyx_v_word_code, int const __pyx_v_codelen, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1, int const __pyx_v_size, __pyx_t_5numpy_uint32_t const __pyx_v_word2_index, __pyx_t_14word2vec_inner_REAL_t const __pyx_v_alpha, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks) {
  PY_LONG_LONG __pyx_v_b;
  PY_LONG_LONG __pyx_v_row1;
  PY_LONG_LONG __pyx_v_row2;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_f;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_g;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line110")'> 110:     const np.uint32_t *word_point, const np.uint8_t *word_code, const int codelen,</pre>
<pre id='line110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line111")'> 111:     REAL_t *syn0, REAL_t *syn1, const int size,</pre>
<pre id='line111' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line112")'> 112:     const np.uint32_t word2_index, const REAL_t alpha, REAL_t *work, REAL_t *word_locks) nogil:</pre>
<pre id='line112' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line113")'> 113: </pre>
<pre id='line113' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line114")'> 114:     cdef long long a, b</pre>
<pre id='line114' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line115")'> 115:     cdef long long row1 = word2_index * size, row2</pre>
<pre id='line115' class='code' style='background-color: #FFFFff'>  __pyx_v_row1 = (__pyx_v_word2_index * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116:     cdef REAL_t f, g</pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line117")'> 117: </pre>
<pre id='line117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line118")'> 118:     memset(work, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line118' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_work, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line119")'> 119:     for b in range(codelen):</pre>
<pre id='line119' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_codelen;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_b = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line120")'> 120:         row2 = word_point[b] * size</pre>
<pre id='line120' class='code' style='background-color: #FFFFff'>    __pyx_v_row2 = ((__pyx_v_word_point[__pyx_v_b]) * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121:         f = our_dot(&amp;size, &amp;syn0[row1], &amp;ONE, &amp;syn1[row2], &amp;ONE)</pre>
<pre id='line121' class='code' style='background-color: #FFFFff'>    __pyx_v_f = __pyx_v_14word2vec_inner_our_dot((&amp;__pyx_v_size), (&amp;(__pyx_v_syn0[__pyx_v_row1])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122:         if f &lt;= -MAX_EXP or f &gt;= MAX_EXP:</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_f &lt;= -6.0) != 0);
    if (!__pyx_t_3) {
      __pyx_t_4 = ((__pyx_v_f &gt;= 6.0) != 0);
      __pyx_t_5 = __pyx_t_4;
    } else {
      __pyx_t_5 = __pyx_t_3;
    }
    if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123:             continue</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line124")'> 124:         f = EXP_TABLE[&lt;int&gt;((f + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))]</pre>
<pre id='line124' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_14word2vec_inner_EXP_TABLE[((int)((__pyx_v_f + 6.0) * 83.0))]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125:         g = (1 - word_code[b] - f) * alpha</pre>
<pre id='line125' class='code' style='background-color: #FFFFff'>    __pyx_v_g = (((1 - (__pyx_v_word_code[__pyx_v_b])) - __pyx_v_f) * __pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126:         our_saxpy(&amp;size, &amp;g, &amp;syn1[row2], &amp;ONE, work, &amp;ONE)</pre>
<pre id='line126' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line127")'> 127:         our_saxpy(&amp;size, &amp;g, &amp;syn0[row1], &amp;ONE, &amp;syn1[row2], &amp;ONE)</pre>
<pre id='line127' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), (&amp;(__pyx_v_syn0[__pyx_v_row1])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
    __pyx_L3_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line128")'> 128:     our_saxpy(&amp;size, &amp;word_locks[word2_index], work, &amp;ONE, &amp;syn0[row1], &amp;ONE)</pre>
<pre id='line128' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;(__pyx_v_word_locks[__pyx_v_word2_index])), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn0[__pyx_v_row1])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129: </pre>
<pre id='line129' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line130")'> 130: </pre>
<pre id='line130' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line131")'> 131: # to support random draws from negative-sampling cum_table</pre>
<pre id='line131' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132: cdef inline unsigned long long bisect_left(np.uint32_t *a, unsigned long long x, unsigned long long lo, unsigned long long hi) nogil:</pre>
<pre id='line132' class='code' style='background-color: #FFFFff'>static CYTHON_INLINE unsigned PY_LONG_LONG __pyx_f_14word2vec_inner_bisect_left(__pyx_t_5numpy_uint32_t *__pyx_v_a, unsigned PY_LONG_LONG __pyx_v_x, unsigned PY_LONG_LONG __pyx_v_lo, unsigned PY_LONG_LONG __pyx_v_hi) {
  unsigned PY_LONG_LONG __pyx_v_mid;
  unsigned PY_LONG_LONG __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line133")'> 133:     cdef unsigned long long mid</pre>
<pre id='line133' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line134")'> 134:     while hi &gt; lo:</pre>
<pre id='line134' class='code' style='background-color: #FFFFff'>  while (1) {
    __pyx_t_1 = ((__pyx_v_hi &gt; __pyx_v_lo) != 0);
    if (!__pyx_t_1) break;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line135")'> 135:         mid = (lo + hi) &gt;&gt; 1</pre>
<pre id='line135' class='code' style='background-color: #FFFFff'>    __pyx_v_mid = ((__pyx_v_lo + __pyx_v_hi) &gt;&gt; 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line136")'> 136:         if a[mid] &gt;= x:</pre>
<pre id='line136' class='code' style='background-color: #FFFFff'>    __pyx_t_1 = (((__pyx_v_a[__pyx_v_mid]) &gt;= __pyx_v_x) != 0);
    if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137:             hi = mid</pre>
<pre id='line137' class='code' style='background-color: #FFFFff'>      __pyx_v_hi = __pyx_v_mid;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line138")'> 138:         else:</pre>
<pre id='line138' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line139")'> 139:             lo = mid + 1</pre>
<pre id='line139' class='code' style='background-color: #FFFFff'>      __pyx_v_lo = (__pyx_v_mid + 1);
    }
    __pyx_L5:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140:     return lo</pre>
<pre id='line140' class='code' style='background-color: #FFFFff'>  __pyx_r = __pyx_v_lo;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line141")'> 141: </pre>
<pre id='line141' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line142")'> 142: # this quick &amp; dirty RNG apparently matches Java's (non-Secure)Random</pre>
<pre id='line142' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143: # note this function side-effects next_random to set up the next number</pre>
<pre id='line143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144: cdef inline unsigned long long random_int32(unsigned long long *next_random) nogil:</pre>
<pre id='line144' class='code' style='background-color: #FFFFff'>static CYTHON_INLINE unsigned PY_LONG_LONG __pyx_f_14word2vec_inner_random_int32(unsigned PY_LONG_LONG *__pyx_v_next_random) {
  unsigned PY_LONG_LONG __pyx_v_this_random;
  unsigned PY_LONG_LONG __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line145")'> 145:     cdef unsigned long long this_random = next_random[0] &gt;&gt; 16</pre>
<pre id='line145' class='code' style='background-color: #FFFFff'>  __pyx_v_this_random = ((__pyx_v_next_random[0]) &gt;&gt; 16);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146:     next_random[0] = (next_random[0] * &lt;unsigned long long&gt;25214903917ULL + 11) &amp; 281474976710655ULL</pre>
<pre id='line146' class='code' style='background-color: #FFFFff'>  (__pyx_v_next_random[0]) = ((((__pyx_v_next_random[0]) * ((unsigned PY_LONG_LONG)25214903917ULL)) + 11) &amp; 281474976710655ULL);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line147")'> 147:     return this_random</pre>
<pre id='line147' class='code' style='background-color: #FFFFff'>  __pyx_r = __pyx_v_this_random;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148: </pre>
<pre id='line148' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line149")'> 149: cdef unsigned long long fast_sentence_sg_neg(</pre>
<pre id='line149' class='code' style='background-color: #FFFFff'>static unsigned PY_LONG_LONG __pyx_f_14word2vec_inner_fast_sentence_sg_neg(int const __pyx_v_negative, __pyx_t_5numpy_uint32_t *__pyx_v_cum_table, unsigned PY_LONG_LONG __pyx_v_cum_table_len, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1neg, int const __pyx_v_size, __pyx_t_5numpy_uint32_t const __pyx_v_word_index, __pyx_t_5numpy_uint32_t const __pyx_v_word2_index, __pyx_t_14word2vec_inner_REAL_t const __pyx_v_alpha, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work, unsigned PY_LONG_LONG __pyx_v_next_random, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks) {
  PY_LONG_LONG __pyx_v_row1;
  PY_LONG_LONG __pyx_v_row2;
  unsigned PY_LONG_LONG __pyx_v_modulo;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_f;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_g;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_label;
  __pyx_t_5numpy_uint32_t __pyx_v_target_index;
  int __pyx_v_d;
  unsigned PY_LONG_LONG __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line150")'> 150:     const int negative, np.uint32_t *cum_table, unsigned long long cum_table_len,</pre>
<pre id='line150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line151")'> 151:     REAL_t *syn0, REAL_t *syn1neg, const int size, const np.uint32_t word_index,</pre>
<pre id='line151' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line152")'> 152:     const np.uint32_t word2_index, const REAL_t alpha, REAL_t *work,</pre>
<pre id='line152' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line153")'> 153:     unsigned long long next_random, REAL_t *word_locks) nogil:</pre>
<pre id='line153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line154")'> 154: </pre>
<pre id='line154' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line155")'> 155:     cdef long long a</pre>
<pre id='line155' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line156")'> 156:     cdef long long row1 = word2_index * size, row2</pre>
<pre id='line156' class='code' style='background-color: #FFFFff'>  __pyx_v_row1 = (__pyx_v_word2_index * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line157")'> 157:     cdef unsigned long long modulo = 281474976710655ULL</pre>
<pre id='line157' class='code' style='background-color: #FFFFff'>  __pyx_v_modulo = 281474976710655ULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line158")'> 158:     cdef REAL_t f, g, label</pre>
<pre id='line158' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line159")'> 159:     cdef np.uint32_t target_index</pre>
<pre id='line159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160:     cdef int d</pre>
<pre id='line160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line161")'> 161: </pre>
<pre id='line161' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162:     memset(work, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line162' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_work, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163: </pre>
<pre id='line163' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164:     for d in range(negative+1):</pre>
<pre id='line164' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_negative + 1);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_d = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line165")'> 165:         if d == 0:</pre>
<pre id='line165' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_d == 0) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166:             target_index = word_index</pre>
<pre id='line166' class='code' style='background-color: #FFFFff'>      __pyx_v_target_index = __pyx_v_word_index;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line167")'> 167:             label = ONEF</pre>
<pre id='line167' class='code' style='background-color: #FFFFff'>      __pyx_v_label = __pyx_v_14word2vec_inner_ONEF;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line168")'> 168:         else:</pre>
<pre id='line168' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line169")'> 169:             target_index = bisect_left(cum_table, (next_random &gt;&gt; 16) % cum_table[cum_table_len-1], 0, cum_table_len)</pre>
<pre id='line169' class='code' style='background-color: #FFFFff'>      __pyx_v_target_index = __pyx_f_14word2vec_inner_bisect_left(__pyx_v_cum_table, ((__pyx_v_next_random &gt;&gt; 16) % (__pyx_v_cum_table[(__pyx_v_cum_table_len - 1)])), 0, __pyx_v_cum_table_len);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line170")'> 170:             next_random = (next_random * &lt;unsigned long long&gt;25214903917ULL + 11) &amp; modulo</pre>
<pre id='line170' class='code' style='background-color: #FFFFff'>      __pyx_v_next_random = (((__pyx_v_next_random * ((unsigned PY_LONG_LONG)25214903917ULL)) + 11) &amp; __pyx_v_modulo);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171:             if target_index == word_index:</pre>
<pre id='line171' class='code' style='background-color: #FFFFff'>      __pyx_t_3 = ((__pyx_v_target_index == __pyx_v_word_index) != 0);
      if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line172")'> 172:                 continue</pre>
<pre id='line172' class='code' style='background-color: #FFFFff'>        goto __pyx_L3_continue;
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173:             label = &lt;REAL_t&gt;0.0</pre>
<pre id='line173' class='code' style='background-color: #FFFFff'>      __pyx_v_label = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
    }
    __pyx_L5:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174: </pre>
<pre id='line174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line175")'> 175:         row2 = target_index * size</pre>
<pre id='line175' class='code' style='background-color: #FFFFff'>    __pyx_v_row2 = (__pyx_v_target_index * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line176")'> 176:         f = our_dot(&amp;size, &amp;syn0[row1], &amp;ONE, &amp;syn1neg[row2], &amp;ONE)</pre>
<pre id='line176' class='code' style='background-color: #FFFFff'>    __pyx_v_f = __pyx_v_14word2vec_inner_our_dot((&amp;__pyx_v_size), (&amp;(__pyx_v_syn0[__pyx_v_row1])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1neg[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177:         if f &lt;= -MAX_EXP or f &gt;= MAX_EXP:</pre>
<pre id='line177' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_f &lt;= -6.0) != 0);
    if (!__pyx_t_3) {
      __pyx_t_4 = ((__pyx_v_f &gt;= 6.0) != 0);
      __pyx_t_5 = __pyx_t_4;
    } else {
      __pyx_t_5 = __pyx_t_3;
    }
    if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:             continue</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line179")'> 179:         f = EXP_TABLE[&lt;int&gt;((f + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))]</pre>
<pre id='line179' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_14word2vec_inner_EXP_TABLE[((int)((__pyx_v_f + 6.0) * 83.0))]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line180")'> 180:         g = (label - f) * alpha</pre>
<pre id='line180' class='code' style='background-color: #FFFFff'>    __pyx_v_g = ((__pyx_v_label - __pyx_v_f) * __pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line181")'> 181:         our_saxpy(&amp;size, &amp;g, &amp;syn1neg[row2], &amp;ONE, work, &amp;ONE)</pre>
<pre id='line181' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), (&amp;(__pyx_v_syn1neg[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line182")'> 182:         our_saxpy(&amp;size, &amp;g, &amp;syn0[row1], &amp;ONE, &amp;syn1neg[row2], &amp;ONE)</pre>
<pre id='line182' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), (&amp;(__pyx_v_syn0[__pyx_v_row1])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1neg[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
    __pyx_L3_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183: </pre>
<pre id='line183' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line184")'> 184:     our_saxpy(&amp;size, &amp;word_locks[word2_index], work, &amp;ONE, &amp;syn0[row1], &amp;ONE)</pre>
<pre id='line184' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;(__pyx_v_word_locks[__pyx_v_word2_index])), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn0[__pyx_v_row1])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line185")'> 185: </pre>
<pre id='line185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186:     return next_random</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'>  __pyx_r = __pyx_v_next_random;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187: </pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line188")'> 188: cdef void fast_sentence_cbow_hs(</pre>
<pre id='line188' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_fast_sentence_cbow_hs(__pyx_t_5numpy_uint32_t const *__pyx_v_word_point, __pyx_t_5numpy_uint8_t const *__pyx_v_word_code, int *__pyx_v_codelens, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1, int const __pyx_v_size, __pyx_t_5numpy_uint32_t const *__pyx_v_indexes, __pyx_t_14word2vec_inner_REAL_t const __pyx_v_alpha, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work, int __pyx_v_i, int __pyx_v_j, int __pyx_v_k, int __pyx_v_cbow_mean, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks) {
  PY_LONG_LONG __pyx_v_b;
  PY_LONG_LONG __pyx_v_row2;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_f;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_g;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_count;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_inv_count;
  int __pyx_v_m;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189:     const np.uint32_t *word_point, const np.uint8_t *word_code, int codelens[MAX_SENTENCE_LEN],</pre>
<pre id='line189' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line190")'> 190:     REAL_t *neu1, REAL_t *syn0, REAL_t *syn1, const int size,</pre>
<pre id='line190' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line191")'> 191:     const np.uint32_t indexes[MAX_SENTENCE_LEN], const REAL_t alpha, REAL_t *work,</pre>
<pre id='line191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line192")'> 192:     int i, int j, int k, int cbow_mean, REAL_t *word_locks) nogil:</pre>
<pre id='line192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193: </pre>
<pre id='line193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:     cdef long long a, b</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line195")'> 195:     cdef long long row2</pre>
<pre id='line195' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line196")'> 196:     cdef REAL_t f, g, count, inv_count = 1.0</pre>
<pre id='line196' class='code' style='background-color: #FFFFff'>  __pyx_v_inv_count = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197:     cdef int m</pre>
<pre id='line197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line198")'> 198: </pre>
<pre id='line198' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199:     memset(neu1, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line199' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_neu1, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200:     count = &lt;REAL_t&gt;0.0</pre>
<pre id='line200' class='code' style='background-color: #FFFFff'>  __pyx_v_count = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201:     for m in range(j, k):</pre>
<pre id='line201' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_k;
  for (__pyx_t_2 = __pyx_v_j; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_m = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line202")'> 202:         if m == i:</pre>
<pre id='line202' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_m == __pyx_v_i) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203:             continue</pre>
<pre id='line203' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204:         else:</pre>
<pre id='line204' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line205")'> 205:             count += ONEF</pre>
<pre id='line205' class='code' style='background-color: #FFFFff'>      __pyx_v_count = (__pyx_v_count + __pyx_v_14word2vec_inner_ONEF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line206")'> 206:             our_saxpy(&amp;size, &amp;ONEF, &amp;syn0[indexes[m] * size], &amp;ONE, neu1, &amp;ONE)</pre>
<pre id='line206' class='code' style='background-color: #FFFFff'>      __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_syn0[((__pyx_v_indexes[__pyx_v_m]) * __pyx_v_size)])), (&amp;__pyx_v_14word2vec_inner_ONE), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    }
    __pyx_L3_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line207")'> 207:     if count &gt; (&lt;REAL_t&gt;0.5):</pre>
<pre id='line207' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = ((__pyx_v_count &gt; ((__pyx_t_14word2vec_inner_REAL_t)0.5)) != 0);
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208:         inv_count = ONEF/count</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'>    __pyx_v_inv_count = (__pyx_v_14word2vec_inner_ONEF / __pyx_v_count);
    goto __pyx_L6;
  }
  __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209:     if cbow_mean:</pre>
<pre id='line209' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = (__pyx_v_cbow_mean != 0);
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210:         sscal(&amp;size, &amp;inv_count, neu1, &amp;ONE)  # (does this need BLAS-variants like saxpy?)</pre>
<pre id='line210' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_size), (&amp;__pyx_v_inv_count), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    goto __pyx_L7;
  }
  __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line211")'> 211: </pre>
<pre id='line211' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212:     memset(work, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line212' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_work, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line213")'> 213:     for b in range(codelens[i]):</pre>
<pre id='line213' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_codelens[__pyx_v_i]);
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_1; __pyx_t_4+=1) {
    __pyx_v_b = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line214")'> 214:         row2 = word_point[b] * size</pre>
<pre id='line214' class='code' style='background-color: #FFFFff'>    __pyx_v_row2 = ((__pyx_v_word_point[__pyx_v_b]) * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215:         f = our_dot(&amp;size, neu1, &amp;ONE, &amp;syn1[row2], &amp;ONE)</pre>
<pre id='line215' class='code' style='background-color: #FFFFff'>    __pyx_v_f = __pyx_v_14word2vec_inner_our_dot((&amp;__pyx_v_size), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line216")'> 216:         if f &lt;= -MAX_EXP or f &gt;= MAX_EXP:</pre>
<pre id='line216' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_f &lt;= -6.0) != 0);
    if (!__pyx_t_3) {
      __pyx_t_5 = ((__pyx_v_f &gt;= 6.0) != 0);
      __pyx_t_6 = __pyx_t_5;
    } else {
      __pyx_t_6 = __pyx_t_3;
    }
    if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217:             continue</pre>
<pre id='line217' class='code' style='background-color: #FFFFff'>      goto __pyx_L8_continue;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line218")'> 218:         f = EXP_TABLE[&lt;int&gt;((f + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))]</pre>
<pre id='line218' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_14word2vec_inner_EXP_TABLE[((int)((__pyx_v_f + 6.0) * 83.0))]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219:         g = (1 - word_code[b] - f) * alpha</pre>
<pre id='line219' class='code' style='background-color: #FFFFff'>    __pyx_v_g = (((1 - (__pyx_v_word_code[__pyx_v_b])) - __pyx_v_f) * __pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220:         our_saxpy(&amp;size, &amp;g, &amp;syn1[row2], &amp;ONE, work, &amp;ONE)</pre>
<pre id='line220' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221:         our_saxpy(&amp;size, &amp;g, neu1, &amp;ONE, &amp;syn1[row2], &amp;ONE)</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
    __pyx_L8_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222: </pre>
<pre id='line222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223:     if not cbow_mean:  # divide error over summed window vectors</pre>
<pre id='line223' class='code' style='background-color: #FFFFff'>  __pyx_t_6 = ((!(__pyx_v_cbow_mean != 0)) != 0);
  if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224:         sscal(&amp;size, &amp;inv_count, work, &amp;ONE)  # (does this need BLAS-variants like saxpy?)</pre>
<pre id='line224' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_size), (&amp;__pyx_v_inv_count), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
    goto __pyx_L11;
  }
  __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line225")'> 225: </pre>
<pre id='line225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226:     for m in range(j, k):</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_k;
  for (__pyx_t_2 = __pyx_v_j; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_m = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line227")'> 227:         if m == i:</pre>
<pre id='line227' class='code' style='background-color: #FFFFff'>    __pyx_t_6 = ((__pyx_v_m == __pyx_v_i) != 0);
    if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228:             continue</pre>
<pre id='line228' class='code' style='background-color: #FFFFff'>      goto __pyx_L12_continue;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229:         else:</pre>
<pre id='line229' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230:             our_saxpy(&amp;size, &amp;word_locks[indexes[m]], work, &amp;ONE, &amp;syn0[indexes[m] * size], &amp;ONE)</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'>      __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;(__pyx_v_word_locks[(__pyx_v_indexes[__pyx_v_m])])), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn0[((__pyx_v_indexes[__pyx_v_m]) * __pyx_v_size)])), (&amp;__pyx_v_14word2vec_inner_ONE));
    }
    __pyx_L12_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line231")'> 231: </pre>
<pre id='line231' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line232")'> 232: cdef void fast_sentence_cbow_hs_sentiment(</pre>
<pre id='line232' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_fast_sentence_cbow_hs_sentiment(__pyx_t_5numpy_uint32_t const *__pyx_v_word_point, __pyx_t_5numpy_uint8_t const *__pyx_v_word_code, int *__pyx_v_codelens, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1, int const __pyx_v_size, __pyx_t_5numpy_uint32_t const *__pyx_v_indexes, __pyx_t_14word2vec_inner_REAL_t const __pyx_v_alpha, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work, int __pyx_v_i, int __pyx_v_j, int __pyx_v_k, int __pyx_v_cbow_mean, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks, __pyx_t_14word2vec_inner_REAL_t const *__pyx_v_T) {
  PY_LONG_LONG __pyx_v_b;
  PY_LONG_LONG __pyx_v_row2;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_f;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_g;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_count;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_inv_count;
  int __pyx_v_m;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_inerr;
  char __pyx_v_trans;
  char __pyx_v_norm;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233:     const np.uint32_t *word_point, const np.uint8_t *word_code, int codelens[MAX_SENTENCE_LEN],</pre>
<pre id='line233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234:     REAL_t *neu1, REAL_t *syn0, REAL_t *syn1, const int size,</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235:     const np.uint32_t indexes[MAX_SENTENCE_LEN], const REAL_t alpha, REAL_t *work,</pre>
<pre id='line235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236:     int i, int j, int k, int cbow_mean, REAL_t *word_locks, const REAL_t *T) nogil:</pre>
<pre id='line236' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line237")'> 237: </pre>
<pre id='line237' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238:     cdef long long a, b</pre>
<pre id='line238' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239:     cdef long long row2</pre>
<pre id='line239' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240:     cdef REAL_t f, g, count, inv_count = 1.0</pre>
<pre id='line240' class='code' style='background-color: #FFFFff'>  __pyx_v_inv_count = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line241")'> 241:     cdef int m</pre>
<pre id='line241' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line242")'> 242:     cdef REAL_t *inerr=&lt;REAL_t *&gt;malloc(size*cython.sizeof(REAL_t))</pre>
<pre id='line242' class='code' style='background-color: #FFFFff'>  __pyx_v_inerr = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line243")'> 243:     cdef char trans = 'T'</pre>
<pre id='line243' class='code' style='background-color: #FFFFff'>  __pyx_v_trans = 'T';
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244:     cdef char norm = 'N'</pre>
<pre id='line244' class='code' style='background-color: #FFFFff'>  __pyx_v_norm = 'N';
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245:     #cdef REAL_t multiply</pre>
<pre id='line245' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246: </pre>
<pre id='line246' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247:     # initialization</pre>
<pre id='line247' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line248")'> 248:     init_mat(size,1,&amp;inerr[0],ZEROF)</pre>
<pre id='line248' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_size, 1, (&amp;(__pyx_v_inerr[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line249")'> 249: </pre>
<pre id='line249' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line250")'> 250:     memset(neu1, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line250' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_neu1, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line251")'> 251:     count = &lt;REAL_t&gt;0.0</pre>
<pre id='line251' class='code' style='background-color: #FFFFff'>  __pyx_v_count = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line252")'> 252:     for m in range(j, k):</pre>
<pre id='line252' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_k;
  for (__pyx_t_2 = __pyx_v_j; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_m = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line253")'> 253:         if m == i:</pre>
<pre id='line253' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_m == __pyx_v_i) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254:             continue</pre>
<pre id='line254' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line255")'> 255:         else:</pre>
<pre id='line255' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line256")'> 256:             count += ONEF</pre>
<pre id='line256' class='code' style='background-color: #FFFFff'>      __pyx_v_count = (__pyx_v_count + __pyx_v_14word2vec_inner_ONEF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line257")'> 257:             our_multi_mat_vec(&amp;trans,&amp;size,&amp;size,&amp;ONEF,&amp;T[0],&amp;size,&amp;syn0[indexes[m] * size],&amp;ONE,&amp;ONEF,neu1,&amp;ONE) # neu1&lt;-T*l0</pre>
<pre id='line257' class='code' style='background-color: #FFFFff'>      __pyx_f_14word2vec_inner_our_multi_mat_vec((&amp;__pyx_v_trans), (&amp;__pyx_v_size), (&amp;__pyx_v_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_T[0])), (&amp;__pyx_v_size), (&amp;(__pyx_v_syn0[((__pyx_v_indexes[__pyx_v_m]) * __pyx_v_size)])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ONEF), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    }
    __pyx_L3_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line258")'> 258:             #our_saxpy(&amp;size, &amp;ONEF, &amp;l0[0], &amp;ONE, neu1, &amp;ONE)</pre>
<pre id='line258' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line259")'> 259:     if count &gt; (&lt;REAL_t&gt;0.5):</pre>
<pre id='line259' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = ((__pyx_v_count &gt; ((__pyx_t_14word2vec_inner_REAL_t)0.5)) != 0);
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line260")'> 260:         inv_count = ONEF/count</pre>
<pre id='line260' class='code' style='background-color: #FFFFff'>    __pyx_v_inv_count = (__pyx_v_14word2vec_inner_ONEF / __pyx_v_count);
    goto __pyx_L6;
  }
  __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line261")'> 261:     if cbow_mean:</pre>
<pre id='line261' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = (__pyx_v_cbow_mean != 0);
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line262")'> 262:         sscal(&amp;size, &amp;inv_count, neu1, &amp;ONE)  # (does this need BLAS-variants like saxpy?)</pre>
<pre id='line262' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_size), (&amp;__pyx_v_inv_count), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    goto __pyx_L7;
  }
  __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line263")'> 263: </pre>
<pre id='line263' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line264")'> 264:     memset(work, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line264' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_work, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line265")'> 265:     for b in range(codelens[i]):</pre>
<pre id='line265' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_codelens[__pyx_v_i]);
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_1; __pyx_t_4+=1) {
    __pyx_v_b = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line266")'> 266:         row2 = word_point[b] * size</pre>
<pre id='line266' class='code' style='background-color: #FFFFff'>    __pyx_v_row2 = ((__pyx_v_word_point[__pyx_v_b]) * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line267")'> 267:         f = our_dot(&amp;size, neu1, &amp;ONE, &amp;syn1[row2], &amp;ONE)</pre>
<pre id='line267' class='code' style='background-color: #FFFFff'>    __pyx_v_f = __pyx_v_14word2vec_inner_our_dot((&amp;__pyx_v_size), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line268")'> 268:         if f &lt;= -MAX_EXP or f &gt;= MAX_EXP:</pre>
<pre id='line268' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_f &lt;= -6.0) != 0);
    if (!__pyx_t_3) {
      __pyx_t_5 = ((__pyx_v_f &gt;= 6.0) != 0);
      __pyx_t_6 = __pyx_t_5;
    } else {
      __pyx_t_6 = __pyx_t_3;
    }
    if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line269")'> 269:             continue</pre>
<pre id='line269' class='code' style='background-color: #FFFFff'>      goto __pyx_L8_continue;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line270")'> 270:         f = EXP_TABLE[&lt;int&gt;((f + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))]</pre>
<pre id='line270' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_14word2vec_inner_EXP_TABLE[((int)((__pyx_v_f + 6.0) * 83.0))]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line271")'> 271:         g = (1 - word_code[b] - f) * alpha</pre>
<pre id='line271' class='code' style='background-color: #FFFFff'>    __pyx_v_g = (((1 - (__pyx_v_word_code[__pyx_v_b])) - __pyx_v_f) * __pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line272")'> 272:         # our_multi_mat_mat(&amp;norm,&amp;norm,&amp;size,&amp;size,&amp;ONE,&amp;multiply,&amp;syn1[row2],&amp;size,neu1,&amp;ONE,&amp;ONEF,&amp;T[0],&amp;size) #T=T+ obj_weight * alpha * matmul(g,l1)</pre>
<pre id='line272' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line273")'> 273:         our_saxpy(&amp;size, &amp;g, &amp;syn1[row2], &amp;ONE, &amp;inerr[0], &amp;ONE) #inerr+=g*syn1[row2]</pre>
<pre id='line273' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_inerr[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line274")'> 274:         # our_saxpy(&amp;size, &amp;g, &amp;syn1[row2], &amp;ONE, work, &amp;ONE)</pre>
<pre id='line274' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line275")'> 275:         our_saxpy(&amp;size, &amp;g, neu1, &amp;ONE, &amp;syn1[row2], &amp;ONE)</pre>
<pre id='line275' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
    __pyx_L8_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line276")'> 276: </pre>
<pre id='line276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line277")'> 277:     # input gradient</pre>
<pre id='line277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line278")'> 278:     our_multi_mat_vec(&amp;norm,&amp;size,&amp;size,&amp;ONEF,&amp;T[0],&amp;size,&amp;inerr[0],&amp;ONE,&amp;ONEF,work,&amp;ONE) # work = work+obj_weight * matmul(T.T,inerr)</pre>
<pre id='line278' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_vec((&amp;__pyx_v_norm), (&amp;__pyx_v_size), (&amp;__pyx_v_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_T[0])), (&amp;__pyx_v_size), (&amp;(__pyx_v_inerr[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ONEF), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line279")'> 279: </pre>
<pre id='line279' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line280")'> 280:     if not cbow_mean:  # divide error over summed window vectors</pre>
<pre id='line280' class='code' style='background-color: #FFFFff'>  __pyx_t_6 = ((!(__pyx_v_cbow_mean != 0)) != 0);
  if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line281")'> 281:         sscal(&amp;size, &amp;inv_count, work, &amp;ONE)  # (does this need BLAS-variants like saxpy?)</pre>
<pre id='line281' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_size), (&amp;__pyx_v_inv_count), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
    goto __pyx_L11;
  }
  __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line282")'> 282: </pre>
<pre id='line282' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283:     for m in range(j, k):</pre>
<pre id='line283' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_k;
  for (__pyx_t_2 = __pyx_v_j; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_m = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284:         if m == i:</pre>
<pre id='line284' class='code' style='background-color: #FFFFff'>    __pyx_t_6 = ((__pyx_v_m == __pyx_v_i) != 0);
    if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line285")'> 285:             continue</pre>
<pre id='line285' class='code' style='background-color: #FFFFff'>      goto __pyx_L12_continue;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line286")'> 286:         else:</pre>
<pre id='line286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line287")'> 287:             our_saxpy(&amp;size, &amp;word_locks[indexes[m]], work, &amp;ONE, &amp;syn0[indexes[m] * size], &amp;ONE)</pre>
<pre id='line287' class='code' style='background-color: #FFFFff'>      __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;(__pyx_v_word_locks[(__pyx_v_indexes[__pyx_v_m])])), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn0[((__pyx_v_indexes[__pyx_v_m]) * __pyx_v_size)])), (&amp;__pyx_v_14word2vec_inner_ONE));
    }
    __pyx_L12_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line288")'> 288: </pre>
<pre id='line288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line289")'> 289: cdef unsigned long long fast_sentence_cbow_neg(</pre>
<pre id='line289' class='code' style='background-color: #FFFFff'>static unsigned PY_LONG_LONG __pyx_f_14word2vec_inner_fast_sentence_cbow_neg(int const __pyx_v_negative, __pyx_t_5numpy_uint32_t *__pyx_v_cum_table, unsigned PY_LONG_LONG __pyx_v_cum_table_len, CYTHON_UNUSED int *__pyx_v_codelens, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1neg, int const __pyx_v_size, __pyx_t_5numpy_uint32_t const *__pyx_v_indexes, __pyx_t_14word2vec_inner_REAL_t const __pyx_v_alpha, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work, int __pyx_v_i, int __pyx_v_j, int __pyx_v_k, int __pyx_v_cbow_mean, unsigned PY_LONG_LONG __pyx_v_next_random, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks) {
  PY_LONG_LONG __pyx_v_row2;
  unsigned PY_LONG_LONG __pyx_v_modulo;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_f;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_g;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_count;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_inv_count;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_label;
  __pyx_t_5numpy_uint32_t __pyx_v_target_index;
  __pyx_t_5numpy_uint32_t __pyx_v_word_index;
  int __pyx_v_d;
  int __pyx_v_m;
  unsigned PY_LONG_LONG __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line290")'> 290:     const int negative, np.uint32_t *cum_table, unsigned long long cum_table_len, int codelens[MAX_SENTENCE_LEN],</pre>
<pre id='line290' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line291")'> 291:     REAL_t *neu1,  REAL_t *syn0, REAL_t *syn1neg, const int size,</pre>
<pre id='line291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line292")'> 292:     const np.uint32_t indexes[MAX_SENTENCE_LEN], const REAL_t alpha, REAL_t *work,</pre>
<pre id='line292' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line293")'> 293:     int i, int j, int k, int cbow_mean, unsigned long long next_random, REAL_t *word_locks) nogil:</pre>
<pre id='line293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line294")'> 294: </pre>
<pre id='line294' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line295")'> 295:     cdef long long a</pre>
<pre id='line295' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line296")'> 296:     cdef long long row2</pre>
<pre id='line296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line297")'> 297:     cdef unsigned long long modulo = 281474976710655ULL</pre>
<pre id='line297' class='code' style='background-color: #FFFFff'>  __pyx_v_modulo = 281474976710655ULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line298")'> 298:     cdef REAL_t f, g, count, inv_count = 1.0, label</pre>
<pre id='line298' class='code' style='background-color: #FFFFff'>  __pyx_v_inv_count = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line299")'> 299:     cdef np.uint32_t target_index, word_index</pre>
<pre id='line299' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line300")'> 300:     cdef int d, m</pre>
<pre id='line300' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line301")'> 301: </pre>
<pre id='line301' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line302")'> 302:     word_index = indexes[i]</pre>
<pre id='line302' class='code' style='background-color: #FFFFff'>  __pyx_v_word_index = (__pyx_v_indexes[__pyx_v_i]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line303")'> 303: </pre>
<pre id='line303' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line304")'> 304:     memset(neu1, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line304' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_neu1, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line305")'> 305:     count = &lt;REAL_t&gt;0.0</pre>
<pre id='line305' class='code' style='background-color: #FFFFff'>  __pyx_v_count = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line306")'> 306:     for m in range(j, k):</pre>
<pre id='line306' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_k;
  for (__pyx_t_2 = __pyx_v_j; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_m = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line307")'> 307:         if m == i:</pre>
<pre id='line307' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_m == __pyx_v_i) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line308")'> 308:             continue</pre>
<pre id='line308' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line309")'> 309:         else:</pre>
<pre id='line309' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line310")'> 310:             count += ONEF</pre>
<pre id='line310' class='code' style='background-color: #FFFFff'>      __pyx_v_count = (__pyx_v_count + __pyx_v_14word2vec_inner_ONEF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line311")'> 311:             our_saxpy(&amp;size, &amp;ONEF, &amp;syn0[indexes[m] * size], &amp;ONE, neu1, &amp;ONE)</pre>
<pre id='line311' class='code' style='background-color: #FFFFff'>      __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_syn0[((__pyx_v_indexes[__pyx_v_m]) * __pyx_v_size)])), (&amp;__pyx_v_14word2vec_inner_ONE), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    }
    __pyx_L3_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line312")'> 312:     if count &gt; (&lt;REAL_t&gt;0.5):</pre>
<pre id='line312' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = ((__pyx_v_count &gt; ((__pyx_t_14word2vec_inner_REAL_t)0.5)) != 0);
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line313")'> 313:         inv_count = ONEF/count</pre>
<pre id='line313' class='code' style='background-color: #FFFFff'>    __pyx_v_inv_count = (__pyx_v_14word2vec_inner_ONEF / __pyx_v_count);
    goto __pyx_L6;
  }
  __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line314")'> 314:     if cbow_mean:</pre>
<pre id='line314' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = (__pyx_v_cbow_mean != 0);
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line315")'> 315:         sscal(&amp;size, &amp;inv_count, neu1, &amp;ONE)  # (does this need BLAS-variants like saxpy?)</pre>
<pre id='line315' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_size), (&amp;__pyx_v_inv_count), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    goto __pyx_L7;
  }
  __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line316")'> 316: </pre>
<pre id='line316' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line317")'> 317:     memset(work, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line317' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_work, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line318")'> 318: </pre>
<pre id='line318' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line319")'> 319:     for d in range(negative+1):</pre>
<pre id='line319' class='code' style='background-color: #FFFFff'>  __pyx_t_4 = (__pyx_v_negative + 1);
  for (__pyx_t_1 = 0; __pyx_t_1 &lt; __pyx_t_4; __pyx_t_1+=1) {
    __pyx_v_d = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line320")'> 320:         if d == 0:</pre>
<pre id='line320' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_d == 0) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line321")'> 321:             target_index = word_index</pre>
<pre id='line321' class='code' style='background-color: #FFFFff'>      __pyx_v_target_index = __pyx_v_word_index;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line322")'> 322:             label = ONEF</pre>
<pre id='line322' class='code' style='background-color: #FFFFff'>      __pyx_v_label = __pyx_v_14word2vec_inner_ONEF;
      goto __pyx_L10;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line323")'> 323:         else:</pre>
<pre id='line323' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line324")'> 324:             target_index = bisect_left(cum_table, (next_random &gt;&gt; 16) % cum_table[cum_table_len-1], 0, cum_table_len)</pre>
<pre id='line324' class='code' style='background-color: #FFFFff'>      __pyx_v_target_index = __pyx_f_14word2vec_inner_bisect_left(__pyx_v_cum_table, ((__pyx_v_next_random &gt;&gt; 16) % (__pyx_v_cum_table[(__pyx_v_cum_table_len - 1)])), 0, __pyx_v_cum_table_len);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line325")'> 325:             next_random = (next_random * &lt;unsigned long long&gt;25214903917ULL + 11) &amp; modulo</pre>
<pre id='line325' class='code' style='background-color: #FFFFff'>      __pyx_v_next_random = (((__pyx_v_next_random * ((unsigned PY_LONG_LONG)25214903917ULL)) + 11) &amp; __pyx_v_modulo);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line326")'> 326:             if target_index == word_index:</pre>
<pre id='line326' class='code' style='background-color: #FFFFff'>      __pyx_t_3 = ((__pyx_v_target_index == __pyx_v_word_index) != 0);
      if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line327")'> 327:                 continue</pre>
<pre id='line327' class='code' style='background-color: #FFFFff'>        goto __pyx_L8_continue;
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line328")'> 328:             label = &lt;REAL_t&gt;0.0</pre>
<pre id='line328' class='code' style='background-color: #FFFFff'>      __pyx_v_label = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
    }
    __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line329")'> 329: </pre>
<pre id='line329' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line330")'> 330:         row2 = target_index * size</pre>
<pre id='line330' class='code' style='background-color: #FFFFff'>    __pyx_v_row2 = (__pyx_v_target_index * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line331")'> 331:         f = our_dot(&amp;size, neu1, &amp;ONE, &amp;syn1neg[row2], &amp;ONE)</pre>
<pre id='line331' class='code' style='background-color: #FFFFff'>    __pyx_v_f = __pyx_v_14word2vec_inner_our_dot((&amp;__pyx_v_size), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1neg[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line332")'> 332:         if f &lt;= -MAX_EXP or f &gt;= MAX_EXP:</pre>
<pre id='line332' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_f &lt;= -6.0) != 0);
    if (!__pyx_t_3) {
      __pyx_t_5 = ((__pyx_v_f &gt;= 6.0) != 0);
      __pyx_t_6 = __pyx_t_5;
    } else {
      __pyx_t_6 = __pyx_t_3;
    }
    if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line333")'> 333:             continue</pre>
<pre id='line333' class='code' style='background-color: #FFFFff'>      goto __pyx_L8_continue;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line334")'> 334:         f = EXP_TABLE[&lt;int&gt;((f + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))]</pre>
<pre id='line334' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_14word2vec_inner_EXP_TABLE[((int)((__pyx_v_f + 6.0) * 83.0))]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line335")'> 335:         g = (label - f) * alpha</pre>
<pre id='line335' class='code' style='background-color: #FFFFff'>    __pyx_v_g = ((__pyx_v_label - __pyx_v_f) * __pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line336")'> 336:         our_saxpy(&amp;size, &amp;g, &amp;syn1neg[row2], &amp;ONE, work, &amp;ONE)</pre>
<pre id='line336' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), (&amp;(__pyx_v_syn1neg[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line337")'> 337:         our_saxpy(&amp;size, &amp;g, neu1, &amp;ONE, &amp;syn1neg[row2], &amp;ONE)</pre>
<pre id='line337' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1neg[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
    __pyx_L8_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line338")'> 338: </pre>
<pre id='line338' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line339")'> 339:     if not cbow_mean:  # divide error over summed window vectors</pre>
<pre id='line339' class='code' style='background-color: #FFFFff'>  __pyx_t_6 = ((!(__pyx_v_cbow_mean != 0)) != 0);
  if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line340")'> 340:         sscal(&amp;size, &amp;inv_count, work, &amp;ONE)  # (does this need BLAS-variants like saxpy?)</pre>
<pre id='line340' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_size), (&amp;__pyx_v_inv_count), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
    goto __pyx_L13;
  }
  __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line341")'> 341: </pre>
<pre id='line341' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line342")'> 342:     for m in range(j,k):</pre>
<pre id='line342' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_k;
  for (__pyx_t_2 = __pyx_v_j; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_m = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line343")'> 343:         if m == i:</pre>
<pre id='line343' class='code' style='background-color: #FFFFff'>    __pyx_t_6 = ((__pyx_v_m == __pyx_v_i) != 0);
    if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line344")'> 344:             continue</pre>
<pre id='line344' class='code' style='background-color: #FFFFff'>      goto __pyx_L14_continue;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line345")'> 345:         else:</pre>
<pre id='line345' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line346")'> 346:             our_saxpy(&amp;size, &amp;word_locks[indexes[m]], work, &amp;ONE, &amp;syn0[indexes[m]*size], &amp;ONE)</pre>
<pre id='line346' class='code' style='background-color: #FFFFff'>      __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;(__pyx_v_word_locks[(__pyx_v_indexes[__pyx_v_m])])), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn0[((__pyx_v_indexes[__pyx_v_m]) * __pyx_v_size)])), (&amp;__pyx_v_14word2vec_inner_ONE));
    }
    __pyx_L14_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line347")'> 347: </pre>
<pre id='line347' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line348")'> 348:     return next_random</pre>
<pre id='line348' class='code' style='background-color: #FFFFff'>  __pyx_r = __pyx_v_next_random;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line349")'> 349: </pre>
<pre id='line349' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line350")'> 350: cdef unsigned long long fast_sentence_cbow_neg_sentiment(</pre>
<pre id='line350' class='code' style='background-color: #FFFFff'>static unsigned PY_LONG_LONG __pyx_f_14word2vec_inner_fast_sentence_cbow_neg_sentiment(int const __pyx_v_negative, __pyx_t_5numpy_uint32_t *__pyx_v_cum_table, unsigned PY_LONG_LONG __pyx_v_cum_table_len, CYTHON_UNUSED int *__pyx_v_codelens, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1neg, int const __pyx_v_size, __pyx_t_5numpy_uint32_t const *__pyx_v_indexes, __pyx_t_14word2vec_inner_REAL_t const __pyx_v_alpha, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work, int __pyx_v_i, int __pyx_v_j, int __pyx_v_k, int __pyx_v_cbow_mean, unsigned PY_LONG_LONG __pyx_v_next_random, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks, __pyx_t_14word2vec_inner_REAL_t const *__pyx_v_T) {
  PY_LONG_LONG __pyx_v_row2;
  unsigned PY_LONG_LONG __pyx_v_modulo;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_f;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_g;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_count;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_inv_count;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_label;
  __pyx_t_5numpy_uint32_t __pyx_v_target_index;
  __pyx_t_5numpy_uint32_t __pyx_v_word_index;
  int __pyx_v_d;
  int __pyx_v_m;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_inerr;
  char __pyx_v_trans;
  char __pyx_v_norm;
  unsigned PY_LONG_LONG __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line351")'> 351:     const int negative, np.uint32_t *cum_table, unsigned long long cum_table_len, int codelens[MAX_SENTENCE_LEN],</pre>
<pre id='line351' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line352")'> 352:     REAL_t *neu1,  REAL_t *syn0, REAL_t *syn1neg, const int size,</pre>
<pre id='line352' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line353")'> 353:     const np.uint32_t indexes[MAX_SENTENCE_LEN], const REAL_t alpha, REAL_t *work,</pre>
<pre id='line353' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line354")'> 354:     int i, int j, int k, int cbow_mean, unsigned long long next_random, REAL_t *word_locks, const REAL_t *T) nogil:</pre>
<pre id='line354' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line355")'> 355: </pre>
<pre id='line355' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line356")'> 356:     cdef long long a</pre>
<pre id='line356' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line357")'> 357:     cdef long long row2</pre>
<pre id='line357' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line358")'> 358:     cdef unsigned long long modulo = 281474976710655ULL</pre>
<pre id='line358' class='code' style='background-color: #FFFFff'>  __pyx_v_modulo = 281474976710655ULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line359")'> 359:     cdef REAL_t f, g, count, inv_count = 1.0, label</pre>
<pre id='line359' class='code' style='background-color: #FFFFff'>  __pyx_v_inv_count = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line360")'> 360:     cdef np.uint32_t target_index, word_index</pre>
<pre id='line360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line361")'> 361:     cdef int d, m</pre>
<pre id='line361' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line362")'> 362:     cdef REAL_t *inerr=&lt;REAL_t *&gt;malloc(size*cython.sizeof(REAL_t))</pre>
<pre id='line362' class='code' style='background-color: #FFFFff'>  __pyx_v_inerr = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line363")'> 363:     cdef char trans = 'T'</pre>
<pre id='line363' class='code' style='background-color: #FFFFff'>  __pyx_v_trans = 'T';
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line364")'> 364:     cdef char norm = 'N'</pre>
<pre id='line364' class='code' style='background-color: #FFFFff'>  __pyx_v_norm = 'N';
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line365")'> 365: </pre>
<pre id='line365' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line366")'> 366:     # initialization</pre>
<pre id='line366' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line367")'> 367:     init_mat(size,1,&amp;inerr[0],ZEROF)</pre>
<pre id='line367' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_size, 1, (&amp;(__pyx_v_inerr[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line368")'> 368: </pre>
<pre id='line368' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line369")'> 369:     word_index = indexes[i]</pre>
<pre id='line369' class='code' style='background-color: #FFFFff'>  __pyx_v_word_index = (__pyx_v_indexes[__pyx_v_i]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line370")'> 370: </pre>
<pre id='line370' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line371")'> 371:     memset(neu1, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line371' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_neu1, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line372")'> 372:     count = &lt;REAL_t&gt;0.0</pre>
<pre id='line372' class='code' style='background-color: #FFFFff'>  __pyx_v_count = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line373")'> 373:     for m in range(j, k):</pre>
<pre id='line373' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_k;
  for (__pyx_t_2 = __pyx_v_j; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_m = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line374")'> 374:         if m == i:</pre>
<pre id='line374' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_m == __pyx_v_i) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line375")'> 375:             continue</pre>
<pre id='line375' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line376")'> 376:         else:</pre>
<pre id='line376' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line377")'> 377:             count += ONEF</pre>
<pre id='line377' class='code' style='background-color: #FFFFff'>      __pyx_v_count = (__pyx_v_count + __pyx_v_14word2vec_inner_ONEF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line378")'> 378:             our_multi_mat_vec(&amp;trans,&amp;size,&amp;size,&amp;ONEF,&amp;T[0],&amp;size,&amp;syn0[indexes[m] * size],&amp;ONE,&amp;ONEF,neu1,&amp;ONE) # neu1&lt;-T*l0</pre>
<pre id='line378' class='code' style='background-color: #FFFFff'>      __pyx_f_14word2vec_inner_our_multi_mat_vec((&amp;__pyx_v_trans), (&amp;__pyx_v_size), (&amp;__pyx_v_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_T[0])), (&amp;__pyx_v_size), (&amp;(__pyx_v_syn0[((__pyx_v_indexes[__pyx_v_m]) * __pyx_v_size)])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ONEF), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    }
    __pyx_L3_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line379")'> 379:             #our_saxpy(&amp;size, &amp;ONEF, &amp;syn0[indexes[m] * size], &amp;ONE, neu1, &amp;ONE)</pre>
<pre id='line379' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line380")'> 380:     if count &gt; (&lt;REAL_t&gt;0.5):</pre>
<pre id='line380' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = ((__pyx_v_count &gt; ((__pyx_t_14word2vec_inner_REAL_t)0.5)) != 0);
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line381")'> 381:         inv_count = ONEF/count</pre>
<pre id='line381' class='code' style='background-color: #FFFFff'>    __pyx_v_inv_count = (__pyx_v_14word2vec_inner_ONEF / __pyx_v_count);
    goto __pyx_L6;
  }
  __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line382")'> 382:     if cbow_mean:</pre>
<pre id='line382' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = (__pyx_v_cbow_mean != 0);
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line383")'> 383:         sscal(&amp;size, &amp;inv_count, neu1, &amp;ONE)  # (does this need BLAS-variants like saxpy?)</pre>
<pre id='line383' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_size), (&amp;__pyx_v_inv_count), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    goto __pyx_L7;
  }
  __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line384")'> 384: </pre>
<pre id='line384' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line385")'> 385:     memset(work, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line385' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_work, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line386")'> 386: </pre>
<pre id='line386' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line387")'> 387:     for d in range(negative+1):</pre>
<pre id='line387' class='code' style='background-color: #FFFFff'>  __pyx_t_4 = (__pyx_v_negative + 1);
  for (__pyx_t_1 = 0; __pyx_t_1 &lt; __pyx_t_4; __pyx_t_1+=1) {
    __pyx_v_d = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line388")'> 388:         if d == 0:</pre>
<pre id='line388' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_d == 0) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line389")'> 389:             target_index = word_index</pre>
<pre id='line389' class='code' style='background-color: #FFFFff'>      __pyx_v_target_index = __pyx_v_word_index;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line390")'> 390:             label = ONEF</pre>
<pre id='line390' class='code' style='background-color: #FFFFff'>      __pyx_v_label = __pyx_v_14word2vec_inner_ONEF;
      goto __pyx_L10;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line391")'> 391:         else:</pre>
<pre id='line391' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line392")'> 392:             target_index = bisect_left(cum_table, (next_random &gt;&gt; 16) % cum_table[cum_table_len-1], 0, cum_table_len)</pre>
<pre id='line392' class='code' style='background-color: #FFFFff'>      __pyx_v_target_index = __pyx_f_14word2vec_inner_bisect_left(__pyx_v_cum_table, ((__pyx_v_next_random &gt;&gt; 16) % (__pyx_v_cum_table[(__pyx_v_cum_table_len - 1)])), 0, __pyx_v_cum_table_len);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line393")'> 393:             next_random = (next_random * &lt;unsigned long long&gt;25214903917ULL + 11) &amp; modulo</pre>
<pre id='line393' class='code' style='background-color: #FFFFff'>      __pyx_v_next_random = (((__pyx_v_next_random * ((unsigned PY_LONG_LONG)25214903917ULL)) + 11) &amp; __pyx_v_modulo);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line394")'> 394:             if target_index == word_index:</pre>
<pre id='line394' class='code' style='background-color: #FFFFff'>      __pyx_t_3 = ((__pyx_v_target_index == __pyx_v_word_index) != 0);
      if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line395")'> 395:                 continue</pre>
<pre id='line395' class='code' style='background-color: #FFFFff'>        goto __pyx_L8_continue;
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line396")'> 396:             label = &lt;REAL_t&gt;0.0</pre>
<pre id='line396' class='code' style='background-color: #FFFFff'>      __pyx_v_label = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
    }
    __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line397")'> 397: </pre>
<pre id='line397' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line398")'> 398:         row2 = target_index * size</pre>
<pre id='line398' class='code' style='background-color: #FFFFff'>    __pyx_v_row2 = (__pyx_v_target_index * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line399")'> 399:         f = our_dot(&amp;size, neu1, &amp;ONE, &amp;syn1neg[row2], &amp;ONE)</pre>
<pre id='line399' class='code' style='background-color: #FFFFff'>    __pyx_v_f = __pyx_v_14word2vec_inner_our_dot((&amp;__pyx_v_size), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1neg[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line400")'> 400:         if f &lt;= -MAX_EXP or f &gt;= MAX_EXP:</pre>
<pre id='line400' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_f &lt;= -6.0) != 0);
    if (!__pyx_t_3) {
      __pyx_t_5 = ((__pyx_v_f &gt;= 6.0) != 0);
      __pyx_t_6 = __pyx_t_5;
    } else {
      __pyx_t_6 = __pyx_t_3;
    }
    if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line401")'> 401:             continue</pre>
<pre id='line401' class='code' style='background-color: #FFFFff'>      goto __pyx_L8_continue;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line402")'> 402:         f = EXP_TABLE[&lt;int&gt;((f + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))]</pre>
<pre id='line402' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_14word2vec_inner_EXP_TABLE[((int)((__pyx_v_f + 6.0) * 83.0))]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line403")'> 403:         g = (label - f) * alpha</pre>
<pre id='line403' class='code' style='background-color: #FFFFff'>    __pyx_v_g = ((__pyx_v_label - __pyx_v_f) * __pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line404")'> 404:         our_saxpy(&amp;size, &amp;g, &amp;syn1neg[row2], &amp;ONE, &amp;inerr[0], &amp;ONE) #inerr+=g*syn1[row2]</pre>
<pre id='line404' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), (&amp;(__pyx_v_syn1neg[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_inerr[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line405")'> 405:         #our_saxpy(&amp;size, &amp;g, &amp;syn1neg[row2], &amp;ONE, work, &amp;ONE)</pre>
<pre id='line405' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line406")'> 406:         our_saxpy(&amp;size, &amp;g, neu1, &amp;ONE, &amp;syn1neg[row2], &amp;ONE)</pre>
<pre id='line406' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_g), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1neg[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
    __pyx_L8_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line407")'> 407: </pre>
<pre id='line407' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line408")'> 408:     if not cbow_mean:  # divide error over summed window vectors</pre>
<pre id='line408' class='code' style='background-color: #FFFFff'>  __pyx_t_6 = ((!(__pyx_v_cbow_mean != 0)) != 0);
  if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line409")'> 409:         sscal(&amp;size, &amp;inv_count, work, &amp;ONE)  # (does this need BLAS-variants like saxpy?)</pre>
<pre id='line409' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_size), (&amp;__pyx_v_inv_count), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
    goto __pyx_L13;
  }
  __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line410")'> 410: </pre>
<pre id='line410' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line411")'> 411:     # input gradient</pre>
<pre id='line411' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line412")'> 412:     our_multi_mat_vec(&amp;norm,&amp;size,&amp;size,&amp;ONEF,&amp;T[0],&amp;size,&amp;inerr[0],&amp;ONE,&amp;ONEF,work,&amp;ONE) # work = work +  matmul(T.T,inerr)</pre>
<pre id='line412' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_vec((&amp;__pyx_v_norm), (&amp;__pyx_v_size), (&amp;__pyx_v_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_T[0])), (&amp;__pyx_v_size), (&amp;(__pyx_v_inerr[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ONEF), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line413")'> 413: </pre>
<pre id='line413' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line414")'> 414:     for m in range(j,k):</pre>
<pre id='line414' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_k;
  for (__pyx_t_2 = __pyx_v_j; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_m = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line415")'> 415:         if m == i:</pre>
<pre id='line415' class='code' style='background-color: #FFFFff'>    __pyx_t_6 = ((__pyx_v_m == __pyx_v_i) != 0);
    if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line416")'> 416:             continue</pre>
<pre id='line416' class='code' style='background-color: #FFFFff'>      goto __pyx_L14_continue;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line417")'> 417:         else:</pre>
<pre id='line417' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line418")'> 418:             our_saxpy(&amp;size, &amp;word_locks[indexes[m]], work, &amp;ONE, &amp;syn0[indexes[m]*size], &amp;ONE)</pre>
<pre id='line418' class='code' style='background-color: #FFFFff'>      __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;(__pyx_v_word_locks[(__pyx_v_indexes[__pyx_v_m])])), __pyx_v_work, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn0[((__pyx_v_indexes[__pyx_v_m]) * __pyx_v_size)])), (&amp;__pyx_v_14word2vec_inner_ONE));
    }
    __pyx_L14_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line419")'> 419: </pre>
<pre id='line419' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line420")'> 420:     return next_random</pre>
<pre id='line420' class='code' style='background-color: #FFFFff'>  __pyx_r = __pyx_v_next_random;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line421")'> 421: </pre>
<pre id='line421' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line422")'> 422: cdef void derv_hTanh(const int n,const REAL_t *V1, const REAL_t *V2, REAL_t *V3) nogil:</pre>
<pre id='line422' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_derv_hTanh(int const __pyx_v_n, __pyx_t_14word2vec_inner_REAL_t const *__pyx_v_V1, __pyx_t_14word2vec_inner_REAL_t const *__pyx_v_V2, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_V3) {
  int __pyx_v_i;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line423")'> 423:     cdef int i</pre>
<pre id='line423' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line424")'> 424:     for i from 0&lt;=i&lt;n by 1:</pre>
<pre id='line424' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_n;
  for (__pyx_v_i = 0; __pyx_v_i &lt; __pyx_t_1; __pyx_v_i+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line425")'> 425:         if V1[i]&gt;1.0 or V1[i]&lt;-1.0:</pre>
<pre id='line425' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = (((__pyx_v_V1[__pyx_v_i]) &gt; 1.0) != 0);
    if (!__pyx_t_2) {
      __pyx_t_3 = (((__pyx_v_V1[__pyx_v_i]) &lt; -1.0) != 0);
      __pyx_t_4 = __pyx_t_3;
    } else {
      __pyx_t_4 = __pyx_t_2;
    }
    if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line426")'> 426:             V3[i]=ZEROF</pre>
<pre id='line426' class='code' style='background-color: #FFFFff'>      (__pyx_v_V3[__pyx_v_i]) = __pyx_v_14word2vec_inner_ZEROF;
      goto __pyx_L5;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line427")'> 427:         else:</pre>
<pre id='line427' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line428")'> 428:             V3[i]=V2[i]</pre>
<pre id='line428' class='code' style='background-color: #FFFFff'>      (__pyx_v_V3[__pyx_v_i]) = (__pyx_v_V2[__pyx_v_i]);
    }
    __pyx_L5:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line429")'> 429: </pre>
<pre id='line429' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line430")'> 430: cdef void fast_sentence_sswe(const REAL_t label, REAL_t *syn0, const int layer1_size, const int vsize, const int window, const int nclass, const np.uint32_t indexes[MAX_SENTENCE_LEN], const REAL_t alpha, REAL_t *work, const int i, const int j, REAL_t *word_locks, REAL_t *w1, REAL_t *b1, REAL_t *w2, REAL_t *b2) nogil:</pre>
<pre id='line430' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_fast_sentence_sswe(__pyx_t_14word2vec_inner_REAL_t const __pyx_v_label, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, int const __pyx_v_layer1_size, int const __pyx_v_vsize, int const __pyx_v_window, int const __pyx_v_nclass, __pyx_t_5numpy_uint32_t const *__pyx_v_indexes, __pyx_t_14word2vec_inner_REAL_t const __pyx_v_alpha, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work, int const __pyx_v_i, int const __pyx_v_j, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w2, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b2) {
  int __pyx_v_row;
  int __pyx_v_ind;
  int __pyx_v_pos1;
  int __pyx_v_pos2;
  int __pyx_v_cv_size;
  int __pyx_v_out_size;
  CYTHON_UNUSED int __pyx_v_tag;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l1;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l2;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l3;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l4;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l5;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neuoe;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu2e;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neuhte;
  char __pyx_v_trans;
  char __pyx_v_norm;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_alpha_M;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_lf_M;
  CYTHON_UNUSED __pyx_t_14word2vec_inner_REAL_t __pyx_v_s;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line431")'> 431: </pre>
<pre id='line431' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line432")'> 432:     cdef int row, ind, pos1, pos2</pre>
<pre id='line432' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line433")'> 433:     cdef int cv_size = vsize * window</pre>
<pre id='line433' class='code' style='background-color: #FFFFff'>  __pyx_v_cv_size = (__pyx_v_vsize * __pyx_v_window);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line434")'> 434:     cdef int out_size = nclass-1</pre>
<pre id='line434' class='code' style='background-color: #FFFFff'>  __pyx_v_out_size = (__pyx_v_nclass - 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line435")'> 435:     cdef int tag = 1</pre>
<pre id='line435' class='code' style='background-color: #FFFFff'>  __pyx_v_tag = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line436")'> 436:     cdef REAL_t *l1=&lt;REAL_t *&gt;malloc(cv_size*cython.sizeof(REAL_t)) # input vector</pre>
<pre id='line436' class='code' style='background-color: #FFFFff'>  __pyx_v_l1 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_cv_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line437")'> 437:     cdef REAL_t *l2=&lt;REAL_t *&gt;malloc(layer1_size*cython.sizeof(REAL_t)) # hidden layer vector l2=w1*x+b1</pre>
<pre id='line437' class='code' style='background-color: #FFFFff'>  __pyx_v_l2 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_layer1_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line438")'> 438:     cdef REAL_t *l3=&lt;REAL_t *&gt;malloc(layer1_size*cython.sizeof(REAL_t)) # l3=hTanh(l2)</pre>
<pre id='line438' class='code' style='background-color: #FFFFff'>  __pyx_v_l3 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_layer1_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line439")'> 439:     cdef REAL_t *l4=&lt;REAL_t *&gt;malloc(out_size*cython.sizeof(REAL_t)) # l4=w2*l3+b2</pre>
<pre id='line439' class='code' style='background-color: #FFFFff'>  __pyx_v_l4 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_out_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line440")'> 440:     cdef REAL_t *l5=&lt;REAL_t *&gt;malloc(out_size*cython.sizeof(REAL_t)) # l5=logit(l4)</pre>
<pre id='line440' class='code' style='background-color: #FFFFff'>  __pyx_v_l5 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_out_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line441")'> 441: </pre>
<pre id='line441' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line442")'> 442:     # intermediate matrices</pre>
<pre id='line442' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line443")'> 443:     cdef REAL_t *neuoe=&lt;REAL_t *&gt;malloc(out_size*cython.sizeof(REAL_t)) # error in output = label - l5</pre>
<pre id='line443' class='code' style='background-color: #FFFFff'>  __pyx_v_neuoe = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_out_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line444")'> 444:     cdef REAL_t *neu2e=&lt;REAL_t *&gt;malloc(layer1_size*cython.sizeof(REAL_t))</pre>
<pre id='line444' class='code' style='background-color: #FFFFff'>  __pyx_v_neu2e = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_layer1_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line445")'> 445:     cdef REAL_t *neuhte=&lt;REAL_t *&gt;malloc(layer1_size*cython.sizeof(REAL_t))</pre>
<pre id='line445' class='code' style='background-color: #FFFFff'>  __pyx_v_neuhte = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_layer1_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line446")'> 446: </pre>
<pre id='line446' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line447")'> 447:     cdef char trans='T'</pre>
<pre id='line447' class='code' style='background-color: #FFFFff'>  __pyx_v_trans = 'T';
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line448")'> 448:     cdef char norm='N'</pre>
<pre id='line448' class='code' style='background-color: #FFFFff'>  __pyx_v_norm = 'N';
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line449")'> 449:     cdef REAL_t alpha_M=-alpha # negatvie alpha</pre>
<pre id='line449' class='code' style='background-color: #FFFFff'>  __pyx_v_alpha_M = (-__pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line450")'> 450:     cdef REAL_t lf_M</pre>
<pre id='line450' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line451")'> 451:     cdef REAL_t s=ZEROF</pre>
<pre id='line451' class='code' style='background-color: #FFFFff'>  __pyx_v_s = __pyx_v_14word2vec_inner_ZEROF;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line452")'> 452: </pre>
<pre id='line452' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line453")'> 453:     # initialization of matrices</pre>
<pre id='line453' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line454")'> 454:     init_mat(cv_size,1,&amp;l1[0],ZEROF)</pre>
<pre id='line454' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_cv_size, 1, (&amp;(__pyx_v_l1[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line455")'> 455:     init_mat(layer1_size,1,&amp;l2[0],ZEROF)</pre>
<pre id='line455' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_layer1_size, 1, (&amp;(__pyx_v_l2[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line456")'> 456:     init_mat(layer1_size,1,&amp;l3[0],ZEROF)</pre>
<pre id='line456' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_layer1_size, 1, (&amp;(__pyx_v_l3[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line457")'> 457:     init_mat(out_size,1,&amp;l4[0],ZEROF)</pre>
<pre id='line457' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_out_size, 1, (&amp;(__pyx_v_l4[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line458")'> 458:     init_mat(layer1_size,1,&amp;neu2e[0],ZEROF)</pre>
<pre id='line458' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_layer1_size, 1, (&amp;(__pyx_v_neu2e[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line459")'> 459:     init_mat(layer1_size,1,&amp;neuhte[0],ZEROF)</pre>
<pre id='line459' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_layer1_size, 1, (&amp;(__pyx_v_neuhte[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line460")'> 460: </pre>
<pre id='line460' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line461")'> 461:     # errors on input vector</pre>
<pre id='line461' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line462")'> 462:     memset(work, 0, cv_size * cython.sizeof(REAL_t))</pre>
<pre id='line462' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_work, 0, (__pyx_v_cv_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line463")'> 463: </pre>
<pre id='line463' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line464")'> 464:     ind = 0</pre>
<pre id='line464' class='code' style='background-color: #FFFFff'>  __pyx_v_ind = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line465")'> 465:     for pos1 from i&lt;=pos1&lt;j by 1:</pre>
<pre id='line465' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_j;
  for (__pyx_v_pos1 = __pyx_v_i; __pyx_v_pos1 &lt; __pyx_t_1; __pyx_v_pos1+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line466")'> 466:         row = indexes[pos1] * vsize</pre>
<pre id='line466' class='code' style='background-color: #FFFFff'>    __pyx_v_row = ((__pyx_v_indexes[__pyx_v_pos1]) * __pyx_v_vsize);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line467")'> 467:         for pos2 from row&lt;=pos2&lt;row+vsize by 1:</pre>
<pre id='line467' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = (__pyx_v_row + __pyx_v_vsize);
    for (__pyx_v_pos2 = __pyx_v_row; __pyx_v_pos2 &lt; __pyx_t_2; __pyx_v_pos2+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line468")'> 468:             l1[ind] = syn0[pos2]</pre>
<pre id='line468' class='code' style='background-color: #FFFFff'>      (__pyx_v_l1[__pyx_v_ind]) = (__pyx_v_syn0[__pyx_v_pos2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line469")'> 469:             ind += 1</pre>
<pre id='line469' class='code' style='background-color: #FFFFff'>      __pyx_v_ind = (__pyx_v_ind + 1);
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line470")'> 470: </pre>
<pre id='line470' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line471")'> 471:     our_multi_mat_vec(&amp;trans,&amp;cv_size,&amp;layer1_size,&amp;ONEF,&amp;w1[0],&amp;cv_size,&amp;l1[0],&amp;ONE,&amp;ZEROF,&amp;l2[0],&amp;ONE) # l2&lt;-w1*l1</pre>
<pre id='line471' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_vec((&amp;__pyx_v_trans), (&amp;__pyx_v_cv_size), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_w1[0])), (&amp;__pyx_v_cv_size), (&amp;(__pyx_v_l1[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ZEROF), (&amp;(__pyx_v_l2[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line472")'> 472:     our_saxpy(&amp;layer1_size,&amp;ONEF,&amp;b1[0],&amp;ONE,&amp;l2[0],&amp;ONE) #l2=l2+b1</pre>
<pre id='line472' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_b1[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_l2[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line473")'> 473:     hTanh(layer1_size,&amp;l2[0],&amp;l3[0]) # hTanh layer</pre>
<pre id='line473' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_hTanh(__pyx_v_layer1_size, (&amp;(__pyx_v_l2[0])), (&amp;(__pyx_v_l3[0])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line474")'> 474:     our_multi_mat_vec(&amp;trans,&amp;layer1_size,&amp;out_size,&amp;ONEF,&amp;w2[0],&amp;layer1_size,&amp;l3[0],&amp;ONE,&amp;ZEROF,&amp;l4[0],&amp;ONE) # l4=w2*l3</pre>
<pre id='line474' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_vec((&amp;__pyx_v_trans), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_out_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_w2[0])), (&amp;__pyx_v_layer1_size), (&amp;(__pyx_v_l3[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ZEROF), (&amp;(__pyx_v_l4[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line475")'> 475:     our_saxpy(&amp;out_size,&amp;ONEF,&amp;b2[0],&amp;ONE,&amp;l4[0],&amp;ONE) #l4=l4+b2</pre>
<pre id='line475' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_out_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_b2[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_l4[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line476")'> 476: </pre>
<pre id='line476' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line477")'> 477:     for pos1 from 0&lt;=pos1&lt;out_size by 1:</pre>
<pre id='line477' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_out_size;
  for (__pyx_v_pos1 = 0; __pyx_v_pos1 &lt; __pyx_t_1; __pyx_v_pos1+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line478")'> 478:         if l4[pos1] &lt;= -MAX_EXP:</pre>
<pre id='line478' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = (((__pyx_v_l4[__pyx_v_pos1]) &lt;= -6.0) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line479")'> 479:             l5[pos1] = ZEROF</pre>
<pre id='line479' class='code' style='background-color: #FFFFff'>      (__pyx_v_l5[__pyx_v_pos1]) = __pyx_v_14word2vec_inner_ZEROF;
      goto __pyx_L9;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line480")'> 480:         elif l4[pos1] &gt;= MAX_EXP:</pre>
<pre id='line480' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = (((__pyx_v_l4[__pyx_v_pos1]) &gt;= 6.0) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line481")'> 481:             l5[pos1] = ONEF</pre>
<pre id='line481' class='code' style='background-color: #FFFFff'>      (__pyx_v_l5[__pyx_v_pos1]) = __pyx_v_14word2vec_inner_ONEF;
      goto __pyx_L9;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line482")'> 482:         else:</pre>
<pre id='line482' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line483")'> 483:             l5[pos1] = EXP_TABLE[&lt;int&gt;((l4[pos1] + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))] # logit(l4)</pre>
<pre id='line483' class='code' style='background-color: #FFFFff'>      (__pyx_v_l5[__pyx_v_pos1]) = (__pyx_v_14word2vec_inner_EXP_TABLE[((int)(((__pyx_v_l4[__pyx_v_pos1]) + 6.0) * 83.0))]);
    }
    __pyx_L9:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line484")'> 484:         if pos1==(label-1):</pre>
<pre id='line484' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_pos1 == (__pyx_v_label - 1.0)) != 0);
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line485")'> 485:             neuoe[pos1] = l5[pos1]  - &lt;REAL_t&gt; 1.0 # error in output layer</pre>
<pre id='line485' class='code' style='background-color: #FFFFff'>      (__pyx_v_neuoe[__pyx_v_pos1]) = ((__pyx_v_l5[__pyx_v_pos1]) - ((__pyx_t_14word2vec_inner_REAL_t)1.0));
      goto __pyx_L10;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line486")'> 486:         else:</pre>
<pre id='line486' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line487")'> 487:             neuoe[pos1] = l5[pos1]</pre>
<pre id='line487' class='code' style='background-color: #FFFFff'>      (__pyx_v_neuoe[__pyx_v_pos1]) = (__pyx_v_l5[__pyx_v_pos1]);
    }
    __pyx_L10:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line488")'> 488:     #printf("target=%d, estimate=%f\n",label,l5[0])</pre>
<pre id='line488' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line489")'> 489: </pre>
<pre id='line489' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line490")'> 490:     ## intermediate matrices for updating</pre>
<pre id='line490' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line491")'> 491:     our_multi_mat_mat(&amp;norm,&amp;trans,&amp;ONE,&amp;layer1_size,&amp;out_size,&amp;ONEF,&amp;neuoe[0],&amp;ONE,&amp;w2[0],&amp;layer1_size,&amp;ZEROF,&amp;neu2e[0],&amp;ONE) # neu2e=(w2^T*neuo)=layer1_size*1</pre>
<pre id='line491' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_mat((&amp;__pyx_v_norm), (&amp;__pyx_v_trans), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_out_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_neuoe[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_w2[0])), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ZEROF), (&amp;(__pyx_v_neu2e[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line492")'> 492:     derv_hTanh(layer1_size,&amp;l2[0],&amp;neu2e[0],&amp;neuhte[0]) # neuhte=neu2e if -1.&lt;=l2&lt;=1. else 0</pre>
<pre id='line492' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_derv_hTanh(__pyx_v_layer1_size, (&amp;(__pyx_v_l2[0])), (&amp;(__pyx_v_neu2e[0])), (&amp;(__pyx_v_neuhte[0])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line493")'> 493:     our_multi_mat_mat(&amp;norm,&amp;trans,&amp;ONE,&amp;cv_size,&amp;layer1_size,&amp;ONEF,&amp;neuhte[0],&amp;ONE,&amp;w1[0],&amp;cv_size,&amp;ZEROF,&amp;work[0],&amp;ONE) # work=(w1^T*neuhte)=cv_size*1</pre>
<pre id='line493' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_mat((&amp;__pyx_v_norm), (&amp;__pyx_v_trans), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_cv_size), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_neuhte[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_w1[0])), (&amp;__pyx_v_cv_size), (&amp;__pyx_v_14word2vec_inner_ZEROF), (&amp;(__pyx_v_work[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line494")'> 494: </pre>
<pre id='line494' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line495")'> 495:     ## update parameters</pre>
<pre id='line495' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line496")'> 496:     our_multi_mat_mat(&amp;norm,&amp;norm,&amp;layer1_size,&amp;out_size,&amp;ONE,&amp;alpha_M,&amp;l3[0],&amp;layer1_size,&amp;neuoe[0],&amp;ONE,&amp;ONEF,&amp;w2[0],&amp;layer1_size) #w2=w2-alpha*matmul(neuoe,l3)</pre>
<pre id='line496' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_mat((&amp;__pyx_v_norm), (&amp;__pyx_v_norm), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_out_size), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_alpha_M), (&amp;(__pyx_v_l3[0])), (&amp;__pyx_v_layer1_size), (&amp;(__pyx_v_neuoe[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_w2[0])), (&amp;__pyx_v_layer1_size));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line497")'> 497:     our_saxpy(&amp;out_size,&amp;alpha_M,&amp;neuoe[0],&amp;ONE,&amp;b2[0],&amp;ONE) #b2=b2-alpha*neuoe</pre>
<pre id='line497' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_out_size), (&amp;__pyx_v_alpha_M), (&amp;(__pyx_v_neuoe[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_b2[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line498")'> 498:     our_multi_mat_mat(&amp;norm,&amp;norm,&amp;cv_size,&amp;layer1_size,&amp;ONE,&amp;alpha_M,&amp;l1[0],&amp;cv_size,&amp;neuhte[0],&amp;ONE,&amp;ONEF,&amp;w1[0],&amp;cv_size) #w1=w1-alpha*matmul(neuhte,l1)</pre>
<pre id='line498' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_mat((&amp;__pyx_v_norm), (&amp;__pyx_v_norm), (&amp;__pyx_v_cv_size), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_alpha_M), (&amp;(__pyx_v_l1[0])), (&amp;__pyx_v_cv_size), (&amp;(__pyx_v_neuhte[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_w1[0])), (&amp;__pyx_v_cv_size));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line499")'> 499:     our_saxpy(&amp;layer1_size,&amp;alpha_M,&amp;neuhte[0],&amp;ONE,&amp;b1[0],&amp;ONE) #b2=b2-alpha*neuoe</pre>
<pre id='line499' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_layer1_size), (&amp;__pyx_v_alpha_M), (&amp;(__pyx_v_neuhte[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_b1[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line500")'> 500: </pre>
<pre id='line500' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line501")'> 501:     # update word vectors</pre>
<pre id='line501' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line502")'> 502:     ind = 0</pre>
<pre id='line502' class='code' style='background-color: #FFFFff'>  __pyx_v_ind = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line503")'> 503:     for pos1 from i&lt;=pos1&lt;j by 1:</pre>
<pre id='line503' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_j;
  for (__pyx_v_pos1 = __pyx_v_i; __pyx_v_pos1 &lt; __pyx_t_1; __pyx_v_pos1+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line504")'> 504:         row = indexes[pos1] * vsize</pre>
<pre id='line504' class='code' style='background-color: #FFFFff'>    __pyx_v_row = ((__pyx_v_indexes[__pyx_v_pos1]) * __pyx_v_vsize);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line505")'> 505:         lf_M = - word_locks[indexes[pos1]] * alpha</pre>
<pre id='line505' class='code' style='background-color: #FFFFff'>    __pyx_v_lf_M = ((-(__pyx_v_word_locks[(__pyx_v_indexes[__pyx_v_pos1])])) * __pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line506")'> 506:         our_saxpy(&amp;vsize,&amp;lf_M,&amp;work[ind*vsize],&amp;ONE,&amp;syn0[row],&amp;ONE)</pre>
<pre id='line506' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_vsize), (&amp;__pyx_v_lf_M), (&amp;(__pyx_v_work[(__pyx_v_ind * __pyx_v_vsize)])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn0[__pyx_v_row])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line507")'> 507:         ind+=1</pre>
<pre id='line507' class='code' style='background-color: #FFFFff'>    __pyx_v_ind = (__pyx_v_ind + 1);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line508")'> 508: </pre>
<pre id='line508' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line509")'> 509: cdef void fast_sentence_sswe_bow(const REAL_t label, REAL_t *syn0, const int layer1_size, const int vsize, const int window, const int nclass, const np.uint32_t indexes[MAX_SENTENCE_LEN], const REAL_t alpha, REAL_t *work, const int i, const int j, REAL_t *word_locks, REAL_t *w1, REAL_t *b1, REAL_t *w2, REAL_t *b2) nogil:</pre>
<pre id='line509' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_fast_sentence_sswe_bow(__pyx_t_14word2vec_inner_REAL_t const __pyx_v_label, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, int const __pyx_v_layer1_size, int const __pyx_v_vsize, int const __pyx_v_window, int const __pyx_v_nclass, __pyx_t_5numpy_uint32_t const *__pyx_v_indexes, __pyx_t_14word2vec_inner_REAL_t const __pyx_v_alpha, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work, int const __pyx_v_i, int const __pyx_v_j, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w2, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b2) {
  int __pyx_v_row;
  int __pyx_v_pos1;
  int __pyx_v_cv_size;
  int __pyx_v_out_size;
  CYTHON_UNUSED int __pyx_v_tag;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l1;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l2;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l3;
  CYTHON_UNUSED __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l3_mask;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l4;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_l5;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neuoe;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu2e;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neuhte;
  char __pyx_v_trans;
  char __pyx_v_norm;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_alpha_M;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_lf_M;
  CYTHON_UNUSED __pyx_t_14word2vec_inner_REAL_t __pyx_v_s;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_inv_count;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line510")'> 510: </pre>
<pre id='line510' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line511")'> 511:     cdef int row, ind, pos1, pos2</pre>
<pre id='line511' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line512")'> 512:     cdef int cv_size = vsize</pre>
<pre id='line512' class='code' style='background-color: #FFFFff'>  __pyx_v_cv_size = __pyx_v_vsize;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line513")'> 513:     cdef int out_size = nclass-1</pre>
<pre id='line513' class='code' style='background-color: #FFFFff'>  __pyx_v_out_size = (__pyx_v_nclass - 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line514")'> 514:     cdef int tag = 1</pre>
<pre id='line514' class='code' style='background-color: #FFFFff'>  __pyx_v_tag = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line515")'> 515:     cdef REAL_t *l1=&lt;REAL_t *&gt;malloc(cv_size*cython.sizeof(REAL_t)) # input vector</pre>
<pre id='line515' class='code' style='background-color: #FFFFff'>  __pyx_v_l1 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_cv_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line516")'> 516:     cdef REAL_t *l2=&lt;REAL_t *&gt;malloc(layer1_size*cython.sizeof(REAL_t)) # hidden layer vector l2=w1*x+b1</pre>
<pre id='line516' class='code' style='background-color: #FFFFff'>  __pyx_v_l2 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_layer1_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line517")'> 517:     cdef REAL_t *l3=&lt;REAL_t *&gt;malloc(layer1_size*cython.sizeof(REAL_t)) # hTanh(l2)</pre>
<pre id='line517' class='code' style='background-color: #FFFFff'>  __pyx_v_l3 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_layer1_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line518")'> 518:     cdef REAL_t *l3_mask=&lt;REAL_t *&gt;malloc(layer1_size*cython.sizeof(REAL_t)) # derivatives of hTanh(l2)</pre>
<pre id='line518' class='code' style='background-color: #FFFFff'>  __pyx_v_l3_mask = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_layer1_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line519")'> 519:     cdef REAL_t *l4=&lt;REAL_t *&gt;malloc(out_size*cython.sizeof(REAL_t)) # l4=w2*l3+b2</pre>
<pre id='line519' class='code' style='background-color: #FFFFff'>  __pyx_v_l4 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_out_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line520")'> 520:     cdef REAL_t *l5=&lt;REAL_t *&gt;malloc(out_size*cython.sizeof(REAL_t)) # l5=logit(l4)</pre>
<pre id='line520' class='code' style='background-color: #FFFFff'>  __pyx_v_l5 = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_out_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line521")'> 521: </pre>
<pre id='line521' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line522")'> 522:     # intermediate matrices</pre>
<pre id='line522' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line523")'> 523:     cdef REAL_t *neuoe=&lt;REAL_t *&gt;malloc(out_size*cython.sizeof(REAL_t)) # error in output = label - l5</pre>
<pre id='line523' class='code' style='background-color: #FFFFff'>  __pyx_v_neuoe = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_out_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line524")'> 524:     cdef REAL_t *neu2e=&lt;REAL_t *&gt;malloc(layer1_size*cython.sizeof(REAL_t))</pre>
<pre id='line524' class='code' style='background-color: #FFFFff'>  __pyx_v_neu2e = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_layer1_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line525")'> 525:     cdef REAL_t *neuhte=&lt;REAL_t *&gt;malloc(layer1_size*cython.sizeof(REAL_t))</pre>
<pre id='line525' class='code' style='background-color: #FFFFff'>  __pyx_v_neuhte = ((__pyx_t_14word2vec_inner_REAL_t *)malloc((__pyx_v_layer1_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line526")'> 526: </pre>
<pre id='line526' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line527")'> 527:     cdef char trans='T'</pre>
<pre id='line527' class='code' style='background-color: #FFFFff'>  __pyx_v_trans = 'T';
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line528")'> 528:     cdef char norm='N'</pre>
<pre id='line528' class='code' style='background-color: #FFFFff'>  __pyx_v_norm = 'N';
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line529")'> 529:     cdef REAL_t alpha_M=-alpha # negatvie alpha</pre>
<pre id='line529' class='code' style='background-color: #FFFFff'>  __pyx_v_alpha_M = (-__pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line530")'> 530:     cdef REAL_t lf_M</pre>
<pre id='line530' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line531")'> 531:     cdef REAL_t s=ZEROF</pre>
<pre id='line531' class='code' style='background-color: #FFFFff'>  __pyx_v_s = __pyx_v_14word2vec_inner_ZEROF;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line532")'> 532:     cdef REAL_t inv_count = 1.0</pre>
<pre id='line532' class='code' style='background-color: #FFFFff'>  __pyx_v_inv_count = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line533")'> 533: </pre>
<pre id='line533' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line534")'> 534:     # initialization of matrices</pre>
<pre id='line534' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line535")'> 535:     init_mat(cv_size,1,&amp;l1[0],ZEROF)</pre>
<pre id='line535' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_cv_size, 1, (&amp;(__pyx_v_l1[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line536")'> 536:     init_mat(layer1_size,1,&amp;l2[0],ZEROF)</pre>
<pre id='line536' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_layer1_size, 1, (&amp;(__pyx_v_l2[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line537")'> 537:     init_mat(layer1_size,1,&amp;l3[0],ZEROF)</pre>
<pre id='line537' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_layer1_size, 1, (&amp;(__pyx_v_l3[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line538")'> 538:     init_mat(out_size,1,&amp;l4[0],ZEROF)</pre>
<pre id='line538' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_out_size, 1, (&amp;(__pyx_v_l4[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line539")'> 539:     init_mat(layer1_size,1,&amp;neu2e[0],ZEROF)</pre>
<pre id='line539' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_layer1_size, 1, (&amp;(__pyx_v_neu2e[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line540")'> 540:     init_mat(layer1_size,1,&amp;neuhte[0],ZEROF)</pre>
<pre id='line540' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_init_mat(__pyx_v_layer1_size, 1, (&amp;(__pyx_v_neuhte[0])), __pyx_v_14word2vec_inner_ZEROF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line541")'> 541: </pre>
<pre id='line541' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line542")'> 542:     # errors on input vector</pre>
<pre id='line542' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line543")'> 543:     memset(work, 0, cv_size * cython.sizeof(REAL_t))</pre>
<pre id='line543' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_work, 0, (__pyx_v_cv_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line544")'> 544: </pre>
<pre id='line544' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line545")'> 545:     for pos1 from i&lt;=pos1&lt;j by 1:</pre>
<pre id='line545' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_j;
  for (__pyx_v_pos1 = __pyx_v_i; __pyx_v_pos1 &lt; __pyx_t_1; __pyx_v_pos1+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line546")'> 546:         row = indexes[pos1] * vsize</pre>
<pre id='line546' class='code' style='background-color: #FFFFff'>    __pyx_v_row = ((__pyx_v_indexes[__pyx_v_pos1]) * __pyx_v_vsize);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line547")'> 547:         our_saxpy(&amp;cv_size,&amp;ONEF,&amp;syn0[row],&amp;ONE,&amp;l1[0],&amp;ONE)</pre>
<pre id='line547' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_cv_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_syn0[__pyx_v_row])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_l1[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line548")'> 548: </pre>
<pre id='line548' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line549")'> 549:     inv_count = ONEF/ window</pre>
<pre id='line549' class='code' style='background-color: #FFFFff'>  __pyx_v_inv_count = (__pyx_v_14word2vec_inner_ONEF / __pyx_v_window);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line550")'> 550:     sscal(&amp;cv_size, &amp;inv_count, &amp;l1[0], &amp;ONE)</pre>
<pre id='line550' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_cv_size), (&amp;__pyx_v_inv_count), (&amp;(__pyx_v_l1[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line551")'> 551: </pre>
<pre id='line551' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line552")'> 552:     our_multi_mat_vec(&amp;trans,&amp;cv_size,&amp;layer1_size,&amp;ONEF,&amp;w1[0],&amp;cv_size,&amp;l1[0],&amp;ONE,&amp;ZEROF,&amp;l2[0],&amp;ONE) # l2&lt;-w1*l1</pre>
<pre id='line552' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_vec((&amp;__pyx_v_trans), (&amp;__pyx_v_cv_size), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_w1[0])), (&amp;__pyx_v_cv_size), (&amp;(__pyx_v_l1[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ZEROF), (&amp;(__pyx_v_l2[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line553")'> 553:     our_saxpy(&amp;layer1_size,&amp;ONEF,&amp;b1[0],&amp;ONE,&amp;l2[0],&amp;ONE) #l2=l2+b1</pre>
<pre id='line553' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_b1[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_l2[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line554")'> 554:     hTanh(layer1_size,&amp;l2[0],&amp;l3[0]) # hTanh layer</pre>
<pre id='line554' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_hTanh(__pyx_v_layer1_size, (&amp;(__pyx_v_l2[0])), (&amp;(__pyx_v_l3[0])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line555")'> 555:     our_multi_mat_vec(&amp;trans,&amp;layer1_size,&amp;out_size,&amp;ONEF,&amp;w2[0],&amp;layer1_size,&amp;l3[0],&amp;ONE,&amp;ZEROF,&amp;l4[0],&amp;ONE) # l4=w2*l3</pre>
<pre id='line555' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_vec((&amp;__pyx_v_trans), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_out_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_w2[0])), (&amp;__pyx_v_layer1_size), (&amp;(__pyx_v_l3[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ZEROF), (&amp;(__pyx_v_l4[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line556")'> 556:     our_saxpy(&amp;out_size,&amp;ONEF,&amp;b2[0],&amp;ONE,&amp;l4[0],&amp;ONE) #l4=l4+b2</pre>
<pre id='line556' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_out_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_b2[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_l4[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line557")'> 557: </pre>
<pre id='line557' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line558")'> 558:     for pos1 from 0&lt;=pos1&lt;out_size by 1:</pre>
<pre id='line558' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_out_size;
  for (__pyx_v_pos1 = 0; __pyx_v_pos1 &lt; __pyx_t_1; __pyx_v_pos1+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line559")'> 559:         if l4[pos1] &lt;= -MAX_EXP:</pre>
<pre id='line559' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = (((__pyx_v_l4[__pyx_v_pos1]) &lt;= -6.0) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line560")'> 560:             l5[pos1] = ZEROF</pre>
<pre id='line560' class='code' style='background-color: #FFFFff'>      (__pyx_v_l5[__pyx_v_pos1]) = __pyx_v_14word2vec_inner_ZEROF;
      goto __pyx_L7;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line561")'> 561:         elif l4[pos1] &gt;= MAX_EXP:</pre>
<pre id='line561' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = (((__pyx_v_l4[__pyx_v_pos1]) &gt;= 6.0) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line562")'> 562:             l5[pos1] = ONEF</pre>
<pre id='line562' class='code' style='background-color: #FFFFff'>      (__pyx_v_l5[__pyx_v_pos1]) = __pyx_v_14word2vec_inner_ONEF;
      goto __pyx_L7;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line563")'> 563:         else:</pre>
<pre id='line563' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line564")'> 564:             l5[pos1] = EXP_TABLE[&lt;int&gt;((l4[pos1] + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))] # logit(l4)</pre>
<pre id='line564' class='code' style='background-color: #FFFFff'>      (__pyx_v_l5[__pyx_v_pos1]) = (__pyx_v_14word2vec_inner_EXP_TABLE[((int)(((__pyx_v_l4[__pyx_v_pos1]) + 6.0) * 83.0))]);
    }
    __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line565")'> 565:         if pos1==(label-1):</pre>
<pre id='line565' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = ((__pyx_v_pos1 == (__pyx_v_label - 1.0)) != 0);
    if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line566")'> 566:             neuoe[pos1] = l5[pos1]  - &lt;REAL_t&gt; 1.0 # error in output layer</pre>
<pre id='line566' class='code' style='background-color: #FFFFff'>      (__pyx_v_neuoe[__pyx_v_pos1]) = ((__pyx_v_l5[__pyx_v_pos1]) - ((__pyx_t_14word2vec_inner_REAL_t)1.0));
      goto __pyx_L8;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line567")'> 567:         else:</pre>
<pre id='line567' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line568")'> 568:             neuoe[pos1] = l5[pos1]</pre>
<pre id='line568' class='code' style='background-color: #FFFFff'>      (__pyx_v_neuoe[__pyx_v_pos1]) = (__pyx_v_l5[__pyx_v_pos1]);
    }
    __pyx_L8:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line569")'> 569: </pre>
<pre id='line569' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line570")'> 570:     ## intermediate matrices for updating</pre>
<pre id='line570' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line571")'> 571:     our_multi_mat_mat(&amp;norm,&amp;trans,&amp;ONE,&amp;layer1_size,&amp;out_size,&amp;ONEF,&amp;neuoe[0],&amp;ONE,&amp;w2[0],&amp;layer1_size,&amp;ZEROF,&amp;neu2e[0],&amp;ONE) # neu2e=(w2^T*neuo)=layer1_size*1</pre>
<pre id='line571' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_mat((&amp;__pyx_v_norm), (&amp;__pyx_v_trans), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_out_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_neuoe[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_w2[0])), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ZEROF), (&amp;(__pyx_v_neu2e[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line572")'> 572:     derv_hTanh(layer1_size,&amp;l2[0],&amp;neu2e[0],&amp;neuhte[0]) # neuhte=neu2e if -1.&lt;=l2&lt;=1. else 0</pre>
<pre id='line572' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_derv_hTanh(__pyx_v_layer1_size, (&amp;(__pyx_v_l2[0])), (&amp;(__pyx_v_neu2e[0])), (&amp;(__pyx_v_neuhte[0])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line573")'> 573:     our_multi_mat_mat(&amp;norm,&amp;trans,&amp;ONE,&amp;cv_size,&amp;layer1_size,&amp;ONEF,&amp;neuhte[0],&amp;ONE,&amp;w1[0],&amp;cv_size,&amp;ZEROF,&amp;work[0],&amp;ONE) # work=(w1^T*neuhte)=cv_size*1</pre>
<pre id='line573' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_mat((&amp;__pyx_v_norm), (&amp;__pyx_v_trans), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_cv_size), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_neuhte[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_w1[0])), (&amp;__pyx_v_cv_size), (&amp;__pyx_v_14word2vec_inner_ZEROF), (&amp;(__pyx_v_work[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line574")'> 574: </pre>
<pre id='line574' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line575")'> 575:     ## update parameters</pre>
<pre id='line575' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line576")'> 576:     our_multi_mat_mat(&amp;norm,&amp;norm,&amp;layer1_size,&amp;out_size,&amp;ONE,&amp;alpha_M,&amp;l3[0],&amp;layer1_size,&amp;neuoe[0],&amp;ONE,&amp;ONEF,&amp;w2[0],&amp;layer1_size) #w2=w2-alpha*matmul(neuoe,l3)</pre>
<pre id='line576' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_mat((&amp;__pyx_v_norm), (&amp;__pyx_v_norm), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_out_size), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_alpha_M), (&amp;(__pyx_v_l3[0])), (&amp;__pyx_v_layer1_size), (&amp;(__pyx_v_neuoe[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_w2[0])), (&amp;__pyx_v_layer1_size));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line577")'> 577:     our_saxpy(&amp;out_size,&amp;alpha_M,&amp;neuoe[0],&amp;ONE,&amp;b2[0],&amp;ONE) #b2=b2-alpha*neuoe</pre>
<pre id='line577' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_out_size), (&amp;__pyx_v_alpha_M), (&amp;(__pyx_v_neuoe[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_b2[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line578")'> 578:     our_multi_mat_mat(&amp;norm,&amp;norm,&amp;cv_size,&amp;layer1_size,&amp;ONE,&amp;alpha_M,&amp;l1[0],&amp;cv_size,&amp;neuhte[0],&amp;ONE,&amp;ONEF,&amp;w1[0],&amp;cv_size) #w1=w1-alpha*matmul(neuhte,l1)</pre>
<pre id='line578' class='code' style='background-color: #FFFFff'>  __pyx_f_14word2vec_inner_our_multi_mat_mat((&amp;__pyx_v_norm), (&amp;__pyx_v_norm), (&amp;__pyx_v_cv_size), (&amp;__pyx_v_layer1_size), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_alpha_M), (&amp;(__pyx_v_l1[0])), (&amp;__pyx_v_cv_size), (&amp;(__pyx_v_neuhte[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_w1[0])), (&amp;__pyx_v_cv_size));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line579")'> 579:     our_saxpy(&amp;layer1_size,&amp;alpha_M,&amp;neuhte[0],&amp;ONE,&amp;b1[0],&amp;ONE) #b2=b2-alpha*neuoe</pre>
<pre id='line579' class='code' style='background-color: #FFFFff'>  __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_layer1_size), (&amp;__pyx_v_alpha_M), (&amp;(__pyx_v_neuhte[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_b1[0])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line580")'> 580: </pre>
<pre id='line580' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line581")'> 581:     # update word vectors</pre>
<pre id='line581' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line582")'> 582:     for pos1 from i&lt;=pos1&lt;j by 1:</pre>
<pre id='line582' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_j;
  for (__pyx_v_pos1 = __pyx_v_i; __pyx_v_pos1 &lt; __pyx_t_1; __pyx_v_pos1+=1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line583")'> 583:         row = indexes[pos1] * vsize</pre>
<pre id='line583' class='code' style='background-color: #FFFFff'>    __pyx_v_row = ((__pyx_v_indexes[__pyx_v_pos1]) * __pyx_v_vsize);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line584")'> 584:         lf_M = - word_locks[indexes[pos1]] * alpha</pre>
<pre id='line584' class='code' style='background-color: #FFFFff'>    __pyx_v_lf_M = ((-(__pyx_v_word_locks[(__pyx_v_indexes[__pyx_v_pos1])])) * __pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line585")'> 585:         our_saxpy(&amp;vsize,&amp;lf_M,&amp;work[0],&amp;ONE,&amp;syn0[row],&amp;ONE)</pre>
<pre id='line585' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_vsize), (&amp;__pyx_v_lf_M), (&amp;(__pyx_v_work[0])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn0[__pyx_v_row])), (&amp;__pyx_v_14word2vec_inner_ONE));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line586")'> 586: </pre>
<pre id='line586' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line587")'> 587: def train_batch_sswe(model, sentences, alpha, _work):</pre>
<pre id='line587' class='code' style='background-color: #FFFF1e'>/* Python wrapper */
static PyObject *__pyx_pw_14word2vec_inner_1train_batch_sswe(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_14word2vec_inner_1train_batch_sswe = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("train_batch_sswe"), (PyCFunction)__pyx_pw_14word2vec_inner_1train_batch_sswe, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_14word2vec_inner_1train_batch_sswe(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_model = 0;
  PyObject *__pyx_v_sentences = 0;
  PyObject *__pyx_v_alpha = 0;
  PyObject *__pyx_v__work = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_sswe (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_sentences,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_work,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_sentences)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sswe", 1, 4, 4, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sswe", 1, 4, 4, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_work)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sswe", 1, 4, 4, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "train_batch_sswe") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_model = values[0];
    __pyx_v_sentences = values[1];
    __pyx_v_alpha = values[2];
    __pyx_v__work = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sswe", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_sswe", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_14word2vec_inner_train_batch_sswe(__pyx_self, __pyx_v_model, __pyx_v_sentences, __pyx_v_alpha, __pyx_v__work);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_14word2vec_inner_train_batch_sswe(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_model, PyObject *__pyx_v_sentences, PyObject *__pyx_v_alpha, PyObject *__pyx_v__work) {
  int __pyx_v_sample;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v__alpha;
  int __pyx_v_layer1_size;
  int __pyx_v_vector_size;
  int __pyx_v_nclass;
  __pyx_t_5numpy_uint32_t __pyx_v_indexes[10000];
  int __pyx_v_sentence_idx[(10000 + 1)];
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_sentence_label[(10000 + 1)];
  int __pyx_v_window;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_effective_words;
  int __pyx_v_effective_sentences;
  CYTHON_UNUSED int __pyx_v_sent_words;
  int __pyx_v_sent_idx;
  int __pyx_v_idx_start;
  int __pyx_v_idx_end;
  unsigned PY_LONG_LONG __pyx_v_next_random;
  unsigned PY_LONG_LONG __pyx_v_this_random;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w1;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b1;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w2;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b2;
  PyObject *__pyx_v_vlookup = NULL;
  PyObject *__pyx_v_sent = NULL;
  PyObject *__pyx_v_label = NULL;
  PyObject *__pyx_v_token = NULL;
  PyObject *__pyx_v_word = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_sswe", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_sswe", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vlookup);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sent);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_label);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_token);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_word);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__18 = <span class='py_c_api'>PyTuple_Pack</span>(35, __pyx_n_s_model, __pyx_n_s_sentences, __pyx_n_s_alpha, __pyx_n_s_work, __pyx_n_s_sample, __pyx_n_s_syn0, __pyx_n_s_word_locks, __pyx_n_s_work_2, __pyx_n_s_alpha_2, __pyx_n_s_layer1_size, __pyx_n_s_vector_size, __pyx_n_s_nclass, __pyx_n_s_indexes, __pyx_n_s_sentence_idx, __pyx_n_s_sentence_label, __pyx_n_s_window, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_effective_words, __pyx_n_s_effective_sentences, __pyx_n_s_sent_words, __pyx_n_s_sent_idx, __pyx_n_s_idx_start, __pyx_n_s_idx_end, __pyx_n_s_next_random, __pyx_n_s_this_random, __pyx_n_s_w1, __pyx_n_s_b1, __pyx_n_s_w2, __pyx_n_s_b2, __pyx_n_s_vlookup, __pyx_n_s_sent, __pyx_n_s_label, __pyx_n_s_token, __pyx_n_s_word);<span class='error_goto'> if (unlikely(!__pyx_tuple__18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__18);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__18);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_14word2vec_inner_1train_batch_sswe, NULL, __pyx_n_s_word2vec_inner);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_train_batch_sswe, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__19 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 35, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_home_slcf_saerom_word2vec_codes, __pyx_n_s_train_batch_sswe, 587, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line588")'> 588:     cdef int sample = (model.sample != 0)</pre>
<pre id='line588' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_sample);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_int_0, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_sample = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line589")'> 589: </pre>
<pre id='line589' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line590")'> 590:     cdef REAL_t *syn0 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0))</pre>
<pre id='line590' class='code' style='background-color: #FFFF9f'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 590; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 590; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_syn0 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_2)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line591")'> 591:     cdef REAL_t *word_locks = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0_lockf))</pre>
<pre id='line591' class='code' style='background-color: #FFFF9f'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0_lockf);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_word_locks = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_2)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line592")'> 592:     cdef REAL_t *work</pre>
<pre id='line592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line593")'> 593:     cdef REAL_t _alpha = alpha</pre>
<pre id='line593' class='code' style='background-color: #FFFFaa'>  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_alpha);<span class='error_goto'> if (unlikely((__pyx_t_4 == (npy_float32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 593; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v__alpha = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line594")'> 594: </pre>
<pre id='line594' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line595")'> 595:     cdef int layer1_size = model.layer1_size</pre>
<pre id='line595' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_layer1_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_layer1_size = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line596")'> 596:     cdef int vector_size = model.vector_size</pre>
<pre id='line596' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vector_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_vector_size = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line597")'> 597:     cdef int nclass = model.nclass</pre>
<pre id='line597' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nclass);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nclass = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line598")'> 598: </pre>
<pre id='line598' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line599")'> 599:     cdef np.uint32_t indexes[MAX_SENTENCE_LEN]</pre>
<pre id='line599' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line600")'> 600:     cdef int sentence_idx[MAX_SENTENCE_LEN + 1]</pre>
<pre id='line600' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line601")'> 601:     cdef REAL_t sentence_label[MAX_SENTENCE_LEN + 1]</pre>
<pre id='line601' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line602")'> 602:     cdef int window = model.window</pre>
<pre id='line602' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_window);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_window = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line603")'> 603: </pre>
<pre id='line603' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line604")'> 604:     cdef int i, j</pre>
<pre id='line604' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line605")'> 605:     cdef int effective_words = 0, effective_sentences = 0, sent_words = 0</pre>
<pre id='line605' class='code' style='background-color: #FFFFff'>  __pyx_v_effective_words = 0;
  __pyx_v_effective_sentences = 0;
  __pyx_v_sent_words = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line606")'> 606:     cdef int sent_idx, idx_start, idx_end</pre>
<pre id='line606' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line607")'> 607: </pre>
<pre id='line607' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line608")'> 608:     # for sampling (negative and frequent-word downsampling)</pre>
<pre id='line608' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line609")'> 609:     cdef unsigned long long next_random, this_random</pre>
<pre id='line609' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line610")'> 610:     next_random = (2**24) * model.random.randint(0, 2**24) + model.random.randint(0, 2**24)</pre>
<pre id='line610' class='code' style='background-color: #FFFF31'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple_, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_int_16777216, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_tuple__2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_PY_LONG_LONG</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_6 == (unsigned PY_LONG_LONG)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_next_random = __pyx_t_6;
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line611")'> 611: </pre>
<pre id='line611' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line612")'> 612:     cdef REAL_t *w1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['w1']))</pre>
<pre id='line612' class='code' style='background-color: #FFFF73'>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, __pyx_n_s_w1);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_w1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_2)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line613")'> 613:     cdef REAL_t *b1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['b1']))</pre>
<pre id='line613' class='code' style='background-color: #FFFF73'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 613; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_2, __pyx_n_s_b1);<span class='error_goto'> if (unlikely(__pyx_t_5 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 613; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 613; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_b1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_5)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line614")'> 614:     cdef REAL_t *w2 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['w2']))</pre>
<pre id='line614' class='code' style='background-color: #FFFF73'>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, __pyx_n_s_w2);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 614; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_w2 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_2)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line615")'> 615:     cdef REAL_t *b2 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['w2']))</pre>
<pre id='line615' class='code' style='background-color: #FFFF73'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 615; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_2, __pyx_n_s_w2);<span class='error_goto'> if (unlikely(__pyx_t_5 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 615; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 615; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_b2 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_5)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line616")'> 616: </pre>
<pre id='line616' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line617")'> 617:     # convert Python structures to primitive types, so we can release the GIL</pre>
<pre id='line617' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line618")'> 618:     work = &lt;REAL_t *&gt;np.PyArray_DATA(_work)</pre>
<pre id='line618' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__work) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__work, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_work = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__work)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line619")'> 619: </pre>
<pre id='line619' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line620")'> 620:     vlookup = model.vocab</pre>
<pre id='line620' class='code' style='background-color: #FFFFd4'>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vocab);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_v_vlookup = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line621")'> 621:     sentence_idx[0] = 0</pre>
<pre id='line621' class='code' style='background-color: #FFFFff'>  (__pyx_v_sentence_idx[0]) = 0;
</pre><pre class='line' style='background-color: #FFFF17' onclick='toggleDiv("line622")'> 622:     for sent, label in sentences:</pre>
<pre id='line622' class='code' style='background-color: #FFFF17'>  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sentences) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sentences)) {
    __pyx_t_5 = __pyx_v_sentences; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sentences);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_8 = Py_TYPE(__pyx_t_5)-&gt;tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_8 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) {
      if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_8 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
      if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_2 = __pyx_t_8(__pyx_t_5);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    }
    if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
      #endif
      if (unlikely(size != 2)) {
        if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
        else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
        __pyx_t_9 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
      } else {
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
        __pyx_t_9 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_10 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_11 = Py_TYPE(__pyx_t_10)-&gt;tp_iternext;
      index = 0; __pyx_t_1 = __pyx_t_11(__pyx_t_10); if (unlikely(!__pyx_t_1)) goto __pyx_L5_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      index = 1; __pyx_t_9 = __pyx_t_11(__pyx_t_10); if (unlikely(!__pyx_t_9)) goto __pyx_L5_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_11(__pyx_t_10), 2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_11 = NULL;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      goto __pyx_L6_unpacking_done;
      __pyx_L5_unpacking_failed:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_11 = NULL;
      if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_L6_unpacking_done:;
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_sent, __pyx_t_1);
    __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_label, __pyx_t_9);
    __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line623")'> 623:         if not sent : # ignore empty sentences; leave effective_sentences unchanged</pre>
<pre id='line623' class='code' style='background-color: #FFFFd4'>    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(__pyx_t_12 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_13 = ((!__pyx_t_12) != 0);
    if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line624")'> 624:             continue</pre>
<pre id='line624' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line625")'> 625:         for token in sent:</pre>
<pre id='line625' class='code' style='background-color: #FFFF2a'>    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sent) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sent)) {
      __pyx_t_2 = __pyx_v_sent; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_14 = 0;
      __pyx_t_15 = NULL;
    } else {
      __pyx_t_14 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_15 = Py_TYPE(__pyx_t_2)-&gt;tp_iternext;
    }
    for (;;) {
      if (!__pyx_t_15 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_14 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_9 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_14); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_14++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_14); __pyx_t_14++;<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_15 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_14 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_9 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_14); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_14++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_14); __pyx_t_14++;<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_9 = __pyx_t_15(__pyx_t_2);
        if (unlikely(!__pyx_t_9)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_token, __pyx_t_9);
      __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line626")'> 626:             word = vlookup[token] if token in vlookup else None</pre>
<pre id='line626' class='code' style='background-color: #FFFF86'>      __pyx_t_13 = (<span class='pyx_c_api'>__Pyx_PySequence_Contains</span>(__pyx_v_token, __pyx_v_vlookup, Py_EQ));<span class='error_goto'> if (unlikely(__pyx_t_13 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      if ((__pyx_t_13 != 0)) {
        __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_vlookup, __pyx_v_token);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_9 = __pyx_t_1;
        __pyx_t_1 = 0;
      } else {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        __pyx_t_9 = Py_None;
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_word, __pyx_t_9);
      __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line627")'> 627:             this_random = random_int32(&amp;next_random)</pre>
<pre id='line627' class='code' style='background-color: #FFFFff'>      __pyx_v_this_random = __pyx_f_14word2vec_inner_random_int32((&amp;__pyx_v_next_random));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line628")'> 628:             if word is None:</pre>
<pre id='line628' class='code' style='background-color: #FFFFff'>      __pyx_t_13 = (__pyx_v_word == Py_None);
      __pyx_t_12 = (__pyx_t_13 != 0);
      if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line629")'> 629:                 continue</pre>
<pre id='line629' class='code' style='background-color: #FFFFff'>        goto __pyx_L8_continue;
      }
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line630")'> 630:             if sample and word.sample_int &lt; this_random:</pre>
<pre id='line630' class='code' style='background-color: #FFFF6a'>      if ((__pyx_v_sample != 0)) {
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_sample_int);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_PY_LONG_LONG</span>(__pyx_v_this_random);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_10 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_9, __pyx_t_1, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(__pyx_t_12 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_13 = __pyx_t_12;
      } else {
        __pyx_t_13 = (__pyx_v_sample != 0);
      }
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line631")'> 631:                 continue</pre>
<pre id='line631' class='code' style='background-color: #FFFFff'>        goto __pyx_L8_continue;
      }
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line632")'> 632:             indexes[effective_words] = word.index</pre>
<pre id='line632' class='code' style='background-color: #FFFFc4'>      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_index);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_16 = __Pyx_PyInt_As_npy_uint32(__pyx_t_10);<span class='error_goto'> if (unlikely((__pyx_t_16 == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      (__pyx_v_indexes[__pyx_v_effective_words]) = __pyx_t_16;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line633")'> 633:             effective_words += 1</pre>
<pre id='line633' class='code' style='background-color: #FFFFff'>      __pyx_v_effective_words = (__pyx_v_effective_words + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line634")'> 634:             if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line634' class='code' style='background-color: #FFFFff'>      __pyx_t_13 = ((__pyx_v_effective_words == 10000) != 0);
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line635")'> 635:                 break</pre>
<pre id='line635' class='code' style='background-color: #FFFFe7'>        goto __pyx_L9_break;
      }
      __pyx_L8_continue:;
    }
    __pyx_L9_break:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line636")'> 636:         sentence_label[effective_sentences] = &lt;REAL_t&gt; label</pre>
<pre id='line636' class='code' style='background-color: #FFFFaa'>    __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_label);<span class='error_goto'> if (unlikely((__pyx_t_4 == (npy_float32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_sentence_label[__pyx_v_effective_sentences]) = ((__pyx_t_14word2vec_inner_REAL_t)__pyx_t_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line637")'> 637:         effective_sentences += 1</pre>
<pre id='line637' class='code' style='background-color: #FFFFff'>    __pyx_v_effective_sentences = (__pyx_v_effective_sentences + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line638")'> 638:         #printf("label=%f ",sentence_label[effective_sentences-1])</pre>
<pre id='line638' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line639")'> 639:         sentence_idx[effective_sentences] = effective_words</pre>
<pre id='line639' class='code' style='background-color: #FFFFff'>    (__pyx_v_sentence_idx[__pyx_v_effective_sentences]) = __pyx_v_effective_words;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line640")'> 640:         #print("label:",label)</pre>
<pre id='line640' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line641")'> 641:         if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line641' class='code' style='background-color: #FFFFff'>    __pyx_t_13 = ((__pyx_v_effective_words == 10000) != 0);
    if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line642")'> 642:             break</pre>
<pre id='line642' class='code' style='background-color: #FFFFe7'>      goto __pyx_L4_break;
    }
    __pyx_L3_continue:;
  }
  __pyx_L4_break:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line643")'> 643: </pre>
<pre id='line643' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line644")'> 644:     with nogil:</pre>
<pre id='line644' class='code' style='background-color: #FFFFff'>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L16;
        }
        __pyx_L16:;
      }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line645")'> 645:         for sent_idx in range(effective_sentences):</pre>
<pre id='line645' class='code' style='background-color: #FFFFff'>        __pyx_t_3 = __pyx_v_effective_sentences;
        for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_3; __pyx_t_17+=1) {
          __pyx_v_sent_idx = __pyx_t_17;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line646")'> 646:             idx_start = sentence_idx[sent_idx]</pre>
<pre id='line646' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_start = (__pyx_v_sentence_idx[__pyx_v_sent_idx]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line647")'> 647:             idx_end = sentence_idx[sent_idx + 1]</pre>
<pre id='line647' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_end = (__pyx_v_sentence_idx[(__pyx_v_sent_idx + 1)]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line648")'> 648:             if (idx_end-idx_start)&gt;=window:</pre>
<pre id='line648' class='code' style='background-color: #FFFFff'>          __pyx_t_13 = (((__pyx_v_idx_end - __pyx_v_idx_start) &gt;= __pyx_v_window) != 0);
          if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line649")'> 649:                 for i in range(idx_start,idx_end - window + 1):</pre>
<pre id='line649' class='code' style='background-color: #FFFFff'>            __pyx_t_18 = ((__pyx_v_idx_end - __pyx_v_window) + 1);
            for (__pyx_t_19 = __pyx_v_idx_start; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
              __pyx_v_i = __pyx_t_19;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line650")'> 650:                     j = i + window</pre>
<pre id='line650' class='code' style='background-color: #FFFFff'>              __pyx_v_j = (__pyx_v_i + __pyx_v_window);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line651")'> 651:                     fast_sentence_sswe(sentence_label[sent_idx],syn0,layer1_size, vector_size, window, nclass, indexes, _alpha, work, i, j, word_locks, w1, b1, w2, b2)</pre>
<pre id='line651' class='code' style='background-color: #FFFFff'>              __pyx_f_14word2vec_inner_fast_sentence_sswe((__pyx_v_sentence_label[__pyx_v_sent_idx]), __pyx_v_syn0, __pyx_v_layer1_size, __pyx_v_vector_size, __pyx_v_window, __pyx_v_nclass, __pyx_v_indexes, __pyx_v__alpha, __pyx_v_work, __pyx_v_i, __pyx_v_j, __pyx_v_word_locks, __pyx_v_w1, __pyx_v_b1, __pyx_v_w2, __pyx_v_b2);
            }
            goto __pyx_L19;
          }
          __pyx_L19:;
        }
      }
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line652")'> 652:     return effective_words</pre>
<pre id='line652' class='code' style='background-color: #FFFFc4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_effective_words);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line653")'> 653: </pre>
<pre id='line653' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line654")'> 654: def train_batch_sswe_bow(model, sentences, alpha, _work):</pre>
<pre id='line654' class='code' style='background-color: #FFFF1e'>/* Python wrapper */
static PyObject *__pyx_pw_14word2vec_inner_3train_batch_sswe_bow(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_14word2vec_inner_3train_batch_sswe_bow = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("train_batch_sswe_bow"), (PyCFunction)__pyx_pw_14word2vec_inner_3train_batch_sswe_bow, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_14word2vec_inner_3train_batch_sswe_bow(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_model = 0;
  PyObject *__pyx_v_sentences = 0;
  PyObject *__pyx_v_alpha = 0;
  PyObject *__pyx_v__work = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_sswe_bow (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_sentences,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_work,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_sentences)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sswe_bow", 1, 4, 4, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sswe_bow", 1, 4, 4, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_work)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sswe_bow", 1, 4, 4, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "train_batch_sswe_bow") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_model = values[0];
    __pyx_v_sentences = values[1];
    __pyx_v_alpha = values[2];
    __pyx_v__work = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sswe_bow", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_sswe_bow", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_14word2vec_inner_2train_batch_sswe_bow(__pyx_self, __pyx_v_model, __pyx_v_sentences, __pyx_v_alpha, __pyx_v__work);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_14word2vec_inner_2train_batch_sswe_bow(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_model, PyObject *__pyx_v_sentences, PyObject *__pyx_v_alpha, PyObject *__pyx_v__work) {
  int __pyx_v_sample;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v__alpha;
  int __pyx_v_layer1_size;
  int __pyx_v_vector_size;
  int __pyx_v_nclass;
  __pyx_t_5numpy_uint32_t __pyx_v_indexes[10000];
  int __pyx_v_sentence_idx[(10000 + 1)];
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_sentence_label[(10000 + 1)];
  int __pyx_v_window;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_effective_words;
  int __pyx_v_effective_sentences;
  CYTHON_UNUSED int __pyx_v_sent_words;
  int __pyx_v_sent_idx;
  int __pyx_v_idx_start;
  int __pyx_v_idx_end;
  unsigned PY_LONG_LONG __pyx_v_next_random;
  unsigned PY_LONG_LONG __pyx_v_this_random;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w1;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b1;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w2;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b2;
  PyObject *__pyx_v_vlookup = NULL;
  PyObject *__pyx_v_sent = NULL;
  PyObject *__pyx_v_label = NULL;
  PyObject *__pyx_v_token = NULL;
  PyObject *__pyx_v_word = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_sswe_bow", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_sswe_bow", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vlookup);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sent);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_label);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_token);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_word);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__20 = <span class='py_c_api'>PyTuple_Pack</span>(35, __pyx_n_s_model, __pyx_n_s_sentences, __pyx_n_s_alpha, __pyx_n_s_work, __pyx_n_s_sample, __pyx_n_s_syn0, __pyx_n_s_word_locks, __pyx_n_s_work_2, __pyx_n_s_alpha_2, __pyx_n_s_layer1_size, __pyx_n_s_vector_size, __pyx_n_s_nclass, __pyx_n_s_indexes, __pyx_n_s_sentence_idx, __pyx_n_s_sentence_label, __pyx_n_s_window, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_effective_words, __pyx_n_s_effective_sentences, __pyx_n_s_sent_words, __pyx_n_s_sent_idx, __pyx_n_s_idx_start, __pyx_n_s_idx_end, __pyx_n_s_next_random, __pyx_n_s_this_random, __pyx_n_s_w1, __pyx_n_s_b1, __pyx_n_s_w2, __pyx_n_s_b2, __pyx_n_s_vlookup, __pyx_n_s_sent, __pyx_n_s_label, __pyx_n_s_token, __pyx_n_s_word);<span class='error_goto'> if (unlikely(!__pyx_tuple__20)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__20);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__20);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_14word2vec_inner_3train_batch_sswe_bow, NULL, __pyx_n_s_word2vec_inner);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_train_batch_sswe_bow, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__21 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 35, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__20, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_home_slcf_saerom_word2vec_codes, __pyx_n_s_train_batch_sswe_bow, 654, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__21)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line655")'> 655:     cdef int sample = (model.sample != 0)</pre>
<pre id='line655' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_sample);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_int_0, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 655; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_sample = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line656")'> 656: </pre>
<pre id='line656' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line657")'> 657:     cdef REAL_t *syn0 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0))</pre>
<pre id='line657' class='code' style='background-color: #FFFF9f'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_syn0 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_2)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line658")'> 658:     cdef REAL_t *word_locks = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0_lockf))</pre>
<pre id='line658' class='code' style='background-color: #FFFF9f'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0_lockf);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_word_locks = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_2)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line659")'> 659:     cdef REAL_t *work</pre>
<pre id='line659' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line660")'> 660:     cdef REAL_t _alpha = alpha</pre>
<pre id='line660' class='code' style='background-color: #FFFFaa'>  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_alpha);<span class='error_goto'> if (unlikely((__pyx_t_4 == (npy_float32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 660; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v__alpha = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line661")'> 661: </pre>
<pre id='line661' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line662")'> 662:     cdef int layer1_size = model.layer1_size</pre>
<pre id='line662' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_layer1_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_layer1_size = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line663")'> 663:     cdef int vector_size = model.vector_size</pre>
<pre id='line663' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vector_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 663; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 663; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_vector_size = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line664")'> 664:     cdef int nclass = model.nclass</pre>
<pre id='line664' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nclass);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 664; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 664; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nclass = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line665")'> 665: </pre>
<pre id='line665' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line666")'> 666:     cdef np.uint32_t indexes[MAX_SENTENCE_LEN]</pre>
<pre id='line666' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line667")'> 667:     cdef int sentence_idx[MAX_SENTENCE_LEN + 1]</pre>
<pre id='line667' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line668")'> 668:     cdef REAL_t sentence_label[MAX_SENTENCE_LEN + 1]</pre>
<pre id='line668' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line669")'> 669:     cdef int window = model.window</pre>
<pre id='line669' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_window);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 669; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 669; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_window = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line670")'> 670: </pre>
<pre id='line670' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line671")'> 671:     cdef int i, j</pre>
<pre id='line671' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line672")'> 672:     cdef int effective_words = 0, effective_sentences = 0, sent_words = 0</pre>
<pre id='line672' class='code' style='background-color: #FFFFff'>  __pyx_v_effective_words = 0;
  __pyx_v_effective_sentences = 0;
  __pyx_v_sent_words = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line673")'> 673:     cdef int sent_idx, idx_start, idx_end</pre>
<pre id='line673' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line674")'> 674: </pre>
<pre id='line674' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line675")'> 675:     # for sampling (negative and frequent-word downsampling)</pre>
<pre id='line675' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line676")'> 676:     cdef unsigned long long next_random, this_random</pre>
<pre id='line676' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line677")'> 677:     next_random = (2**24) * model.random.randint(0, 2**24) + model.random.randint(0, 2**24)</pre>
<pre id='line677' class='code' style='background-color: #FFFF31'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple__3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_int_16777216, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
/* … */
  __pyx_tuple__3 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple__3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_tuple__4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_PY_LONG_LONG</span>(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_6 == (unsigned PY_LONG_LONG)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_next_random = __pyx_t_6;
  __pyx_tuple__4 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple__4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line678")'> 678: </pre>
<pre id='line678' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line679")'> 679:     cdef REAL_t *w1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['w1']))</pre>
<pre id='line679' class='code' style='background-color: #FFFF73'>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, __pyx_n_s_w1);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_w1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_2)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line680")'> 680:     cdef REAL_t *b1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['b1']))</pre>
<pre id='line680' class='code' style='background-color: #FFFF73'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_2, __pyx_n_s_b1);<span class='error_goto'> if (unlikely(__pyx_t_5 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_b1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_5)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line681")'> 681:     cdef REAL_t *w2 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['w2']))</pre>
<pre id='line681' class='code' style='background-color: #FFFF73'>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, __pyx_n_s_w2);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_w2 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_2)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line682")'> 682:     cdef REAL_t *b2 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['w2']))</pre>
<pre id='line682' class='code' style='background-color: #FFFF73'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 682; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_2, __pyx_n_s_w2);<span class='error_goto'> if (unlikely(__pyx_t_5 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 682; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 682; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_b2 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_5)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line683")'> 683: </pre>
<pre id='line683' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line684")'> 684:     # convert Python structures to primitive types, so we can release the GIL</pre>
<pre id='line684' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line685")'> 685:     work = &lt;REAL_t *&gt;np.PyArray_DATA(_work)</pre>
<pre id='line685' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__work) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__work, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 685; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_work = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__work)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line686")'> 686: </pre>
<pre id='line686' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line687")'> 687:     vlookup = model.vocab</pre>
<pre id='line687' class='code' style='background-color: #FFFFd4'>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vocab);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_v_vlookup = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line688")'> 688:     sentence_idx[0] = 0</pre>
<pre id='line688' class='code' style='background-color: #FFFFff'>  (__pyx_v_sentence_idx[0]) = 0;
</pre><pre class='line' style='background-color: #FFFF17' onclick='toggleDiv("line689")'> 689:     for sent, label in sentences:</pre>
<pre id='line689' class='code' style='background-color: #FFFF17'>  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sentences) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sentences)) {
    __pyx_t_5 = __pyx_v_sentences; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sentences);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_8 = Py_TYPE(__pyx_t_5)-&gt;tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_8 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) {
      if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_8 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
      if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_7++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_2 = __pyx_t_8(__pyx_t_5);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    }
    if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
      #endif
      if (unlikely(size != 2)) {
        if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
        else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
        __pyx_t_9 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
      } else {
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
        __pyx_t_9 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_10 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_11 = Py_TYPE(__pyx_t_10)-&gt;tp_iternext;
      index = 0; __pyx_t_1 = __pyx_t_11(__pyx_t_10); if (unlikely(!__pyx_t_1)) goto __pyx_L5_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      index = 1; __pyx_t_9 = __pyx_t_11(__pyx_t_10); if (unlikely(!__pyx_t_9)) goto __pyx_L5_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_11(__pyx_t_10), 2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_11 = NULL;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      goto __pyx_L6_unpacking_done;
      __pyx_L5_unpacking_failed:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_11 = NULL;
      if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_L6_unpacking_done:;
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_sent, __pyx_t_1);
    __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_label, __pyx_t_9);
    __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line690")'> 690:         if not sent : # ignore empty sentences; leave effective_sentences unchanged</pre>
<pre id='line690' class='code' style='background-color: #FFFFd4'>    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(__pyx_t_12 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 690; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_13 = ((!__pyx_t_12) != 0);
    if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line691")'> 691:             continue</pre>
<pre id='line691' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line692")'> 692:         for token in sent:</pre>
<pre id='line692' class='code' style='background-color: #FFFF2a'>    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sent) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sent)) {
      __pyx_t_2 = __pyx_v_sent; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_14 = 0;
      __pyx_t_15 = NULL;
    } else {
      __pyx_t_14 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 692; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_15 = Py_TYPE(__pyx_t_2)-&gt;tp_iternext;
    }
    for (;;) {
      if (!__pyx_t_15 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_14 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_9 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_14); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_14++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 692; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_14); __pyx_t_14++;<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 692; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_15 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_14 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_9 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_14); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_14++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 692; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_14); __pyx_t_14++;<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 692; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_9 = __pyx_t_15(__pyx_t_2);
        if (unlikely(!__pyx_t_9)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 692; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_token, __pyx_t_9);
      __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line693")'> 693:             word = vlookup[token] if token in vlookup else None</pre>
<pre id='line693' class='code' style='background-color: #FFFF86'>      __pyx_t_13 = (<span class='pyx_c_api'>__Pyx_PySequence_Contains</span>(__pyx_v_token, __pyx_v_vlookup, Py_EQ));<span class='error_goto'> if (unlikely(__pyx_t_13 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      if ((__pyx_t_13 != 0)) {
        __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_vlookup, __pyx_v_token);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_9 = __pyx_t_1;
        __pyx_t_1 = 0;
      } else {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        __pyx_t_9 = Py_None;
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_word, __pyx_t_9);
      __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line694")'> 694:             this_random = random_int32(&amp;next_random)</pre>
<pre id='line694' class='code' style='background-color: #FFFFff'>      __pyx_v_this_random = __pyx_f_14word2vec_inner_random_int32((&amp;__pyx_v_next_random));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line695")'> 695:             if word is None:</pre>
<pre id='line695' class='code' style='background-color: #FFFFff'>      __pyx_t_13 = (__pyx_v_word == Py_None);
      __pyx_t_12 = (__pyx_t_13 != 0);
      if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line696")'> 696:                 continue</pre>
<pre id='line696' class='code' style='background-color: #FFFFff'>        goto __pyx_L8_continue;
      }
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line697")'> 697:             if sample and word.sample_int &lt; this_random:</pre>
<pre id='line697' class='code' style='background-color: #FFFF6a'>      if ((__pyx_v_sample != 0)) {
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_sample_int);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_PY_LONG_LONG</span>(__pyx_v_this_random);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_10 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_9, __pyx_t_1, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(__pyx_t_12 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_13 = __pyx_t_12;
      } else {
        __pyx_t_13 = (__pyx_v_sample != 0);
      }
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line698")'> 698:                 continue</pre>
<pre id='line698' class='code' style='background-color: #FFFFff'>        goto __pyx_L8_continue;
      }
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line699")'> 699:             indexes[effective_words] = word.index</pre>
<pre id='line699' class='code' style='background-color: #FFFFc4'>      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_index);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_16 = __Pyx_PyInt_As_npy_uint32(__pyx_t_10);<span class='error_goto'> if (unlikely((__pyx_t_16 == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      (__pyx_v_indexes[__pyx_v_effective_words]) = __pyx_t_16;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line700")'> 700:             effective_words += 1</pre>
<pre id='line700' class='code' style='background-color: #FFFFff'>      __pyx_v_effective_words = (__pyx_v_effective_words + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line701")'> 701:             if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line701' class='code' style='background-color: #FFFFff'>      __pyx_t_13 = ((__pyx_v_effective_words == 10000) != 0);
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line702")'> 702:                 break</pre>
<pre id='line702' class='code' style='background-color: #FFFFe7'>        goto __pyx_L9_break;
      }
      __pyx_L8_continue:;
    }
    __pyx_L9_break:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line703")'> 703:         sentence_label[effective_sentences] = &lt;REAL_t&gt; label</pre>
<pre id='line703' class='code' style='background-color: #FFFFaa'>    __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_label);<span class='error_goto'> if (unlikely((__pyx_t_4 == (npy_float32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 703; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_sentence_label[__pyx_v_effective_sentences]) = ((__pyx_t_14word2vec_inner_REAL_t)__pyx_t_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line704")'> 704:         effective_sentences += 1</pre>
<pre id='line704' class='code' style='background-color: #FFFFff'>    __pyx_v_effective_sentences = (__pyx_v_effective_sentences + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line705")'> 705:         sentence_idx[effective_sentences] = effective_words</pre>
<pre id='line705' class='code' style='background-color: #FFFFff'>    (__pyx_v_sentence_idx[__pyx_v_effective_sentences]) = __pyx_v_effective_words;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line706")'> 706:         #print("label:",label)</pre>
<pre id='line706' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line707")'> 707:         if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line707' class='code' style='background-color: #FFFFff'>    __pyx_t_13 = ((__pyx_v_effective_words == 10000) != 0);
    if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line708")'> 708:             break</pre>
<pre id='line708' class='code' style='background-color: #FFFFe7'>      goto __pyx_L4_break;
    }
    __pyx_L3_continue:;
  }
  __pyx_L4_break:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line709")'> 709: </pre>
<pre id='line709' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line710")'> 710:     with nogil:</pre>
<pre id='line710' class='code' style='background-color: #FFFFff'>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L16;
        }
        __pyx_L16:;
      }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line711")'> 711:         for sent_idx in range(effective_sentences):</pre>
<pre id='line711' class='code' style='background-color: #FFFFff'>        __pyx_t_3 = __pyx_v_effective_sentences;
        for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_3; __pyx_t_17+=1) {
          __pyx_v_sent_idx = __pyx_t_17;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line712")'> 712:             idx_start = sentence_idx[sent_idx]</pre>
<pre id='line712' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_start = (__pyx_v_sentence_idx[__pyx_v_sent_idx]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line713")'> 713:             idx_end = sentence_idx[sent_idx + 1]</pre>
<pre id='line713' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_end = (__pyx_v_sentence_idx[(__pyx_v_sent_idx + 1)]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line714")'> 714:             if (idx_end-idx_start)&gt;=window:</pre>
<pre id='line714' class='code' style='background-color: #FFFFff'>          __pyx_t_13 = (((__pyx_v_idx_end - __pyx_v_idx_start) &gt;= __pyx_v_window) != 0);
          if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line715")'> 715:                 for i in range(idx_start,idx_end - window + 1):</pre>
<pre id='line715' class='code' style='background-color: #FFFFff'>            __pyx_t_18 = ((__pyx_v_idx_end - __pyx_v_window) + 1);
            for (__pyx_t_19 = __pyx_v_idx_start; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
              __pyx_v_i = __pyx_t_19;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line716")'> 716:                     j = i + window</pre>
<pre id='line716' class='code' style='background-color: #FFFFff'>              __pyx_v_j = (__pyx_v_i + __pyx_v_window);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line717")'> 717:                     fast_sentence_sswe_bow(sentence_label[sent_idx],syn0, layer1_size, vector_size, window, nclass, indexes, _alpha, work, i, j, word_locks, w1, b1, w2, b2)</pre>
<pre id='line717' class='code' style='background-color: #FFFFff'>              __pyx_f_14word2vec_inner_fast_sentence_sswe_bow((__pyx_v_sentence_label[__pyx_v_sent_idx]), __pyx_v_syn0, __pyx_v_layer1_size, __pyx_v_vector_size, __pyx_v_window, __pyx_v_nclass, __pyx_v_indexes, __pyx_v__alpha, __pyx_v_work, __pyx_v_i, __pyx_v_j, __pyx_v_word_locks, __pyx_v_w1, __pyx_v_b1, __pyx_v_w2, __pyx_v_b2);
            }
            goto __pyx_L19;
          }
          __pyx_L19:;
        }
      }
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line718")'> 718:     return effective_words</pre>
<pre id='line718' class='code' style='background-color: #FFFFc4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_effective_words);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line719")'> 719: </pre>
<pre id='line719' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line720")'> 720: def train_batch_sg(model, sentences, alpha, _work):</pre>
<pre id='line720' class='code' style='background-color: #FFFF1e'>/* Python wrapper */
static PyObject *__pyx_pw_14word2vec_inner_5train_batch_sg(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_14word2vec_inner_5train_batch_sg = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("train_batch_sg"), (PyCFunction)__pyx_pw_14word2vec_inner_5train_batch_sg, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_14word2vec_inner_5train_batch_sg(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_model = 0;
  PyObject *__pyx_v_sentences = 0;
  PyObject *__pyx_v_alpha = 0;
  PyObject *__pyx_v__work = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_sg (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_sentences,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_work,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_sentences)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sg", 1, 4, 4, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sg", 1, 4, 4, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_work)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sg", 1, 4, 4, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "train_batch_sg") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_model = values[0];
    __pyx_v_sentences = values[1];
    __pyx_v_alpha = values[2];
    __pyx_v__work = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_sg", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_sg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_14word2vec_inner_4train_batch_sg(__pyx_self, __pyx_v_model, __pyx_v_sentences, __pyx_v_alpha, __pyx_v__work);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_14word2vec_inner_4train_batch_sg(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_model, PyObject *__pyx_v_sentences, PyObject *__pyx_v_alpha, PyObject *__pyx_v__work) {
  int __pyx_v_hs;
  int __pyx_v_negative;
  int __pyx_v_sample;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v__alpha;
  int __pyx_v_size;
  int __pyx_v_codelens[10000];
  __pyx_t_5numpy_uint32_t __pyx_v_indexes[10000];
  __pyx_t_5numpy_uint32_t __pyx_v_reduced_windows[10000];
  int __pyx_v_sentence_idx[(10000 + 1)];
  int __pyx_v_window;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  int __pyx_v_effective_words;
  int __pyx_v_effective_sentences;
  int __pyx_v_sent_idx;
  int __pyx_v_idx_start;
  int __pyx_v_idx_end;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1;
  __pyx_t_5numpy_uint32_t *__pyx_v_points[10000];
  __pyx_t_5numpy_uint8_t *__pyx_v_codes[10000];
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1neg;
  __pyx_t_5numpy_uint32_t *__pyx_v_cum_table;
  unsigned PY_LONG_LONG __pyx_v_cum_table_len;
  unsigned PY_LONG_LONG __pyx_v_next_random;
  PyObject *__pyx_v_vlookup = NULL;
  PyObject *__pyx_v_sent = NULL;
  PyObject *__pyx_v_token = NULL;
  PyObject *__pyx_v_word = NULL;
  PyObject *__pyx_v_item = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_sg", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_sg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vlookup);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sent);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_token);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_word);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_item);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__22 = <span class='py_c_api'>PyTuple_Pack</span>(37, __pyx_n_s_model, __pyx_n_s_sentences, __pyx_n_s_alpha, __pyx_n_s_work, __pyx_n_s_hs, __pyx_n_s_negative, __pyx_n_s_sample, __pyx_n_s_syn0, __pyx_n_s_word_locks, __pyx_n_s_work_2, __pyx_n_s_alpha_2, __pyx_n_s_size, __pyx_n_s_codelens, __pyx_n_s_indexes, __pyx_n_s_reduced_windows, __pyx_n_s_sentence_idx, __pyx_n_s_window, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_effective_words, __pyx_n_s_effective_sentences, __pyx_n_s_sent_idx, __pyx_n_s_idx_start, __pyx_n_s_idx_end, __pyx_n_s_syn1, __pyx_n_s_points, __pyx_n_s_codes, __pyx_n_s_syn1neg, __pyx_n_s_cum_table, __pyx_n_s_cum_table_len, __pyx_n_s_next_random, __pyx_n_s_vlookup, __pyx_n_s_sent, __pyx_n_s_token, __pyx_n_s_word, __pyx_n_s_item);<span class='error_goto'> if (unlikely(!__pyx_tuple__22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__22);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__22);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_14word2vec_inner_5train_batch_sg, NULL, __pyx_n_s_word2vec_inner);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_train_batch_sg, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__23 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 37, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__22, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_home_slcf_saerom_word2vec_codes, __pyx_n_s_train_batch_sg, 720, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line721")'> 721:     cdef int hs = model.hs</pre>
<pre id='line721' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_hs);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 721; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 721; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_hs = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line722")'> 722:     cdef int negative = model.negative</pre>
<pre id='line722' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_negative);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_negative = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line723")'> 723:     cdef int sample = (model.sample != 0)</pre>
<pre id='line723' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_sample);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_int_0, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_sample = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line724")'> 724: </pre>
<pre id='line724' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line725")'> 725:     cdef REAL_t *syn0 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0))</pre>
<pre id='line725' class='code' style='background-color: #FFFF9f'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_syn0 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line726")'> 726:     cdef REAL_t *word_locks = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0_lockf))</pre>
<pre id='line726' class='code' style='background-color: #FFFF9f'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0_lockf);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 726; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 726; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_word_locks = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line727")'> 727:     cdef REAL_t *work</pre>
<pre id='line727' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line728")'> 728:     cdef REAL_t _alpha = alpha</pre>
<pre id='line728' class='code' style='background-color: #FFFFaa'>  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_alpha);<span class='error_goto'> if (unlikely((__pyx_t_4 == (npy_float32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 728; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v__alpha = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line729")'> 729:     cdef int size = model.layer1_size</pre>
<pre id='line729' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_layer1_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_size = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line730")'> 730: </pre>
<pre id='line730' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line731")'> 731:     cdef int codelens[MAX_SENTENCE_LEN]</pre>
<pre id='line731' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line732")'> 732:     cdef np.uint32_t indexes[MAX_SENTENCE_LEN]</pre>
<pre id='line732' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line733")'> 733:     cdef np.uint32_t reduced_windows[MAX_SENTENCE_LEN]</pre>
<pre id='line733' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line734")'> 734:     cdef int sentence_idx[MAX_SENTENCE_LEN + 1]</pre>
<pre id='line734' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line735")'> 735:     cdef int window = model.window</pre>
<pre id='line735' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_window);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_window = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line736")'> 736: </pre>
<pre id='line736' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line737")'> 737:     cdef int i, j, k</pre>
<pre id='line737' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line738")'> 738:     cdef int effective_words = 0, effective_sentences = 0</pre>
<pre id='line738' class='code' style='background-color: #FFFFff'>  __pyx_v_effective_words = 0;
  __pyx_v_effective_sentences = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line739")'> 739:     cdef int sent_idx, idx_start, idx_end</pre>
<pre id='line739' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line740")'> 740: </pre>
<pre id='line740' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line741")'> 741:     # For hierarchical softmax</pre>
<pre id='line741' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line742")'> 742:     cdef REAL_t *syn1</pre>
<pre id='line742' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line743")'> 743:     cdef np.uint32_t *points[MAX_SENTENCE_LEN]</pre>
<pre id='line743' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line744")'> 744:     cdef np.uint8_t *codes[MAX_SENTENCE_LEN]</pre>
<pre id='line744' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line745")'> 745: </pre>
<pre id='line745' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line746")'> 746:     # For negative sampling</pre>
<pre id='line746' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line747")'> 747:     cdef REAL_t *syn1neg</pre>
<pre id='line747' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line748")'> 748:     cdef np.uint32_t *cum_table</pre>
<pre id='line748' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line749")'> 749:     cdef unsigned long long cum_table_len</pre>
<pre id='line749' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line750")'> 750:     # for sampling (negative and frequent-word downsampling)</pre>
<pre id='line750' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line751")'> 751:     cdef unsigned long long next_random</pre>
<pre id='line751' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line752")'> 752: </pre>
<pre id='line752' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line753")'> 753:     if hs:</pre>
<pre id='line753' class='code' style='background-color: #FFFFff'>  __pyx_t_5 = (__pyx_v_hs != 0);
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line754")'> 754:         syn1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn1))</pre>
<pre id='line754' class='code' style='background-color: #FFFF9f'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 754; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_syn1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line755")'> 755: </pre>
<pre id='line755' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line756")'> 756:     if negative:</pre>
<pre id='line756' class='code' style='background-color: #FFFFff'>  __pyx_t_5 = (__pyx_v_negative != 0);
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line757")'> 757:         syn1neg = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn1neg))</pre>
<pre id='line757' class='code' style='background-color: #FFFF9f'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn1neg);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_syn1neg = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line758")'> 758:         cum_table = &lt;np.uint32_t *&gt;(np.PyArray_DATA(model.cum_table))</pre>
<pre id='line758' class='code' style='background-color: #FFFF9f'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_cum_table);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 758; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 758; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_cum_table = ((__pyx_t_5numpy_uint32_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line759")'> 759:         cum_table_len = len(model.cum_table)</pre>
<pre id='line759' class='code' style='background-color: #FFFF8d'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_cum_table);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_cum_table_len = __pyx_t_6;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line760")'> 760:     if negative or sample:</pre>
<pre id='line760' class='code' style='background-color: #FFFFff'>  if (!(__pyx_v_negative != 0)) {
    __pyx_t_5 = (__pyx_v_sample != 0);
  } else {
    __pyx_t_5 = (__pyx_v_negative != 0);
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line761")'> 761:         next_random = (2**24) * model.random.randint(0, 2**24) + model.random.randint(0, 2**24)</pre>
<pre id='line761' class='code' style='background-color: #FFFF31'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple__5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_int_16777216, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
  __pyx_tuple__5 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple__5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__5);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_tuple__6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_PY_LONG_LONG</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_8 == (unsigned PY_LONG_LONG)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_v_next_random = __pyx_t_8;
    goto __pyx_L5;
  }
  __pyx_L5:;
  __pyx_tuple__6 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple__6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__6);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line762")'> 762: </pre>
<pre id='line762' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line763")'> 763:     # convert Python structures to primitive types, so we can release the GIL</pre>
<pre id='line763' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line764")'> 764:     work = &lt;REAL_t *&gt;np.PyArray_DATA(_work)</pre>
<pre id='line764' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__work) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__work, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 764; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_work = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__work)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line765")'> 765: </pre>
<pre id='line765' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line766")'> 766:     # prepare C structures so we can go "full C" and release the Python GIL</pre>
<pre id='line766' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line767")'> 767:     vlookup = model.vocab</pre>
<pre id='line767' class='code' style='background-color: #FFFFd4'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vocab);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_v_vlookup = __pyx_t_7;
  __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line768")'> 768:     sentence_idx[0] = 0  # indices of the first sentence always start at 0</pre>
<pre id='line768' class='code' style='background-color: #FFFFff'>  (__pyx_v_sentence_idx[0]) = 0;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line769")'> 769:     for sent in sentences:</pre>
<pre id='line769' class='code' style='background-color: #FFFF2a'>  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sentences) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sentences)) {
    __pyx_t_7 = __pyx_v_sentences; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_6 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_7 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sentences);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_9 = Py_TYPE(__pyx_t_7)-&gt;tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_7)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_7)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_7, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_7, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_7)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_7)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_7, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_7, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_3 = __pyx_t_9(__pyx_t_7);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_sent, __pyx_t_3);
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line770")'> 770:         if not sent:</pre>
<pre id='line770' class='code' style='background-color: #FFFFd4'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(__pyx_t_5 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_10 = ((!__pyx_t_5) != 0);
    if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line771")'> 771:             continue  # ignore empty sentences; leave effective_sentences unchanged</pre>
<pre id='line771' class='code' style='background-color: #FFFFff'>      goto __pyx_L6_continue;
    }
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line772")'> 772:         for token in sent:</pre>
<pre id='line772' class='code' style='background-color: #FFFF2a'>    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sent) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sent)) {
      __pyx_t_3 = __pyx_v_sent; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_11 = 0;
      __pyx_t_12 = NULL;
    } else {
      __pyx_t_11 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_12 = Py_TYPE(__pyx_t_3)-&gt;tp_iternext;
    }
    for (;;) {
      if (!__pyx_t_12 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_11 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_11); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_11++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_11); __pyx_t_11++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_12 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_11 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_11); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_11++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_11); __pyx_t_11++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_1 = __pyx_t_12(__pyx_t_3);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_token, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line773")'> 773:             word = vlookup[token] if token in vlookup else None</pre>
<pre id='line773' class='code' style='background-color: #FFFF86'>      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PySequence_Contains</span>(__pyx_v_token, __pyx_v_vlookup, Py_EQ));<span class='error_goto'> if (unlikely(__pyx_t_10 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      if ((__pyx_t_10 != 0)) {
        __pyx_t_13 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_vlookup, __pyx_v_token);<span class='error_goto'> if (unlikely(__pyx_t_13 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        __pyx_t_1 = __pyx_t_13;
        __pyx_t_13 = 0;
      } else {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        __pyx_t_1 = Py_None;
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_word, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line774")'> 774:             if word is None:</pre>
<pre id='line774' class='code' style='background-color: #FFFFff'>      __pyx_t_10 = (__pyx_v_word == Py_None);
      __pyx_t_5 = (__pyx_t_10 != 0);
      if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line775")'> 775:                 continue  # leaving `effective_words` unchanged = shortening the sentence = expanding the window</pre>
<pre id='line775' class='code' style='background-color: #FFFFff'>        goto __pyx_L9_continue;
      }
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line776")'> 776:             if sample and word.sample_int &lt; random_int32(&amp;next_random):</pre>
<pre id='line776' class='code' style='background-color: #FFFF6a'>      if ((__pyx_v_sample != 0)) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_sample_int);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_PY_LONG_LONG</span>(__pyx_f_14word2vec_inner_random_int32((&amp;__pyx_v_next_random)));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        __pyx_t_14 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_t_13, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(__pyx_t_5 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_10 = __pyx_t_5;
      } else {
        __pyx_t_10 = (__pyx_v_sample != 0);
      }
      if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line777")'> 777:                 continue</pre>
<pre id='line777' class='code' style='background-color: #FFFFff'>        goto __pyx_L9_continue;
      }
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line778")'> 778:             indexes[effective_words] = word.index</pre>
<pre id='line778' class='code' style='background-color: #FFFFc4'>      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_index);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 778; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      __pyx_t_15 = __Pyx_PyInt_As_npy_uint32(__pyx_t_14);<span class='error_goto'> if (unlikely((__pyx_t_15 == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 778; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      (__pyx_v_indexes[__pyx_v_effective_words]) = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line779")'> 779:             if hs:</pre>
<pre id='line779' class='code' style='background-color: #FFFFff'>      __pyx_t_10 = (__pyx_v_hs != 0);
      if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line780")'> 780:                 codelens[effective_words] = &lt;int&gt;len(word.code)</pre>
<pre id='line780' class='code' style='background-color: #FFFF8d'>        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        __pyx_t_16 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(__pyx_t_16 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        (__pyx_v_codelens[__pyx_v_effective_words]) = ((int)__pyx_t_16);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line781")'> 781:                 codes[effective_words] = &lt;np.uint8_t *&gt;np.PyArray_DATA(word.code)</pre>
<pre id='line781' class='code' style='background-color: #FFFF9f'>        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        if (!(likely(((__pyx_t_14) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_14, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        (__pyx_v_codes[__pyx_v_effective_words]) = ((__pyx_t_5numpy_uint8_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_14)));
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line782")'> 782:                 points[effective_words] = &lt;np.uint32_t *&gt;np.PyArray_DATA(word.point)</pre>
<pre id='line782' class='code' style='background-color: #FFFF9f'>        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_point);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        if (!(likely(((__pyx_t_14) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_14, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        (__pyx_v_points[__pyx_v_effective_words]) = ((__pyx_t_5numpy_uint32_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_14)));
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        goto __pyx_L13;
      }
      __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line783")'> 783:             effective_words += 1</pre>
<pre id='line783' class='code' style='background-color: #FFFFff'>      __pyx_v_effective_words = (__pyx_v_effective_words + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line784")'> 784:             if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line784' class='code' style='background-color: #FFFFff'>      __pyx_t_10 = ((__pyx_v_effective_words == 10000) != 0);
      if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line785")'> 785:                 break  # TODO: log warning, tally overflow?</pre>
<pre id='line785' class='code' style='background-color: #FFFFe7'>        goto __pyx_L10_break;
      }
      __pyx_L9_continue:;
    }
    __pyx_L10_break:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line786")'> 786: </pre>
<pre id='line786' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line787")'> 787:         # keep track of which words go into which sentence, so we don't train</pre>
<pre id='line787' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line788")'> 788:         # across sentence boundaries.</pre>
<pre id='line788' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line789")'> 789:         # indices of sentence number X are between &lt;sentence_idx[X], sentence_idx[X])</pre>
<pre id='line789' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line790")'> 790:         effective_sentences += 1</pre>
<pre id='line790' class='code' style='background-color: #FFFFff'>    __pyx_v_effective_sentences = (__pyx_v_effective_sentences + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line791")'> 791:         sentence_idx[effective_sentences] = effective_words</pre>
<pre id='line791' class='code' style='background-color: #FFFFff'>    (__pyx_v_sentence_idx[__pyx_v_effective_sentences]) = __pyx_v_effective_words;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line792")'> 792: </pre>
<pre id='line792' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line793")'> 793:         if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line793' class='code' style='background-color: #FFFFff'>    __pyx_t_10 = ((__pyx_v_effective_words == 10000) != 0);
    if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line794")'> 794:             break  # TODO: log warning, tally overflow?</pre>
<pre id='line794' class='code' style='background-color: #FFFFe7'>      goto __pyx_L7_break;
    }
    __pyx_L6_continue:;
  }
  __pyx_L7_break:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line795")'> 795: </pre>
<pre id='line795' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line796")'> 796:     # precompute "reduced window" offsets in a single randint() call</pre>
<pre id='line796' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line797")'> 797:     for i, item in enumerate(model.random.randint(0, window, effective_words)):</pre>
<pre id='line797' class='code' style='background-color: #FFFF1e'>  __pyx_t_2 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_effective_words);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 2, __pyx_t_14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
  __pyx_t_7 = 0;
  __pyx_t_14 = 0;
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_14) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_14)) {
    __pyx_t_13 = __pyx_t_14; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13); __pyx_t_6 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_13 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_9 = Py_TYPE(__pyx_t_13)-&gt;tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  for (;;) {
    if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_13)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_13)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_14 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_13, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_14 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_13, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_13)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_13)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_14 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_13, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_14 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_13, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_14 = __pyx_t_9(__pyx_t_13);
      if (unlikely(!__pyx_t_14)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_item, __pyx_t_14);
    __pyx_t_14 = 0;
    __pyx_v_i = __pyx_t_2;
    __pyx_t_2 = (__pyx_t_2 + 1);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line798")'> 798:         reduced_windows[i] = item</pre>
<pre id='line798' class='code' style='background-color: #FFFFe7'>    __pyx_t_15 = __Pyx_PyInt_As_npy_uint32(__pyx_v_item);<span class='error_goto'> if (unlikely((__pyx_t_15 == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_reduced_windows[__pyx_v_i]) = __pyx_t_15;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line799")'> 799: </pre>
<pre id='line799' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line800")'> 800:     # release GIL &amp; train on all sentences</pre>
<pre id='line800' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line801")'> 801:     with nogil:</pre>
<pre id='line801' class='code' style='background-color: #FFFFff'>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L20;
        }
        __pyx_L20:;
      }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line802")'> 802:         for sent_idx in range(effective_sentences):</pre>
<pre id='line802' class='code' style='background-color: #FFFFff'>        __pyx_t_2 = __pyx_v_effective_sentences;
        for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_2; __pyx_t_17+=1) {
          __pyx_v_sent_idx = __pyx_t_17;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line803")'> 803:             idx_start = sentence_idx[sent_idx]</pre>
<pre id='line803' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_start = (__pyx_v_sentence_idx[__pyx_v_sent_idx]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line804")'> 804:             idx_end = sentence_idx[sent_idx + 1]</pre>
<pre id='line804' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_end = (__pyx_v_sentence_idx[(__pyx_v_sent_idx + 1)]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line805")'> 805:             for i in range(idx_start, idx_end):</pre>
<pre id='line805' class='code' style='background-color: #FFFFff'>          __pyx_t_18 = __pyx_v_idx_end;
          for (__pyx_t_19 = __pyx_v_idx_start; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
            __pyx_v_i = __pyx_t_19;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line806")'> 806:                 j = i - window + reduced_windows[i]</pre>
<pre id='line806' class='code' style='background-color: #FFFFff'>            __pyx_v_j = ((__pyx_v_i - __pyx_v_window) + (__pyx_v_reduced_windows[__pyx_v_i]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line807")'> 807:                 if j &lt; idx_start:</pre>
<pre id='line807' class='code' style='background-color: #FFFFff'>            __pyx_t_10 = ((__pyx_v_j &lt; __pyx_v_idx_start) != 0);
            if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line808")'> 808:                     j = idx_start</pre>
<pre id='line808' class='code' style='background-color: #FFFFff'>              __pyx_v_j = __pyx_v_idx_start;
              goto __pyx_L25;
            }
            __pyx_L25:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line809")'> 809:                 k = i + window + 1 - reduced_windows[i]</pre>
<pre id='line809' class='code' style='background-color: #FFFFff'>            __pyx_v_k = (((__pyx_v_i + __pyx_v_window) + 1) - (__pyx_v_reduced_windows[__pyx_v_i]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line810")'> 810:                 if k &gt; idx_end:</pre>
<pre id='line810' class='code' style='background-color: #FFFFff'>            __pyx_t_10 = ((__pyx_v_k &gt; __pyx_v_idx_end) != 0);
            if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line811")'> 811:                     k = idx_end</pre>
<pre id='line811' class='code' style='background-color: #FFFFff'>              __pyx_v_k = __pyx_v_idx_end;
              goto __pyx_L26;
            }
            __pyx_L26:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line812")'> 812:                 for j in range(j, k):</pre>
<pre id='line812' class='code' style='background-color: #FFFFff'>            __pyx_t_20 = __pyx_v_k;
            for (__pyx_t_21 = __pyx_v_j; __pyx_t_21 &lt; __pyx_t_20; __pyx_t_21+=1) {
              __pyx_v_j = __pyx_t_21;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line813")'> 813:                     if j == i:</pre>
<pre id='line813' class='code' style='background-color: #FFFFff'>              __pyx_t_10 = ((__pyx_v_j == __pyx_v_i) != 0);
              if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line814")'> 814:                         continue</pre>
<pre id='line814' class='code' style='background-color: #FFFFff'>                goto __pyx_L27_continue;
              }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line815")'> 815:                     if hs:</pre>
<pre id='line815' class='code' style='background-color: #FFFFff'>              __pyx_t_10 = (__pyx_v_hs != 0);
              if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line816")'> 816:                         fast_sentence_sg_hs(points[i], codes[i], codelens[i], syn0, syn1, size, indexes[j], _alpha, work, word_locks)</pre>
<pre id='line816' class='code' style='background-color: #FFFFff'>                __pyx_f_14word2vec_inner_fast_sentence_sg_hs((__pyx_v_points[__pyx_v_i]), (__pyx_v_codes[__pyx_v_i]), (__pyx_v_codelens[__pyx_v_i]), __pyx_v_syn0, __pyx_v_syn1, __pyx_v_size, (__pyx_v_indexes[__pyx_v_j]), __pyx_v__alpha, __pyx_v_work, __pyx_v_word_locks);
                goto __pyx_L30;
              }
              __pyx_L30:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line817")'> 817:                     if negative:</pre>
<pre id='line817' class='code' style='background-color: #FFFFff'>              __pyx_t_10 = (__pyx_v_negative != 0);
              if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line818")'> 818:                         next_random = fast_sentence_sg_neg(negative, cum_table, cum_table_len, syn0, syn1neg, size, indexes[i], indexes[j], _alpha, work, next_random, word_locks)</pre>
<pre id='line818' class='code' style='background-color: #FFFFff'>                __pyx_v_next_random = __pyx_f_14word2vec_inner_fast_sentence_sg_neg(__pyx_v_negative, __pyx_v_cum_table, __pyx_v_cum_table_len, __pyx_v_syn0, __pyx_v_syn1neg, __pyx_v_size, (__pyx_v_indexes[__pyx_v_i]), (__pyx_v_indexes[__pyx_v_j]), __pyx_v__alpha, __pyx_v_work, __pyx_v_next_random, __pyx_v_word_locks);
                goto __pyx_L31;
              }
              __pyx_L31:;
              __pyx_L27_continue:;
            }
          }
        }
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line819")'> 819: </pre>
<pre id='line819' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line820")'> 820:     return effective_words</pre>
<pre id='line820' class='code' style='background-color: #FFFFc4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_effective_words);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_r = __pyx_t_13;
  __pyx_t_13 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line821")'> 821: </pre>
<pre id='line821' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1b' onclick='toggleDiv("line822")'> 822: def train_batch_cbow(model, sentences, alpha, _work, _neu1):</pre>
<pre id='line822' class='code' style='background-color: #FFFF1b'>/* Python wrapper */
static PyObject *__pyx_pw_14word2vec_inner_7train_batch_cbow(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_14word2vec_inner_7train_batch_cbow = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("train_batch_cbow"), (PyCFunction)__pyx_pw_14word2vec_inner_7train_batch_cbow, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_14word2vec_inner_7train_batch_cbow(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_model = 0;
  PyObject *__pyx_v_sentences = 0;
  PyObject *__pyx_v_alpha = 0;
  PyObject *__pyx_v__work = 0;
  PyObject *__pyx_v__neu1 = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_cbow (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_sentences,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_work,&amp;__pyx_n_s_neu1,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_sentences)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow", 1, 5, 5, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow", 1, 5, 5, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_work)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow", 1, 5, 5, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_neu1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow", 1, 5, 5, 4); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "train_batch_cbow") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_model = values[0];
    __pyx_v_sentences = values[1];
    __pyx_v_alpha = values[2];
    __pyx_v__work = values[3];
    __pyx_v__neu1 = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_cbow", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_14word2vec_inner_6train_batch_cbow(__pyx_self, __pyx_v_model, __pyx_v_sentences, __pyx_v_alpha, __pyx_v__work, __pyx_v__neu1);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_14word2vec_inner_6train_batch_cbow(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_model, PyObject *__pyx_v_sentences, PyObject *__pyx_v_alpha, PyObject *__pyx_v__work, PyObject *__pyx_v__neu1) {
  int __pyx_v_hs;
  int __pyx_v_negative;
  int __pyx_v_sample;
  int __pyx_v_cbow_mean;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v__alpha;
  int __pyx_v_size;
  int __pyx_v_codelens[10000];
  __pyx_t_5numpy_uint32_t __pyx_v_indexes[10000];
  __pyx_t_5numpy_uint32_t __pyx_v_reduced_windows[10000];
  int __pyx_v_sentence_idx[(10000 + 1)];
  int __pyx_v_window;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  int __pyx_v_effective_words;
  int __pyx_v_effective_sentences;
  int __pyx_v_sent_idx;
  int __pyx_v_idx_start;
  int __pyx_v_idx_end;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1;
  __pyx_t_5numpy_uint32_t *__pyx_v_points[10000];
  __pyx_t_5numpy_uint8_t *__pyx_v_codes[10000];
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1neg;
  __pyx_t_5numpy_uint32_t *__pyx_v_cum_table;
  unsigned PY_LONG_LONG __pyx_v_cum_table_len;
  unsigned PY_LONG_LONG __pyx_v_next_random;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu1;
  PyObject *__pyx_v_vlookup = NULL;
  PyObject *__pyx_v_sent = NULL;
  PyObject *__pyx_v_token = NULL;
  PyObject *__pyx_v_word = NULL;
  PyObject *__pyx_v_item = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_cbow", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_cbow", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vlookup);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sent);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_token);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_word);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_item);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__24 = <span class='py_c_api'>PyTuple_Pack</span>(40, __pyx_n_s_model, __pyx_n_s_sentences, __pyx_n_s_alpha, __pyx_n_s_work, __pyx_n_s_neu1, __pyx_n_s_hs, __pyx_n_s_negative, __pyx_n_s_sample, __pyx_n_s_cbow_mean, __pyx_n_s_syn0, __pyx_n_s_word_locks, __pyx_n_s_work_2, __pyx_n_s_alpha_2, __pyx_n_s_size, __pyx_n_s_codelens, __pyx_n_s_indexes, __pyx_n_s_reduced_windows, __pyx_n_s_sentence_idx, __pyx_n_s_window, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_effective_words, __pyx_n_s_effective_sentences, __pyx_n_s_sent_idx, __pyx_n_s_idx_start, __pyx_n_s_idx_end, __pyx_n_s_syn1, __pyx_n_s_points, __pyx_n_s_codes, __pyx_n_s_syn1neg, __pyx_n_s_cum_table, __pyx_n_s_cum_table_len, __pyx_n_s_next_random, __pyx_n_s_neu1_2, __pyx_n_s_vlookup, __pyx_n_s_sent, __pyx_n_s_token, __pyx_n_s_word, __pyx_n_s_item);<span class='error_goto'> if (unlikely(!__pyx_tuple__24)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__24);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__24);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_14word2vec_inner_7train_batch_cbow, NULL, __pyx_n_s_word2vec_inner);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_train_batch_cbow, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__25 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 40, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__24, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_home_slcf_saerom_word2vec_codes, __pyx_n_s_train_batch_cbow, 822, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line823")'> 823:     cdef int hs = model.hs</pre>
<pre id='line823' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_hs);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_hs = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line824")'> 824:     cdef int negative = model.negative</pre>
<pre id='line824' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_negative);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_negative = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line825")'> 825:     cdef int sample = (model.sample != 0)</pre>
<pre id='line825' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_sample);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_int_0, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_sample = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line826")'> 826:     cdef int cbow_mean = model.cbow_mean</pre>
<pre id='line826' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_cbow_mean);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_cbow_mean = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line827")'> 827: </pre>
<pre id='line827' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line828")'> 828:     cdef REAL_t *syn0 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0))</pre>
<pre id='line828' class='code' style='background-color: #FFFF9f'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_syn0 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line829")'> 829:     cdef REAL_t *word_locks = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0_lockf))</pre>
<pre id='line829' class='code' style='background-color: #FFFF9f'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0_lockf);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_word_locks = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line830")'> 830:     cdef REAL_t *work</pre>
<pre id='line830' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line831")'> 831:     cdef REAL_t _alpha = alpha</pre>
<pre id='line831' class='code' style='background-color: #FFFFaa'>  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_alpha);<span class='error_goto'> if (unlikely((__pyx_t_4 == (npy_float32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 831; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v__alpha = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line832")'> 832:     cdef int size = model.layer1_size</pre>
<pre id='line832' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_layer1_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_size = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line833")'> 833: </pre>
<pre id='line833' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line834")'> 834:     cdef int codelens[MAX_SENTENCE_LEN]</pre>
<pre id='line834' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line835")'> 835:     cdef np.uint32_t indexes[MAX_SENTENCE_LEN]</pre>
<pre id='line835' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line836")'> 836:     cdef np.uint32_t reduced_windows[MAX_SENTENCE_LEN]</pre>
<pre id='line836' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line837")'> 837:     cdef int sentence_idx[MAX_SENTENCE_LEN + 1]</pre>
<pre id='line837' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line838")'> 838:     cdef int window = model.window</pre>
<pre id='line838' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_window);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_window = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line839")'> 839: </pre>
<pre id='line839' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line840")'> 840:     cdef int i, j, k</pre>
<pre id='line840' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line841")'> 841:     cdef int effective_words = 0, effective_sentences = 0</pre>
<pre id='line841' class='code' style='background-color: #FFFFff'>  __pyx_v_effective_words = 0;
  __pyx_v_effective_sentences = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line842")'> 842:     cdef int sent_idx, idx_start, idx_end</pre>
<pre id='line842' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line843")'> 843: </pre>
<pre id='line843' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line844")'> 844:     # For hierarchical softmax</pre>
<pre id='line844' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line845")'> 845:     cdef REAL_t *syn1</pre>
<pre id='line845' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line846")'> 846:     cdef np.uint32_t *points[MAX_SENTENCE_LEN]</pre>
<pre id='line846' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line847")'> 847:     cdef np.uint8_t *codes[MAX_SENTENCE_LEN]</pre>
<pre id='line847' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line848")'> 848: </pre>
<pre id='line848' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line849")'> 849:     # For negative sampling</pre>
<pre id='line849' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line850")'> 850:     cdef REAL_t *syn1neg</pre>
<pre id='line850' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line851")'> 851:     cdef np.uint32_t *cum_table</pre>
<pre id='line851' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line852")'> 852:     cdef unsigned long long cum_table_len</pre>
<pre id='line852' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line853")'> 853:     # for sampling (negative and frequent-word downsampling)</pre>
<pre id='line853' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line854")'> 854:     cdef unsigned long long next_random</pre>
<pre id='line854' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line855")'> 855: </pre>
<pre id='line855' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line856")'> 856:     if hs:</pre>
<pre id='line856' class='code' style='background-color: #FFFFff'>  __pyx_t_5 = (__pyx_v_hs != 0);
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line857")'> 857:         syn1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn1))</pre>
<pre id='line857' class='code' style='background-color: #FFFF9f'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 857; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 857; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_syn1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line858")'> 858: </pre>
<pre id='line858' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line859")'> 859:     if negative:</pre>
<pre id='line859' class='code' style='background-color: #FFFFff'>  __pyx_t_5 = (__pyx_v_negative != 0);
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line860")'> 860:         syn1neg = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn1neg))</pre>
<pre id='line860' class='code' style='background-color: #FFFF9f'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn1neg);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 860; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 860; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_syn1neg = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line861")'> 861:         cum_table = &lt;np.uint32_t *&gt;(np.PyArray_DATA(model.cum_table))</pre>
<pre id='line861' class='code' style='background-color: #FFFF9f'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_cum_table);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 861; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 861; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_cum_table = ((__pyx_t_5numpy_uint32_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line862")'> 862:         cum_table_len = len(model.cum_table)</pre>
<pre id='line862' class='code' style='background-color: #FFFF8d'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_cum_table);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 862; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 862; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_cum_table_len = __pyx_t_6;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line863")'> 863:     if negative or sample:</pre>
<pre id='line863' class='code' style='background-color: #FFFFff'>  if (!(__pyx_v_negative != 0)) {
    __pyx_t_5 = (__pyx_v_sample != 0);
  } else {
    __pyx_t_5 = (__pyx_v_negative != 0);
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line864")'> 864:         next_random = (2**24) * model.random.randint(0, 2**24) + model.random.randint(0, 2**24)</pre>
<pre id='line864' class='code' style='background-color: #FFFF31'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple__7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_int_16777216, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
  __pyx_tuple__7 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple__7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__7);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_tuple__8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_PY_LONG_LONG</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_8 == (unsigned PY_LONG_LONG)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_v_next_random = __pyx_t_8;
    goto __pyx_L5;
  }
  __pyx_L5:;
  __pyx_tuple__8 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple__8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 864; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__8);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line865")'> 865: </pre>
<pre id='line865' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line866")'> 866:     # convert Python structures to primitive types, so we can release the GIL</pre>
<pre id='line866' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line867")'> 867:     work = &lt;REAL_t *&gt;np.PyArray_DATA(_work)</pre>
<pre id='line867' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__work) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__work, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_work = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__work)));
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line868")'> 868:     neu1 = &lt;REAL_t *&gt;np.PyArray_DATA(_neu1)</pre>
<pre id='line868' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__neu1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__neu1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 868; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_neu1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__neu1)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line869")'> 869: </pre>
<pre id='line869' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line870")'> 870:     # prepare C structures so we can go "full C" and release the Python GIL</pre>
<pre id='line870' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line871")'> 871:     vlookup = model.vocab</pre>
<pre id='line871' class='code' style='background-color: #FFFFd4'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vocab);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 871; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_v_vlookup = __pyx_t_7;
  __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line872")'> 872:     sentence_idx[0] = 0  # indices of the first sentence always start at 0</pre>
<pre id='line872' class='code' style='background-color: #FFFFff'>  (__pyx_v_sentence_idx[0]) = 0;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line873")'> 873:     for sent in sentences:</pre>
<pre id='line873' class='code' style='background-color: #FFFF2a'>  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sentences) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sentences)) {
    __pyx_t_7 = __pyx_v_sentences; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_6 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_7 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sentences);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_9 = Py_TYPE(__pyx_t_7)-&gt;tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_7)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_7)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_7, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_7, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_7)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_7)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_7, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_7, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_3 = __pyx_t_9(__pyx_t_7);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_sent, __pyx_t_3);
    __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line874")'> 874:         if not sent:</pre>
<pre id='line874' class='code' style='background-color: #FFFFd4'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(__pyx_t_5 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 874; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_10 = ((!__pyx_t_5) != 0);
    if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line875")'> 875:             continue  # ignore empty sentences; leave effective_sentences unchanged</pre>
<pre id='line875' class='code' style='background-color: #FFFFff'>      goto __pyx_L6_continue;
    }
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line876")'> 876:         for token in sent:</pre>
<pre id='line876' class='code' style='background-color: #FFFF2a'>    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sent) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sent)) {
      __pyx_t_3 = __pyx_v_sent; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_11 = 0;
      __pyx_t_12 = NULL;
    } else {
      __pyx_t_11 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_12 = Py_TYPE(__pyx_t_3)-&gt;tp_iternext;
    }
    for (;;) {
      if (!__pyx_t_12 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_11 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_11); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_11++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_11); __pyx_t_11++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_12 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
        if (__pyx_t_11 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_11); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_11++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_11); __pyx_t_11++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_1 = __pyx_t_12(__pyx_t_3);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_token, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line877")'> 877:             word = vlookup[token] if token in vlookup else None</pre>
<pre id='line877' class='code' style='background-color: #FFFF86'>      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PySequence_Contains</span>(__pyx_v_token, __pyx_v_vlookup, Py_EQ));<span class='error_goto'> if (unlikely(__pyx_t_10 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 877; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      if ((__pyx_t_10 != 0)) {
        __pyx_t_13 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_vlookup, __pyx_v_token);<span class='error_goto'> if (unlikely(__pyx_t_13 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 877; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        __pyx_t_1 = __pyx_t_13;
        __pyx_t_13 = 0;
      } else {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        __pyx_t_1 = Py_None;
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_word, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line878")'> 878:             if word is None:</pre>
<pre id='line878' class='code' style='background-color: #FFFFff'>      __pyx_t_10 = (__pyx_v_word == Py_None);
      __pyx_t_5 = (__pyx_t_10 != 0);
      if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line879")'> 879:                 continue  # leaving `effective_words` unchanged = shortening the sentence = expanding the window</pre>
<pre id='line879' class='code' style='background-color: #FFFFff'>        goto __pyx_L9_continue;
      }
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line880")'> 880:             if sample and word.sample_int &lt; random_int32(&amp;next_random):</pre>
<pre id='line880' class='code' style='background-color: #FFFF6a'>      if ((__pyx_v_sample != 0)) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_sample_int);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 880; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_PY_LONG_LONG</span>(__pyx_f_14word2vec_inner_random_int32((&amp;__pyx_v_next_random)));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 880; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        __pyx_t_14 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_t_13, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 880; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(__pyx_t_5 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 880; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_10 = __pyx_t_5;
      } else {
        __pyx_t_10 = (__pyx_v_sample != 0);
      }
      if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line881")'> 881:                 continue</pre>
<pre id='line881' class='code' style='background-color: #FFFFff'>        goto __pyx_L9_continue;
      }
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line882")'> 882:             indexes[effective_words] = word.index</pre>
<pre id='line882' class='code' style='background-color: #FFFFc4'>      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_index);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      __pyx_t_15 = __Pyx_PyInt_As_npy_uint32(__pyx_t_14);<span class='error_goto'> if (unlikely((__pyx_t_15 == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      (__pyx_v_indexes[__pyx_v_effective_words]) = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line883")'> 883:             if hs:</pre>
<pre id='line883' class='code' style='background-color: #FFFFff'>      __pyx_t_10 = (__pyx_v_hs != 0);
      if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line884")'> 884:                 codelens[effective_words] = &lt;int&gt;len(word.code)</pre>
<pre id='line884' class='code' style='background-color: #FFFF8d'>        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        __pyx_t_16 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(__pyx_t_16 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 884; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        (__pyx_v_codelens[__pyx_v_effective_words]) = ((int)__pyx_t_16);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line885")'> 885:                 codes[effective_words] = &lt;np.uint8_t *&gt;np.PyArray_DATA(word.code)</pre>
<pre id='line885' class='code' style='background-color: #FFFF9f'>        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        if (!(likely(((__pyx_t_14) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_14, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 885; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        (__pyx_v_codes[__pyx_v_effective_words]) = ((__pyx_t_5numpy_uint8_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_14)));
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line886")'> 886:                 points[effective_words] = &lt;np.uint32_t *&gt;np.PyArray_DATA(word.point)</pre>
<pre id='line886' class='code' style='background-color: #FFFF9f'>        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_point);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        if (!(likely(((__pyx_t_14) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_14, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        (__pyx_v_points[__pyx_v_effective_words]) = ((__pyx_t_5numpy_uint32_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_14)));
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        goto __pyx_L13;
      }
      __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line887")'> 887:             effective_words += 1</pre>
<pre id='line887' class='code' style='background-color: #FFFFff'>      __pyx_v_effective_words = (__pyx_v_effective_words + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line888")'> 888:             if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line888' class='code' style='background-color: #FFFFff'>      __pyx_t_10 = ((__pyx_v_effective_words == 10000) != 0);
      if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line889")'> 889:                 break  # TODO: log warning, tally overflow?</pre>
<pre id='line889' class='code' style='background-color: #FFFFe7'>        goto __pyx_L10_break;
      }
      __pyx_L9_continue:;
    }
    __pyx_L10_break:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line890")'> 890: </pre>
<pre id='line890' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line891")'> 891:         # keep track of which words go into which sentence, so we don't train</pre>
<pre id='line891' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line892")'> 892:         # across sentence boundaries.</pre>
<pre id='line892' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line893")'> 893:         # indices of sentence number X are between &lt;sentence_idx[X], sentence_idx[X])</pre>
<pre id='line893' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line894")'> 894:         effective_sentences += 1</pre>
<pre id='line894' class='code' style='background-color: #FFFFff'>    __pyx_v_effective_sentences = (__pyx_v_effective_sentences + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line895")'> 895:         sentence_idx[effective_sentences] = effective_words</pre>
<pre id='line895' class='code' style='background-color: #FFFFff'>    (__pyx_v_sentence_idx[__pyx_v_effective_sentences]) = __pyx_v_effective_words;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line896")'> 896: </pre>
<pre id='line896' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line897")'> 897:         if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line897' class='code' style='background-color: #FFFFff'>    __pyx_t_10 = ((__pyx_v_effective_words == 10000) != 0);
    if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line898")'> 898:             break  # TODO: log warning, tally overflow?</pre>
<pre id='line898' class='code' style='background-color: #FFFFe7'>      goto __pyx_L7_break;
    }
    __pyx_L6_continue:;
  }
  __pyx_L7_break:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line899")'> 899: </pre>
<pre id='line899' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line900")'> 900:     # precompute "reduced window" offsets in a single randint() call</pre>
<pre id='line900' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line901")'> 901:     for i, item in enumerate(model.random.randint(0, window, effective_words)):</pre>
<pre id='line901' class='code' style='background-color: #FFFF1e'>  __pyx_t_2 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_effective_words);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 2, __pyx_t_14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
  __pyx_t_7 = 0;
  __pyx_t_14 = 0;
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_14) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_14)) {
    __pyx_t_13 = __pyx_t_14; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13); __pyx_t_6 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_13 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_9 = Py_TYPE(__pyx_t_13)-&gt;tp_iternext;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  for (;;) {
    if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_13)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_13)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_14 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_13, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_14 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_13, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_13)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_13)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_14 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_13, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_14 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_13, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_14 = __pyx_t_9(__pyx_t_13);
      if (unlikely(!__pyx_t_14)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_item, __pyx_t_14);
    __pyx_t_14 = 0;
    __pyx_v_i = __pyx_t_2;
    __pyx_t_2 = (__pyx_t_2 + 1);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line902")'> 902:         reduced_windows[i] = item</pre>
<pre id='line902' class='code' style='background-color: #FFFFe7'>    __pyx_t_15 = __Pyx_PyInt_As_npy_uint32(__pyx_v_item);<span class='error_goto'> if (unlikely((__pyx_t_15 == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 902; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_reduced_windows[__pyx_v_i]) = __pyx_t_15;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line903")'> 903: </pre>
<pre id='line903' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line904")'> 904:     # release GIL &amp; train on all sentences</pre>
<pre id='line904' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line905")'> 905:     with nogil:</pre>
<pre id='line905' class='code' style='background-color: #FFFFff'>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L20;
        }
        __pyx_L20:;
      }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line906")'> 906:         for sent_idx in range(effective_sentences):</pre>
<pre id='line906' class='code' style='background-color: #FFFFff'>        __pyx_t_2 = __pyx_v_effective_sentences;
        for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_2; __pyx_t_17+=1) {
          __pyx_v_sent_idx = __pyx_t_17;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line907")'> 907:             idx_start = sentence_idx[sent_idx]</pre>
<pre id='line907' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_start = (__pyx_v_sentence_idx[__pyx_v_sent_idx]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line908")'> 908:             idx_end = sentence_idx[sent_idx + 1]</pre>
<pre id='line908' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_end = (__pyx_v_sentence_idx[(__pyx_v_sent_idx + 1)]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line909")'> 909:             for i in range(idx_start, idx_end):</pre>
<pre id='line909' class='code' style='background-color: #FFFFff'>          __pyx_t_18 = __pyx_v_idx_end;
          for (__pyx_t_19 = __pyx_v_idx_start; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
            __pyx_v_i = __pyx_t_19;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line910")'> 910:                 j = i - window + reduced_windows[i]</pre>
<pre id='line910' class='code' style='background-color: #FFFFff'>            __pyx_v_j = ((__pyx_v_i - __pyx_v_window) + (__pyx_v_reduced_windows[__pyx_v_i]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line911")'> 911:                 if j &lt; idx_start:</pre>
<pre id='line911' class='code' style='background-color: #FFFFff'>            __pyx_t_10 = ((__pyx_v_j &lt; __pyx_v_idx_start) != 0);
            if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line912")'> 912:                     j = idx_start</pre>
<pre id='line912' class='code' style='background-color: #FFFFff'>              __pyx_v_j = __pyx_v_idx_start;
              goto __pyx_L25;
            }
            __pyx_L25:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line913")'> 913:                 k = i + window + 1 - reduced_windows[i]</pre>
<pre id='line913' class='code' style='background-color: #FFFFff'>            __pyx_v_k = (((__pyx_v_i + __pyx_v_window) + 1) - (__pyx_v_reduced_windows[__pyx_v_i]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line914")'> 914:                 if k &gt; idx_end:</pre>
<pre id='line914' class='code' style='background-color: #FFFFff'>            __pyx_t_10 = ((__pyx_v_k &gt; __pyx_v_idx_end) != 0);
            if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line915")'> 915:                     k = idx_end</pre>
<pre id='line915' class='code' style='background-color: #FFFFff'>              __pyx_v_k = __pyx_v_idx_end;
              goto __pyx_L26;
            }
            __pyx_L26:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line916")'> 916:                 if hs:</pre>
<pre id='line916' class='code' style='background-color: #FFFFff'>            __pyx_t_10 = (__pyx_v_hs != 0);
            if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line917")'> 917:                     fast_sentence_cbow_hs(points[i], codes[i], codelens, neu1, syn0, syn1, size, indexes, _alpha, work, i, j, k, cbow_mean, word_locks)</pre>
<pre id='line917' class='code' style='background-color: #FFFFff'>              __pyx_f_14word2vec_inner_fast_sentence_cbow_hs((__pyx_v_points[__pyx_v_i]), (__pyx_v_codes[__pyx_v_i]), __pyx_v_codelens, __pyx_v_neu1, __pyx_v_syn0, __pyx_v_syn1, __pyx_v_size, __pyx_v_indexes, __pyx_v__alpha, __pyx_v_work, __pyx_v_i, __pyx_v_j, __pyx_v_k, __pyx_v_cbow_mean, __pyx_v_word_locks);
              goto __pyx_L27;
            }
            __pyx_L27:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line918")'> 918:                 if negative:</pre>
<pre id='line918' class='code' style='background-color: #FFFFff'>            __pyx_t_10 = (__pyx_v_negative != 0);
            if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line919")'> 919:                     next_random = fast_sentence_cbow_neg(negative, cum_table, cum_table_len, codelens, neu1, syn0, syn1neg, size, indexes, _alpha, work, i, j, k, cbow_mean, next_random, word_locks)</pre>
<pre id='line919' class='code' style='background-color: #FFFFff'>              __pyx_v_next_random = __pyx_f_14word2vec_inner_fast_sentence_cbow_neg(__pyx_v_negative, __pyx_v_cum_table, __pyx_v_cum_table_len, __pyx_v_codelens, __pyx_v_neu1, __pyx_v_syn0, __pyx_v_syn1neg, __pyx_v_size, __pyx_v_indexes, __pyx_v__alpha, __pyx_v_work, __pyx_v_i, __pyx_v_j, __pyx_v_k, __pyx_v_cbow_mean, __pyx_v_next_random, __pyx_v_word_locks);
              goto __pyx_L28;
            }
            __pyx_L28:;
          }
        }
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line920")'> 920: </pre>
<pre id='line920' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line921")'> 921:     return effective_words</pre>
<pre id='line921' class='code' style='background-color: #FFFFc4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_effective_words);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 921; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_r = __pyx_t_13;
  __pyx_t_13 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line922")'> 922: </pre>
<pre id='line922' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF18' onclick='toggleDiv("line923")'> 923: def train_batch_cbow_sentiment(model, sentences, alpha, obj_weight, _work, _neu1):</pre>
<pre id='line923' class='code' style='background-color: #FFFF18'>/* Python wrapper */
static PyObject *__pyx_pw_14word2vec_inner_9train_batch_cbow_sentiment(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_14word2vec_inner_9train_batch_cbow_sentiment = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("train_batch_cbow_sentiment"), (PyCFunction)__pyx_pw_14word2vec_inner_9train_batch_cbow_sentiment, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_14word2vec_inner_9train_batch_cbow_sentiment(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_model = 0;
  PyObject *__pyx_v_sentences = 0;
  PyObject *__pyx_v_alpha = 0;
  PyObject *__pyx_v_obj_weight = 0;
  PyObject *__pyx_v__work = 0;
  PyObject *__pyx_v__neu1 = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_cbow_sentiment (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_sentences,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_obj_weight,&amp;__pyx_n_s_work,&amp;__pyx_n_s_neu1,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_sentences)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow_sentiment", 1, 6, 6, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow_sentiment", 1, 6, 6, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_obj_weight)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow_sentiment", 1, 6, 6, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_work)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow_sentiment", 1, 6, 6, 4); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (likely((values[5] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_neu1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow_sentiment", 1, 6, 6, 5); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "train_batch_cbow_sentiment") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 6) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
    }
    __pyx_v_model = values[0];
    __pyx_v_sentences = values[1];
    __pyx_v_alpha = values[2];
    __pyx_v_obj_weight = values[3];
    __pyx_v__work = values[4];
    __pyx_v__neu1 = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("train_batch_cbow_sentiment", 1, 6, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_cbow_sentiment", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_14word2vec_inner_8train_batch_cbow_sentiment(__pyx_self, __pyx_v_model, __pyx_v_sentences, __pyx_v_alpha, __pyx_v_obj_weight, __pyx_v__work, __pyx_v__neu1);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_14word2vec_inner_8train_batch_cbow_sentiment(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_model, PyObject *__pyx_v_sentences, PyObject *__pyx_v_alpha, PyObject *__pyx_v_obj_weight, PyObject *__pyx_v__work, PyObject *__pyx_v__neu1) {
  int __pyx_v_hs;
  int __pyx_v_negative;
  int __pyx_v_sample;
  int __pyx_v_cbow_mean;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_word_locks;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v__alpha;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v__obj_weight;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v__weight_sswe;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v__weight_cbow;
  int __pyx_v_layer1_size;
  int __pyx_v_vector_size;
  int __pyx_v_nclass;
  int __pyx_v_codelens[10000];
  __pyx_t_5numpy_uint32_t __pyx_v_indexes[10000];
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_sentence_label[(10000 + 1)];
  int __pyx_v_sentence_idx[(10000 + 1)];
  int __pyx_v_window;
  int __pyx_v_slide;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  int __pyx_v_effective_words;
  int __pyx_v_effective_sentences;
  int __pyx_v_sent_idx;
  int __pyx_v_idx_start;
  int __pyx_v_idx_end;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1;
  __pyx_t_5numpy_uint32_t *__pyx_v_points[10000];
  __pyx_t_5numpy_uint8_t *__pyx_v_codes[10000];
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1neg;
  __pyx_t_5numpy_uint32_t *__pyx_v_cum_table;
  unsigned PY_LONG_LONG __pyx_v_cum_table_len;
  unsigned PY_LONG_LONG __pyx_v_next_random;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w1;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b1;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_w2;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_b2;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_T;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu1;
  PyObject *__pyx_v_vlookup = NULL;
  PyObject *__pyx_v_sent = NULL;
  PyObject *__pyx_v_label = NULL;
  PyObject *__pyx_v_token = NULL;
  PyObject *__pyx_v_word = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("train_batch_cbow_sentiment", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.train_batch_cbow_sentiment", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vlookup);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sent);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_label);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_token);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_word);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__26 = <span class='py_c_api'>PyTuple_Pack</span>(53, __pyx_n_s_model, __pyx_n_s_sentences, __pyx_n_s_alpha, __pyx_n_s_obj_weight, __pyx_n_s_work, __pyx_n_s_neu1, __pyx_n_s_hs, __pyx_n_s_negative, __pyx_n_s_sample, __pyx_n_s_cbow_mean, __pyx_n_s_syn0, __pyx_n_s_word_locks, __pyx_n_s_work_2, __pyx_n_s_alpha_2, __pyx_n_s_obj_weight_2, __pyx_n_s_weight_sswe, __pyx_n_s_weight_cbow, __pyx_n_s_layer1_size, __pyx_n_s_vector_size, __pyx_n_s_nclass, __pyx_n_s_codelens, __pyx_n_s_indexes, __pyx_n_s_reduced_windows, __pyx_n_s_sentence_label, __pyx_n_s_sentence_idx, __pyx_n_s_window, __pyx_n_s_slide, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_effective_words, __pyx_n_s_effective_sentences, __pyx_n_s_sent_idx, __pyx_n_s_idx_start, __pyx_n_s_idx_end, __pyx_n_s_syn1, __pyx_n_s_points, __pyx_n_s_codes, __pyx_n_s_syn1neg, __pyx_n_s_cum_table, __pyx_n_s_cum_table_len, __pyx_n_s_next_random, __pyx_n_s_w1, __pyx_n_s_b1, __pyx_n_s_w2, __pyx_n_s_b2, __pyx_n_s_T, __pyx_n_s_neu1_2, __pyx_n_s_vlookup, __pyx_n_s_sent, __pyx_n_s_label, __pyx_n_s_token, __pyx_n_s_word);<span class='error_goto'> if (unlikely(!__pyx_tuple__26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__26);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__26);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_14word2vec_inner_9train_batch_cbow_sentiment, NULL, __pyx_n_s_word2vec_inner);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_train_batch_cbow_sentiment, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__27 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 53, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_home_slcf_saerom_word2vec_codes, __pyx_n_s_train_batch_cbow_sentiment, 923, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__27)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line924")'> 924:     cdef int hs = model.hs</pre>
<pre id='line924' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_hs);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_hs = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line925")'> 925:     cdef int negative = model.negative</pre>
<pre id='line925' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_negative);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 925; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 925; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_negative = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line926")'> 926:     cdef int sample = (model.sample != 0)</pre>
<pre id='line926' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_sample);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_int_0, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_sample = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line927")'> 927:     cdef int cbow_mean = model.cbow_mean</pre>
<pre id='line927' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_cbow_mean);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_cbow_mean = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line928")'> 928: </pre>
<pre id='line928' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line929")'> 929:     cdef REAL_t *syn0 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0))</pre>
<pre id='line929' class='code' style='background-color: #FFFF9f'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_syn0 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line930")'> 930:     cdef REAL_t *word_locks = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0_lockf))</pre>
<pre id='line930' class='code' style='background-color: #FFFF9f'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0_lockf);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 930; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 930; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_word_locks = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line931")'> 931:     cdef REAL_t *work</pre>
<pre id='line931' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line932")'> 932:     cdef REAL_t _alpha = alpha</pre>
<pre id='line932' class='code' style='background-color: #FFFFaa'>  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_alpha);<span class='error_goto'> if (unlikely((__pyx_t_4 == (npy_float32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 932; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v__alpha = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line933")'> 933:     cdef REAL_t _obj_weight = obj_weight</pre>
<pre id='line933' class='code' style='background-color: #FFFFaa'>  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_obj_weight);<span class='error_goto'> if (unlikely((__pyx_t_4 == (npy_float32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v__obj_weight = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line934")'> 934:     cdef REAL_t _weight_sswe = _alpha * (1.0-_obj_weight)</pre>
<pre id='line934' class='code' style='background-color: #FFFFff'>  __pyx_v__weight_sswe = (__pyx_v__alpha * (1.0 - __pyx_v__obj_weight));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line935")'> 935:     cdef REAL_t _weight_cbow = _alpha * _obj_weight</pre>
<pre id='line935' class='code' style='background-color: #FFFFff'>  __pyx_v__weight_cbow = (__pyx_v__alpha * __pyx_v__obj_weight);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line936")'> 936: </pre>
<pre id='line936' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line937")'> 937:     cdef int layer1_size = model.layer1_size</pre>
<pre id='line937' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_layer1_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 937; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 937; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_layer1_size = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line938")'> 938:     cdef int vector_size = model.vector_size</pre>
<pre id='line938' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vector_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_vector_size = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line939")'> 939:     cdef int nclass = model.nclass</pre>
<pre id='line939' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nclass);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_nclass = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line940")'> 940: </pre>
<pre id='line940' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line941")'> 941:     cdef int codelens[MAX_SENTENCE_LEN]</pre>
<pre id='line941' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line942")'> 942:     cdef np.uint32_t indexes[MAX_SENTENCE_LEN]</pre>
<pre id='line942' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line943")'> 943:     cdef np.uint32_t reduced_windows[MAX_SENTENCE_LEN]</pre>
<pre id='line943' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line944")'> 944:     cdef REAL_t sentence_label[MAX_SENTENCE_LEN + 1]</pre>
<pre id='line944' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line945")'> 945:     cdef int sentence_idx[MAX_SENTENCE_LEN + 1]</pre>
<pre id='line945' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line946")'> 946:     cdef int window = model.window</pre>
<pre id='line946' class='code' style='background-color: #FFFFaa'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_window);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 946; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 946; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_window = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line947")'> 947:     cdef int slide = window/2</pre>
<pre id='line947' class='code' style='background-color: #FFFFff'>  __pyx_v_slide = (__pyx_v_window / 2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line948")'> 948: </pre>
<pre id='line948' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line949")'> 949:     cdef int i, j, k</pre>
<pre id='line949' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line950")'> 950:     cdef int effective_words = 0, effective_sentences = 0</pre>
<pre id='line950' class='code' style='background-color: #FFFFff'>  __pyx_v_effective_words = 0;
  __pyx_v_effective_sentences = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line951")'> 951:     cdef int sent_idx, idx_start, idx_end</pre>
<pre id='line951' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line952")'> 952: </pre>
<pre id='line952' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line953")'> 953:     # For hierarchical softmax</pre>
<pre id='line953' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line954")'> 954:     cdef REAL_t *syn1</pre>
<pre id='line954' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line955")'> 955:     cdef np.uint32_t *points[MAX_SENTENCE_LEN]</pre>
<pre id='line955' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line956")'> 956:     cdef np.uint8_t *codes[MAX_SENTENCE_LEN]</pre>
<pre id='line956' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line957")'> 957: </pre>
<pre id='line957' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line958")'> 958:     # For negative sampling</pre>
<pre id='line958' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line959")'> 959:     cdef REAL_t *syn1neg</pre>
<pre id='line959' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line960")'> 960:     cdef np.uint32_t *cum_table</pre>
<pre id='line960' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line961")'> 961:     cdef unsigned long long cum_table_len</pre>
<pre id='line961' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line962")'> 962:     # for sampling (negative and frequent-word downsampling)</pre>
<pre id='line962' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line963")'> 963:     cdef unsigned long long next_random</pre>
<pre id='line963' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line964")'> 964: </pre>
<pre id='line964' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line965")'> 965:     if hs:</pre>
<pre id='line965' class='code' style='background-color: #FFFFff'>  __pyx_t_5 = (__pyx_v_hs != 0);
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line966")'> 966:         syn1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn1))</pre>
<pre id='line966' class='code' style='background-color: #FFFF9f'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_syn1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line967")'> 967: </pre>
<pre id='line967' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line968")'> 968:     if negative:</pre>
<pre id='line968' class='code' style='background-color: #FFFFff'>  __pyx_t_5 = (__pyx_v_negative != 0);
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line969")'> 969:         syn1neg = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn1neg))</pre>
<pre id='line969' class='code' style='background-color: #FFFF9f'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn1neg);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 969; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_syn1neg = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line970")'> 970:         cum_table = &lt;np.uint32_t *&gt;(np.PyArray_DATA(model.cum_table))</pre>
<pre id='line970' class='code' style='background-color: #FFFF9f'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_cum_table);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 970; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 970; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_v_cum_table = ((__pyx_t_5numpy_uint32_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line971")'> 971:         cum_table_len = len(model.cum_table)</pre>
<pre id='line971' class='code' style='background-color: #FFFF8d'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_cum_table);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 971; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 971; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_cum_table_len = __pyx_t_6;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line972")'> 972:     if negative or sample:</pre>
<pre id='line972' class='code' style='background-color: #FFFFff'>  if (!(__pyx_v_negative != 0)) {
    __pyx_t_5 = (__pyx_v_sample != 0);
  } else {
    __pyx_t_5 = (__pyx_v_negative != 0);
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line973")'> 973:         next_random = (2**24) * model.random.randint(0, 2**24) + model.random.randint(0, 2**24)</pre>
<pre id='line973' class='code' style='background-color: #FFFF31'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple__9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_int_16777216, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_randint);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
  __pyx_tuple__9 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple__9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__9);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_tuple__10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_PY_LONG_LONG</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_8 == (unsigned PY_LONG_LONG)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_v_next_random = __pyx_t_8;
    goto __pyx_L5;
  }
  __pyx_L5:;
  __pyx_tuple__10 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_16777216);<span class='error_goto'> if (unlikely(!__pyx_tuple__10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__10);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line974")'> 974: </pre>
<pre id='line974' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line975")'> 975:     # SSWE</pre>
<pre id='line975' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line976")'> 976:     cdef REAL_t *w1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['w1']))</pre>
<pre id='line976' class='code' style='background-color: #FFFF73'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_7, __pyx_n_s_w1);<span class='error_goto'> if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_w1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line977")'> 977:     cdef REAL_t *b1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['b1']))</pre>
<pre id='line977' class='code' style='background-color: #FFFF73'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_3, __pyx_n_s_b1);<span class='error_goto'> if (unlikely(__pyx_t_7 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_b1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_7)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line978")'> 978:     cdef REAL_t *w2 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['w2']))</pre>
<pre id='line978' class='code' style='background-color: #FFFF73'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_7, __pyx_n_s_w2);<span class='error_goto'> if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_w2 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line979")'> 979:     cdef REAL_t *b2 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['w2']))</pre>
<pre id='line979' class='code' style='background-color: #FFFF73'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 979; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_3, __pyx_n_s_w2);<span class='error_goto'> if (unlikely(__pyx_t_7 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 979; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 979; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_b2 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_7)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line980")'> 980: </pre>
<pre id='line980' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line981")'> 981:     # transformation matrix</pre>
<pre id='line981' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line982")'> 982:     cdef REAL_t *T = &lt;REAL_t *&gt;(np.PyArray_DATA(model.nn_parms['T']))</pre>
<pre id='line982' class='code' style='background-color: #FFFF73'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_nn_parms);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 982; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_7, __pyx_n_s_T);<span class='error_goto'> if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 982; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 982; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_T = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_3)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line983")'> 983: </pre>
<pre id='line983' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line984")'> 984:     # convert Python structures to primitive types, so we can release the GIL</pre>
<pre id='line984' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line985")'> 985:     work = &lt;REAL_t *&gt;np.PyArray_DATA(_work)</pre>
<pre id='line985' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__work) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__work, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_work = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__work)));
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line986")'> 986:     neu1 = &lt;REAL_t *&gt;np.PyArray_DATA(_neu1)</pre>
<pre id='line986' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__neu1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__neu1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 986; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_neu1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__neu1)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line987")'> 987: </pre>
<pre id='line987' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line988")'> 988:     # prepare C structures so we can go "full C" and release the Python GIL</pre>
<pre id='line988' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line989")'> 989:     vlookup = model.vocab</pre>
<pre id='line989' class='code' style='background-color: #FFFFd4'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vocab);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 989; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_v_vlookup = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line990")'> 990:     sentence_idx[0] = 0  # indices of the first sentence always start at 0</pre>
<pre id='line990' class='code' style='background-color: #FFFFff'>  (__pyx_v_sentence_idx[0]) = 0;
</pre><pre class='line' style='background-color: #FFFF17' onclick='toggleDiv("line991")'> 991:     for sent, label in sentences:</pre>
<pre id='line991' class='code' style='background-color: #FFFF17'>  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sentences) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sentences)) {
    __pyx_t_3 = __pyx_v_sentences; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sentences);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_9 = Py_TYPE(__pyx_t_3)-&gt;tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_7 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_7 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_9 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_7 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_6++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_7 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_7 = __pyx_t_9(__pyx_t_3);
      if (unlikely(!__pyx_t_7)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    }
    if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_7))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_7))) {
      PyObject* sequence = __pyx_t_7;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
      #endif
      if (unlikely(size != 2)) {
        if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
        else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
        __pyx_t_10 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
      } else {
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
        __pyx_t_10 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      #else
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_10 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_11 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_12 = Py_TYPE(__pyx_t_11)-&gt;tp_iternext;
      index = 0; __pyx_t_1 = __pyx_t_12(__pyx_t_11); if (unlikely(!__pyx_t_1)) goto __pyx_L8_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      index = 1; __pyx_t_10 = __pyx_t_12(__pyx_t_11); if (unlikely(!__pyx_t_10)) goto __pyx_L8_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_12(__pyx_t_11), 2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_12 = NULL;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      goto __pyx_L9_unpacking_done;
      __pyx_L8_unpacking_failed:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_12 = NULL;
      if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 991; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_L9_unpacking_done:;
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_sent, __pyx_t_1);
    __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_label, __pyx_t_10);
    __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line992")'> 992:         if not sent:</pre>
<pre id='line992' class='code' style='background-color: #FFFFd4'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(__pyx_t_5 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_13 = ((!__pyx_t_5) != 0);
    if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line993")'> 993:             continue  # ignore empty sentences; leave effective_sentences unchanged</pre>
<pre id='line993' class='code' style='background-color: #FFFFff'>      goto __pyx_L6_continue;
    }
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line994")'> 994:         for token in sent:</pre>
<pre id='line994' class='code' style='background-color: #FFFF2a'>    if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sent) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sent)) {
      __pyx_t_7 = __pyx_v_sent; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_14 = 0;
      __pyx_t_15 = NULL;
    } else {
      __pyx_t_14 = -1; __pyx_t_7 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sent);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_15 = Py_TYPE(__pyx_t_7)-&gt;tp_iternext;
    }
    for (;;) {
      if (!__pyx_t_15 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_7)) {
        if (__pyx_t_14 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_7)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_10 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_7, __pyx_t_14); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10); __pyx_t_14++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_10 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_7, __pyx_t_14); __pyx_t_14++;<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_15 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_7)) {
        if (__pyx_t_14 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_7)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_10 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_7, __pyx_t_14); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10); __pyx_t_14++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_10 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_7, __pyx_t_14); __pyx_t_14++;<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_10 = __pyx_t_15(__pyx_t_7);
        if (unlikely(!__pyx_t_10)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_token, __pyx_t_10);
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line995")'> 995:             word = vlookup[token] if token in vlookup else None</pre>
<pre id='line995' class='code' style='background-color: #FFFF86'>      __pyx_t_13 = (<span class='pyx_c_api'>__Pyx_PySequence_Contains</span>(__pyx_v_token, __pyx_v_vlookup, Py_EQ));<span class='error_goto'> if (unlikely(__pyx_t_13 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      if ((__pyx_t_13 != 0)) {
        __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_vlookup, __pyx_v_token);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_10 = __pyx_t_1;
        __pyx_t_1 = 0;
      } else {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
        __pyx_t_10 = Py_None;
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_word, __pyx_t_10);
      __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line996")'> 996:             if word is None:</pre>
<pre id='line996' class='code' style='background-color: #FFFFff'>      __pyx_t_13 = (__pyx_v_word == Py_None);
      __pyx_t_5 = (__pyx_t_13 != 0);
      if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line997")'> 997:                 continue  # leaving `effective_words` unchanged = shortening the sentence = expanding the window</pre>
<pre id='line997' class='code' style='background-color: #FFFFff'>        goto __pyx_L11_continue;
      }
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line998")'> 998:             if sample and word.sample_int &lt; random_int32(&amp;next_random):</pre>
<pre id='line998' class='code' style='background-color: #FFFF6a'>      if ((__pyx_v_sample != 0)) {
        __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_sample_int);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 998; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_PY_LONG_LONG</span>(__pyx_f_14word2vec_inner_random_int32((&amp;__pyx_v_next_random)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 998; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_11 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_10, __pyx_t_1, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 998; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(__pyx_t_5 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 998; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_13 = __pyx_t_5;
      } else {
        __pyx_t_13 = (__pyx_v_sample != 0);
      }
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line999")'> 999:                 continue</pre>
<pre id='line999' class='code' style='background-color: #FFFFff'>        goto __pyx_L11_continue;
      }
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1000")'> 1000:             indexes[effective_words] = word.index</pre>
<pre id='line1000' class='code' style='background-color: #FFFFc4'>      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_index);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1000; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_16 = __Pyx_PyInt_As_npy_uint32(__pyx_t_11);<span class='error_goto'> if (unlikely((__pyx_t_16 == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1000; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      (__pyx_v_indexes[__pyx_v_effective_words]) = __pyx_t_16;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1001")'> 1001:             if hs:</pre>
<pre id='line1001' class='code' style='background-color: #FFFFff'>      __pyx_t_13 = (__pyx_v_hs != 0);
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1002")'> 1002:                 codelens[effective_words] = &lt;int&gt;len(word.code)</pre>
<pre id='line1002' class='code' style='background-color: #FFFF8d'>        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1002; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_17 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(__pyx_t_17 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1002; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        (__pyx_v_codelens[__pyx_v_effective_words]) = ((int)__pyx_t_17);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1003")'> 1003:                 codes[effective_words] = &lt;np.uint8_t *&gt;np.PyArray_DATA(word.code)</pre>
<pre id='line1003' class='code' style='background-color: #FFFF9f'>        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1003; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        if (!(likely(((__pyx_t_11) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_11, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1003; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        (__pyx_v_codes[__pyx_v_effective_words]) = ((__pyx_t_5numpy_uint8_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_11)));
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1004")'> 1004:                 points[effective_words] = &lt;np.uint32_t *&gt;np.PyArray_DATA(word.point)</pre>
<pre id='line1004' class='code' style='background-color: #FFFF9f'>        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_point);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1004; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        if (!(likely(((__pyx_t_11) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_11, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1004; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        (__pyx_v_points[__pyx_v_effective_words]) = ((__pyx_t_5numpy_uint32_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_11)));
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        goto __pyx_L15;
      }
      __pyx_L15:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1005")'> 1005:             effective_words += 1</pre>
<pre id='line1005' class='code' style='background-color: #FFFFff'>      __pyx_v_effective_words = (__pyx_v_effective_words + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1006")'> 1006:             if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line1006' class='code' style='background-color: #FFFFff'>      __pyx_t_13 = ((__pyx_v_effective_words == 10000) != 0);
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1007")'> 1007:                 break  # TODO: log warning, tally overflow?</pre>
<pre id='line1007' class='code' style='background-color: #FFFFe7'>        goto __pyx_L12_break;
      }
      __pyx_L11_continue:;
    }
    __pyx_L12_break:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1008")'> 1008: </pre>
<pre id='line1008' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1009")'> 1009:         # keep track of which words go into which sentence, so we don't train</pre>
<pre id='line1009' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1010")'> 1010:         # across sentence boundaries.</pre>
<pre id='line1010' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1011")'> 1011:         # indices of sentence number X are between &lt;sentence_idx[X], sentence_idx[X])</pre>
<pre id='line1011' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1012")'> 1012:         sentence_label[effective_sentences] = &lt;REAL_t&gt; label</pre>
<pre id='line1012' class='code' style='background-color: #FFFFaa'>    __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_label);<span class='error_goto'> if (unlikely((__pyx_t_4 == (npy_float32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_sentence_label[__pyx_v_effective_sentences]) = ((__pyx_t_14word2vec_inner_REAL_t)__pyx_t_4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1013")'> 1013:         effective_sentences += 1</pre>
<pre id='line1013' class='code' style='background-color: #FFFFff'>    __pyx_v_effective_sentences = (__pyx_v_effective_sentences + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1014")'> 1014:         sentence_idx[effective_sentences] = effective_words</pre>
<pre id='line1014' class='code' style='background-color: #FFFFff'>    (__pyx_v_sentence_idx[__pyx_v_effective_sentences]) = __pyx_v_effective_words;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1015")'> 1015: </pre>
<pre id='line1015' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1016")'> 1016:         if effective_words == MAX_SENTENCE_LEN:</pre>
<pre id='line1016' class='code' style='background-color: #FFFFff'>    __pyx_t_13 = ((__pyx_v_effective_words == 10000) != 0);
    if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1017")'> 1017:             break  # TODO: log warning, tally overflow?</pre>
<pre id='line1017' class='code' style='background-color: #FFFFe7'>      goto __pyx_L7_break;
    }
    __pyx_L6_continue:;
  }
  __pyx_L7_break:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1018")'> 1018: </pre>
<pre id='line1018' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1019")'> 1019:     # release GIL &amp; train on all sentences</pre>
<pre id='line1019' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1020")'> 1020:     with nogil:</pre>
<pre id='line1020' class='code' style='background-color: #FFFFff'>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L20;
        }
        __pyx_L20:;
      }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1021")'> 1021:         for sent_idx in range(effective_sentences):</pre>
<pre id='line1021' class='code' style='background-color: #FFFFff'>        __pyx_t_2 = __pyx_v_effective_sentences;
        for (__pyx_t_18 = 0; __pyx_t_18 &lt; __pyx_t_2; __pyx_t_18+=1) {
          __pyx_v_sent_idx = __pyx_t_18;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1022")'> 1022:             idx_start = sentence_idx[sent_idx]</pre>
<pre id='line1022' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_start = (__pyx_v_sentence_idx[__pyx_v_sent_idx]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1023")'> 1023:             idx_end = sentence_idx[sent_idx + 1]</pre>
<pre id='line1023' class='code' style='background-color: #FFFFff'>          __pyx_v_idx_end = (__pyx_v_sentence_idx[(__pyx_v_sent_idx + 1)]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1024")'> 1024:             if (idx_end-idx_start)&gt;=window:</pre>
<pre id='line1024' class='code' style='background-color: #FFFFff'>          __pyx_t_13 = (((__pyx_v_idx_end - __pyx_v_idx_start) &gt;= __pyx_v_window) != 0);
          if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1025")'> 1025:                 for j in range(idx_start,idx_end - window + 1):</pre>
<pre id='line1025' class='code' style='background-color: #FFFFff'>            __pyx_t_19 = ((__pyx_v_idx_end - __pyx_v_window) + 1);
            for (__pyx_t_20 = __pyx_v_idx_start; __pyx_t_20 &lt; __pyx_t_19; __pyx_t_20+=1) {
              __pyx_v_j = __pyx_t_20;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1026")'> 1026:                     k = j + window</pre>
<pre id='line1026' class='code' style='background-color: #FFFFff'>              __pyx_v_k = (__pyx_v_j + __pyx_v_window);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1027")'> 1027:                     i = j + slide</pre>
<pre id='line1027' class='code' style='background-color: #FFFFff'>              __pyx_v_i = (__pyx_v_j + __pyx_v_slide);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1028")'> 1028:                     if hs:</pre>
<pre id='line1028' class='code' style='background-color: #FFFFff'>              __pyx_t_13 = (__pyx_v_hs != 0);
              if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1029")'> 1029:                         fast_sentence_cbow_hs_sentiment(points[i], codes[i], codelens, neu1, syn0, syn1, vector_size, indexes, _weight_cbow, work, i, j, k, cbow_mean, word_locks, T)</pre>
<pre id='line1029' class='code' style='background-color: #FFFFff'>                __pyx_f_14word2vec_inner_fast_sentence_cbow_hs_sentiment((__pyx_v_points[__pyx_v_i]), (__pyx_v_codes[__pyx_v_i]), __pyx_v_codelens, __pyx_v_neu1, __pyx_v_syn0, __pyx_v_syn1, __pyx_v_vector_size, __pyx_v_indexes, __pyx_v__weight_cbow, __pyx_v_work, __pyx_v_i, __pyx_v_j, __pyx_v_k, __pyx_v_cbow_mean, __pyx_v_word_locks, __pyx_v_T);
                goto __pyx_L26;
              }
              __pyx_L26:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1030")'> 1030:                         #fast_sentence_cbow_hs(points[i], codes[i], codelens, neu1, syn0, syn1, vector_size, indexes, _weight_cbow, work, i, j, k, cbow_mean, word_locks)</pre>
<pre id='line1030' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1031")'> 1031:                     if negative:</pre>
<pre id='line1031' class='code' style='background-color: #FFFFff'>              __pyx_t_13 = (__pyx_v_negative != 0);
              if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1032")'> 1032:                         next_random = fast_sentence_cbow_neg_sentiment(negative, cum_table, cum_table_len, codelens, neu1, syn0, syn1neg, vector_size, indexes, _weight_cbow, work, i, j, k, cbow_mean, next_random, word_locks, T)</pre>
<pre id='line1032' class='code' style='background-color: #FFFFff'>                __pyx_v_next_random = __pyx_f_14word2vec_inner_fast_sentence_cbow_neg_sentiment(__pyx_v_negative, __pyx_v_cum_table, __pyx_v_cum_table_len, __pyx_v_codelens, __pyx_v_neu1, __pyx_v_syn0, __pyx_v_syn1neg, __pyx_v_vector_size, __pyx_v_indexes, __pyx_v__weight_cbow, __pyx_v_work, __pyx_v_i, __pyx_v_j, __pyx_v_k, __pyx_v_cbow_mean, __pyx_v_next_random, __pyx_v_word_locks, __pyx_v_T);
                goto __pyx_L27;
              }
              __pyx_L27:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1033")'> 1033:                         #next_random = fast_sentence_cbow_neg(negative, cum_table, cum_table_len, codelens, neu1, syn0, syn1neg, vector_size, indexes, _weight_cbow, work, i, j, k, cbow_mean, next_random, word_locks)</pre>
<pre id='line1033' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1034")'> 1034:                     fast_sentence_sswe(sentence_label[sent_idx],syn0,layer1_size,vector_size, window, nclass, indexes, _weight_sswe, work, i, j, word_locks, w1, b1, w2, b2)</pre>
<pre id='line1034' class='code' style='background-color: #FFFFff'>              __pyx_f_14word2vec_inner_fast_sentence_sswe((__pyx_v_sentence_label[__pyx_v_sent_idx]), __pyx_v_syn0, __pyx_v_layer1_size, __pyx_v_vector_size, __pyx_v_window, __pyx_v_nclass, __pyx_v_indexes, __pyx_v__weight_sswe, __pyx_v_work, __pyx_v_i, __pyx_v_j, __pyx_v_word_locks, __pyx_v_w1, __pyx_v_b1, __pyx_v_w2, __pyx_v_b2);
            }
            goto __pyx_L23;
          }
          __pyx_L23:;
        }
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1035")'> 1035: </pre>
<pre id='line1035' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1036")'> 1036:     return effective_words</pre>
<pre id='line1036' class='code' style='background-color: #FFFFc4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_effective_words);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1036; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1037")'> 1037: </pre>
<pre id='line1037' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1038")'> 1038: # Score is only implemented for hierarchical softmax</pre>
<pre id='line1038' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF23' onclick='toggleDiv("line1039")'> 1039: def score_sentence_sg(model, sentence, _work):</pre>
<pre id='line1039' class='code' style='background-color: #FFFF23'>/* Python wrapper */
static PyObject *__pyx_pw_14word2vec_inner_11score_sentence_sg(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_14word2vec_inner_11score_sentence_sg = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("score_sentence_sg"), (PyCFunction)__pyx_pw_14word2vec_inner_11score_sentence_sg, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_14word2vec_inner_11score_sentence_sg(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_model = 0;
  PyObject *__pyx_v_sentence = 0;
  PyObject *__pyx_v__work = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("score_sentence_sg (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_sentence,&amp;__pyx_n_s_work,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_sentence)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("score_sentence_sg", 1, 3, 3, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_work)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("score_sentence_sg", 1, 3, 3, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "score_sentence_sg") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_model = values[0];
    __pyx_v_sentence = values[1];
    __pyx_v__work = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("score_sentence_sg", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.score_sentence_sg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_14word2vec_inner_10score_sentence_sg(__pyx_self, __pyx_v_model, __pyx_v_sentence, __pyx_v__work);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_14word2vec_inner_10score_sentence_sg(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_model, PyObject *__pyx_v_sentence, PyObject *__pyx_v__work) {
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work;
  int __pyx_v_size;
  int __pyx_v_codelens[10000];
  __pyx_t_5numpy_uint32_t __pyx_v_indexes[10000];
  int __pyx_v_sentence_len;
  int __pyx_v_window;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  long __pyx_v_result;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1;
  __pyx_t_5numpy_uint32_t *__pyx_v_points[10000];
  __pyx_t_5numpy_uint8_t *__pyx_v_codes[10000];
  PyObject *__pyx_v_vlookup = NULL;
  PyObject *__pyx_v_token = NULL;
  PyObject *__pyx_v_word = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("score_sentence_sg", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.score_sentence_sg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vlookup);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_token);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_word);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__28 = <span class='py_c_api'>PyTuple_Pack</span>(20, __pyx_n_s_model, __pyx_n_s_sentence, __pyx_n_s_work, __pyx_n_s_syn0, __pyx_n_s_work_2, __pyx_n_s_size, __pyx_n_s_codelens, __pyx_n_s_indexes, __pyx_n_s_sentence_len, __pyx_n_s_window, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_result, __pyx_n_s_syn1, __pyx_n_s_points, __pyx_n_s_codes, __pyx_n_s_vlookup, __pyx_n_s_token, __pyx_n_s_word);<span class='error_goto'> if (unlikely(!__pyx_tuple__28)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__28);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__28);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_14word2vec_inner_11score_sentence_sg, NULL, __pyx_n_s_word2vec_inner);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_score_sentence_sg, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__29 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 20, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_home_slcf_saerom_word2vec_codes, __pyx_n_s_score_sentence_sg, 1039, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__29)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1039; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1040")'> 1040: </pre>
<pre id='line1040' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1041")'> 1041:     cdef REAL_t *syn0 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0))</pre>
<pre id='line1041' class='code' style='background-color: #FFFF9f'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1041; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1041; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_syn0 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_1)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1042")'> 1042:     cdef REAL_t *work</pre>
<pre id='line1042' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1043")'> 1043:     cdef int size = model.layer1_size</pre>
<pre id='line1043' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_layer1_size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_size = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1044")'> 1044: </pre>
<pre id='line1044' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1045")'> 1045:     cdef int codelens[MAX_SENTENCE_LEN]</pre>
<pre id='line1045' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1046")'> 1046:     cdef np.uint32_t indexes[MAX_SENTENCE_LEN]</pre>
<pre id='line1046' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1047")'> 1047:     cdef int sentence_len</pre>
<pre id='line1047' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1048")'> 1048:     cdef int window = model.window</pre>
<pre id='line1048' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_window);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1048; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1048; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_window = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1049")'> 1049: </pre>
<pre id='line1049' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1050")'> 1050:     cdef int i, j, k</pre>
<pre id='line1050' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1051")'> 1051:     cdef long result = 0</pre>
<pre id='line1051' class='code' style='background-color: #FFFFff'>  __pyx_v_result = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1052")'> 1052: </pre>
<pre id='line1052' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1053")'> 1053:     cdef REAL_t *syn1</pre>
<pre id='line1053' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1054")'> 1054:     cdef np.uint32_t *points[MAX_SENTENCE_LEN]</pre>
<pre id='line1054' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1055")'> 1055:     cdef np.uint8_t *codes[MAX_SENTENCE_LEN]</pre>
<pre id='line1055' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1056")'> 1056: </pre>
<pre id='line1056' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1057")'> 1057:     syn1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn1))</pre>
<pre id='line1057' class='code' style='background-color: #FFFF9f'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_syn1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_1)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1058")'> 1058: </pre>
<pre id='line1058' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1059")'> 1059:     # convert Python structures to primitive types, so we can release the GIL</pre>
<pre id='line1059' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1060")'> 1060:     work = &lt;REAL_t *&gt;np.PyArray_DATA(_work)</pre>
<pre id='line1060' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__work) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__work, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1060; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_work = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__work)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1061")'> 1061: </pre>
<pre id='line1061' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1062")'> 1062:     vlookup = model.vocab</pre>
<pre id='line1062' class='code' style='background-color: #FFFFd4'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vocab);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1062; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_vlookup = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1063")'> 1063:     i = 0</pre>
<pre id='line1063' class='code' style='background-color: #FFFFff'>  __pyx_v_i = 0;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1064")'> 1064:     for token in sentence:</pre>
<pre id='line1064' class='code' style='background-color: #FFFF2a'>  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sentence) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sentence)) {
    __pyx_t_1 = __pyx_v_sentence; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sentence);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = Py_TYPE(__pyx_t_1)-&gt;tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_3 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_3++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_3 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_3++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_1);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_token, __pyx_t_5);
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line1065")'> 1065:         word = vlookup[token] if token in vlookup else None</pre>
<pre id='line1065' class='code' style='background-color: #FFFF86'>    __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PySequence_Contains</span>(__pyx_v_token, __pyx_v_vlookup, Py_EQ));<span class='error_goto'> if (unlikely(__pyx_t_6 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1065; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    if ((__pyx_t_6 != 0)) {
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_vlookup, __pyx_v_token);<span class='error_goto'> if (unlikely(__pyx_t_7 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1065; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_5 = __pyx_t_7;
      __pyx_t_7 = 0;
    } else {
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
      __pyx_t_5 = Py_None;
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_word, __pyx_t_5);
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1066")'> 1066:         if word is None:</pre>
<pre id='line1066' class='code' style='background-color: #FFFFff'>    __pyx_t_6 = (__pyx_v_word == Py_None);
    __pyx_t_8 = (__pyx_t_6 != 0);
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1067")'> 1067:             continue  # should drop the</pre>
<pre id='line1067' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1068")'> 1068:         indexes[i] = word.index</pre>
<pre id='line1068' class='code' style='background-color: #FFFFc4'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_index);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_9 = __Pyx_PyInt_As_npy_uint32(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_9 == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    (__pyx_v_indexes[__pyx_v_i]) = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1069")'> 1069:         codelens[i] = &lt;int&gt;len(word.code)</pre>
<pre id='line1069' class='code' style='background-color: #FFFF8d'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1069; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_10 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1069; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    (__pyx_v_codelens[__pyx_v_i]) = ((int)__pyx_t_10);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1070")'> 1070:         codes[i] = &lt;np.uint8_t *&gt;np.PyArray_DATA(word.code)</pre>
<pre id='line1070' class='code' style='background-color: #FFFF9f'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1070; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1070; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_codes[__pyx_v_i]) = ((__pyx_t_5numpy_uint8_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_5)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1071")'> 1071:         points[i] = &lt;np.uint32_t *&gt;np.PyArray_DATA(word.point)</pre>
<pre id='line1071' class='code' style='background-color: #FFFF9f'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_point);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_points[__pyx_v_i]) = ((__pyx_t_5numpy_uint32_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_5)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1072")'> 1072:         result += 1</pre>
<pre id='line1072' class='code' style='background-color: #FFFFff'>    __pyx_v_result = (__pyx_v_result + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1073")'> 1073:         i += 1</pre>
<pre id='line1073' class='code' style='background-color: #FFFFff'>    __pyx_v_i = (__pyx_v_i + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1074")'> 1074:         if i == MAX_SENTENCE_LEN:</pre>
<pre id='line1074' class='code' style='background-color: #FFFFff'>    __pyx_t_8 = ((__pyx_v_i == 10000) != 0);
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1075")'> 1075:             break  # TODO: log warning, tally overflow?</pre>
<pre id='line1075' class='code' style='background-color: #FFFFe7'>      goto __pyx_L4_break;
    }
    __pyx_L3_continue:;
  }
  __pyx_L4_break:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1076")'> 1076:     sentence_len = i</pre>
<pre id='line1076' class='code' style='background-color: #FFFFff'>  __pyx_v_sentence_len = __pyx_v_i;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1077")'> 1077: </pre>
<pre id='line1077' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1078")'> 1078:     # release GIL &amp; train on the sentence</pre>
<pre id='line1078' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1079")'> 1079:     work[0] = 0.0</pre>
<pre id='line1079' class='code' style='background-color: #FFFFff'>  (__pyx_v_work[0]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1080")'> 1080: </pre>
<pre id='line1080' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1081")'> 1081:     with nogil:</pre>
<pre id='line1081' class='code' style='background-color: #FFFFff'>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L9;
        }
        __pyx_L9:;
      }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1082")'> 1082:         for i in range(sentence_len):</pre>
<pre id='line1082' class='code' style='background-color: #FFFFff'>        __pyx_t_2 = __pyx_v_sentence_len;
        for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_2; __pyx_t_11+=1) {
          __pyx_v_i = __pyx_t_11;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1083")'> 1083:             if codelens[i] == 0:</pre>
<pre id='line1083' class='code' style='background-color: #FFFFff'>          __pyx_t_8 = (((__pyx_v_codelens[__pyx_v_i]) == 0) != 0);
          if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1084")'> 1084:                 continue</pre>
<pre id='line1084' class='code' style='background-color: #FFFFff'>            goto __pyx_L10_continue;
          }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1085")'> 1085:             j = i - window</pre>
<pre id='line1085' class='code' style='background-color: #FFFFff'>          __pyx_v_j = (__pyx_v_i - __pyx_v_window);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1086")'> 1086:             if j &lt; 0:</pre>
<pre id='line1086' class='code' style='background-color: #FFFFff'>          __pyx_t_8 = ((__pyx_v_j &lt; 0) != 0);
          if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1087")'> 1087:                 j = 0</pre>
<pre id='line1087' class='code' style='background-color: #FFFFff'>            __pyx_v_j = 0;
            goto __pyx_L13;
          }
          __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1088")'> 1088:             k = i + window + 1</pre>
<pre id='line1088' class='code' style='background-color: #FFFFff'>          __pyx_v_k = ((__pyx_v_i + __pyx_v_window) + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1089")'> 1089:             if k &gt; sentence_len:</pre>
<pre id='line1089' class='code' style='background-color: #FFFFff'>          __pyx_t_8 = ((__pyx_v_k &gt; __pyx_v_sentence_len) != 0);
          if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1090")'> 1090:                 k = sentence_len</pre>
<pre id='line1090' class='code' style='background-color: #FFFFff'>            __pyx_v_k = __pyx_v_sentence_len;
            goto __pyx_L14;
          }
          __pyx_L14:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1091")'> 1091:             for j in range(j, k):</pre>
<pre id='line1091' class='code' style='background-color: #FFFFff'>          __pyx_t_12 = __pyx_v_k;
          for (__pyx_t_13 = __pyx_v_j; __pyx_t_13 &lt; __pyx_t_12; __pyx_t_13+=1) {
            __pyx_v_j = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1092")'> 1092:                 if j == i or codelens[j] == 0:</pre>
<pre id='line1092' class='code' style='background-color: #FFFFff'>            __pyx_t_8 = ((__pyx_v_j == __pyx_v_i) != 0);
            if (!__pyx_t_8) {
              __pyx_t_6 = (((__pyx_v_codelens[__pyx_v_j]) == 0) != 0);
              __pyx_t_14 = __pyx_t_6;
            } else {
              __pyx_t_14 = __pyx_t_8;
            }
            if (__pyx_t_14) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1093")'> 1093:                     continue</pre>
<pre id='line1093' class='code' style='background-color: #FFFFff'>              goto __pyx_L15_continue;
            }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1094")'> 1094:                 score_pair_sg_hs(points[i], codes[i], codelens[i], syn0, syn1, size, indexes[j], work)</pre>
<pre id='line1094' class='code' style='background-color: #FFFFff'>            __pyx_f_14word2vec_inner_score_pair_sg_hs((__pyx_v_points[__pyx_v_i]), (__pyx_v_codes[__pyx_v_i]), (__pyx_v_codelens[__pyx_v_i]), __pyx_v_syn0, __pyx_v_syn1, __pyx_v_size, (__pyx_v_indexes[__pyx_v_j]), __pyx_v_work);
            __pyx_L15_continue:;
          }
          __pyx_L10_continue:;
        }
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1095")'> 1095: </pre>
<pre id='line1095' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1096")'> 1096:     return work[0]</pre>
<pre id='line1096' class='code' style='background-color: #FFFF9f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_work[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1097")'> 1097: </pre>
<pre id='line1097' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1098")'> 1098: cdef void score_pair_sg_hs(</pre>
<pre id='line1098' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_score_pair_sg_hs(__pyx_t_5numpy_uint32_t const *__pyx_v_word_point, __pyx_t_5numpy_uint8_t const *__pyx_v_word_code, int const __pyx_v_codelen, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1, int const __pyx_v_size, __pyx_t_5numpy_uint32_t const __pyx_v_word2_index, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work) {
  PY_LONG_LONG __pyx_v_b;
  PY_LONG_LONG __pyx_v_row1;
  PY_LONG_LONG __pyx_v_row2;
  PY_LONG_LONG __pyx_v_sgn;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_f;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1099")'> 1099:     const np.uint32_t *word_point, const np.uint8_t *word_code, const int codelen,</pre>
<pre id='line1099' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1100")'> 1100:     REAL_t *syn0, REAL_t *syn1, const int size,</pre>
<pre id='line1100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1101")'> 1101:     const np.uint32_t word2_index, REAL_t *work) nogil:</pre>
<pre id='line1101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1102")'> 1102: </pre>
<pre id='line1102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1103")'> 1103:     cdef long long b</pre>
<pre id='line1103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1104")'> 1104:     cdef long long row1 = word2_index * size, row2, sgn</pre>
<pre id='line1104' class='code' style='background-color: #FFFFff'>  __pyx_v_row1 = (__pyx_v_word2_index * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1105")'> 1105:     cdef REAL_t f</pre>
<pre id='line1105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1106")'> 1106: </pre>
<pre id='line1106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1107")'> 1107:     for b in range(codelen):</pre>
<pre id='line1107' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_codelen;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_b = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1108")'> 1108:         row2 = word_point[b] * size</pre>
<pre id='line1108' class='code' style='background-color: #FFFFff'>    __pyx_v_row2 = ((__pyx_v_word_point[__pyx_v_b]) * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1109")'> 1109:         f = our_dot(&amp;size, &amp;syn0[row1], &amp;ONE, &amp;syn1[row2], &amp;ONE)</pre>
<pre id='line1109' class='code' style='background-color: #FFFFff'>    __pyx_v_f = __pyx_v_14word2vec_inner_our_dot((&amp;__pyx_v_size), (&amp;(__pyx_v_syn0[__pyx_v_row1])), (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1110")'> 1110:         sgn = (-1)**word_code[b] # ch function: 0-&gt; 1, 1 -&gt; -1</pre>
<pre id='line1110' class='code' style='background-color: #FFFFff'>    __pyx_v_sgn = __Pyx_pow_long(-1, ((long)(__pyx_v_word_code[__pyx_v_b])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1111")'> 1111:         f = sgn*f</pre>
<pre id='line1111' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_sgn * __pyx_v_f);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1112")'> 1112:         if f &lt;= -MAX_EXP or f &gt;= MAX_EXP:</pre>
<pre id='line1112' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_f &lt;= -6.0) != 0);
    if (!__pyx_t_3) {
      __pyx_t_4 = ((__pyx_v_f &gt;= 6.0) != 0);
      __pyx_t_5 = __pyx_t_4;
    } else {
      __pyx_t_5 = __pyx_t_3;
    }
    if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1113")'> 1113:             continue</pre>
<pre id='line1113' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1114")'> 1114:         f = LOG_TABLE[&lt;int&gt;((f + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))]</pre>
<pre id='line1114' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_14word2vec_inner_LOG_TABLE[((int)((__pyx_v_f + 6.0) * 83.0))]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1115")'> 1115:         work[0] += f</pre>
<pre id='line1115' class='code' style='background-color: #FFFFff'>    __pyx_t_6 = 0;
    (__pyx_v_work[__pyx_t_6]) = ((__pyx_v_work[__pyx_t_6]) + __pyx_v_f);
    __pyx_L3_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1116")'> 1116: </pre>
<pre id='line1116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1f' onclick='toggleDiv("line1117")'> 1117: def score_sentence_cbow(model, sentence, _work, _neu1):</pre>
<pre id='line1117' class='code' style='background-color: #FFFF1f'>/* Python wrapper */
static PyObject *__pyx_pw_14word2vec_inner_13score_sentence_cbow(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_14word2vec_inner_13score_sentence_cbow = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("score_sentence_cbow"), (PyCFunction)__pyx_pw_14word2vec_inner_13score_sentence_cbow, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_14word2vec_inner_13score_sentence_cbow(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_model = 0;
  PyObject *__pyx_v_sentence = 0;
  PyObject *__pyx_v__work = 0;
  PyObject *__pyx_v__neu1 = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("score_sentence_cbow (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_model,&amp;__pyx_n_s_sentence,&amp;__pyx_n_s_work,&amp;__pyx_n_s_neu1,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_sentence)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("score_sentence_cbow", 1, 4, 4, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_work)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("score_sentence_cbow", 1, 4, 4, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_neu1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("score_sentence_cbow", 1, 4, 4, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "score_sentence_cbow") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_model = values[0];
    __pyx_v_sentence = values[1];
    __pyx_v__work = values[2];
    __pyx_v__neu1 = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("score_sentence_cbow", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.score_sentence_cbow", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_14word2vec_inner_12score_sentence_cbow(__pyx_self, __pyx_v_model, __pyx_v_sentence, __pyx_v__work, __pyx_v__neu1);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_14word2vec_inner_12score_sentence_cbow(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_model, PyObject *__pyx_v_sentence, PyObject *__pyx_v__work, PyObject *__pyx_v__neu1) {
  int __pyx_v_cbow_mean;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu1;
  int __pyx_v_size;
  int __pyx_v_codelens[10000];
  __pyx_t_5numpy_uint32_t __pyx_v_indexes[10000];
  int __pyx_v_sentence_len;
  int __pyx_v_window;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  long __pyx_v_result;
  __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1;
  __pyx_t_5numpy_uint32_t *__pyx_v_points[10000];
  __pyx_t_5numpy_uint8_t *__pyx_v_codes[10000];
  PyObject *__pyx_v_vlookup = NULL;
  PyObject *__pyx_v_token = NULL;
  PyObject *__pyx_v_word = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("score_sentence_cbow", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("word2vec_inner.score_sentence_cbow", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vlookup);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_token);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_word);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__30 = <span class='py_c_api'>PyTuple_Pack</span>(23, __pyx_n_s_model, __pyx_n_s_sentence, __pyx_n_s_work, __pyx_n_s_neu1, __pyx_n_s_cbow_mean, __pyx_n_s_syn0, __pyx_n_s_work_2, __pyx_n_s_neu1_2, __pyx_n_s_size, __pyx_n_s_codelens, __pyx_n_s_indexes, __pyx_n_s_sentence_len, __pyx_n_s_window, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_result, __pyx_n_s_syn1, __pyx_n_s_points, __pyx_n_s_codes, __pyx_n_s_vlookup, __pyx_n_s_token, __pyx_n_s_word);<span class='error_goto'> if (unlikely(!__pyx_tuple__30)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__30);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__30);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_14word2vec_inner_13score_sentence_cbow, NULL, __pyx_n_s_word2vec_inner);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_score_sentence_cbow, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__31 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 23, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__30, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_home_slcf_saerom_word2vec_codes, __pyx_n_s_score_sentence_cbow, 1117, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1118")'> 1118:     cdef int cbow_mean = model.cbow_mean</pre>
<pre id='line1118' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_cbow_mean);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_cbow_mean = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1119")'> 1119: </pre>
<pre id='line1119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1120")'> 1120:     cdef REAL_t *syn0 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn0))</pre>
<pre id='line1120' class='code' style='background-color: #FFFF9f'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_syn0 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_1)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1121")'> 1121:     cdef REAL_t *work</pre>
<pre id='line1121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1122")'> 1122:     cdef REAL_t *neu1</pre>
<pre id='line1122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1123")'> 1123:     cdef int size = model.layer1_size</pre>
<pre id='line1123' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_layer1_size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_size = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1124")'> 1124: </pre>
<pre id='line1124' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1125")'> 1125:     cdef int codelens[MAX_SENTENCE_LEN]</pre>
<pre id='line1125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1126")'> 1126:     cdef np.uint32_t indexes[MAX_SENTENCE_LEN]</pre>
<pre id='line1126' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1127")'> 1127:     cdef int sentence_len</pre>
<pre id='line1127' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1128")'> 1128:     cdef int window = model.window</pre>
<pre id='line1128' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_window);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_window = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1129")'> 1129: </pre>
<pre id='line1129' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1130")'> 1130:     cdef int i, j, k</pre>
<pre id='line1130' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1131")'> 1131:     cdef long result = 0</pre>
<pre id='line1131' class='code' style='background-color: #FFFFff'>  __pyx_v_result = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1132")'> 1132: </pre>
<pre id='line1132' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1133")'> 1133:     # For hierarchical softmax</pre>
<pre id='line1133' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1134")'> 1134:     cdef REAL_t *syn1</pre>
<pre id='line1134' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1135")'> 1135:     cdef np.uint32_t *points[MAX_SENTENCE_LEN]</pre>
<pre id='line1135' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1136")'> 1136:     cdef np.uint8_t *codes[MAX_SENTENCE_LEN]</pre>
<pre id='line1136' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1137")'> 1137: </pre>
<pre id='line1137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1138")'> 1138:     syn1 = &lt;REAL_t *&gt;(np.PyArray_DATA(model.syn1))</pre>
<pre id='line1138' class='code' style='background-color: #FFFF9f'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_syn1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_syn1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_1)));
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1139")'> 1139: </pre>
<pre id='line1139' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1140")'> 1140:     # convert Python structures to primitive types, so we can release the GIL</pre>
<pre id='line1140' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1141")'> 1141:     work = &lt;REAL_t *&gt;np.PyArray_DATA(_work)</pre>
<pre id='line1141' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__work) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__work, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_work = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__work)));
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1142")'> 1142:     neu1 = &lt;REAL_t *&gt;np.PyArray_DATA(_neu1)</pre>
<pre id='line1142' class='code' style='background-color: #FFFFc4'>  if (!(likely(((__pyx_v__neu1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v__neu1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_neu1 = ((__pyx_t_14word2vec_inner_REAL_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_v__neu1)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1143")'> 1143: </pre>
<pre id='line1143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1144")'> 1144:     vlookup = model.vocab</pre>
<pre id='line1144' class='code' style='background-color: #FFFFd4'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_model, __pyx_n_s_vocab);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_vlookup = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1145")'> 1145:     i = 0</pre>
<pre id='line1145' class='code' style='background-color: #FFFFff'>  __pyx_v_i = 0;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line1146")'> 1146:     for token in sentence:</pre>
<pre id='line1146' class='code' style='background-color: #FFFF2a'>  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_sentence) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_sentence)) {
    __pyx_t_1 = __pyx_v_sentence; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_sentence);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = Py_TYPE(__pyx_t_1)-&gt;tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_4 &amp;&amp; <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_3 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_3++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_4 &amp;&amp; <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      if (__pyx_t_3 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_3++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_1);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_token, __pyx_t_5);
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line1147")'> 1147:         word = vlookup[token] if token in vlookup else None</pre>
<pre id='line1147' class='code' style='background-color: #FFFF86'>    __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PySequence_Contains</span>(__pyx_v_token, __pyx_v_vlookup, Py_EQ));<span class='error_goto'> if (unlikely(__pyx_t_6 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    if ((__pyx_t_6 != 0)) {
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_vlookup, __pyx_v_token);<span class='error_goto'> if (unlikely(__pyx_t_7 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_5 = __pyx_t_7;
      __pyx_t_7 = 0;
    } else {
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
      __pyx_t_5 = Py_None;
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_word, __pyx_t_5);
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1148")'> 1148:         if word is None:</pre>
<pre id='line1148' class='code' style='background-color: #FFFFff'>    __pyx_t_6 = (__pyx_v_word == Py_None);
    __pyx_t_8 = (__pyx_t_6 != 0);
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1149")'> 1149:             continue  # for score, should this be a default negative value?</pre>
<pre id='line1149' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line1150")'> 1150:         indexes[i] = word.index</pre>
<pre id='line1150' class='code' style='background-color: #FFFFc4'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_index);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_9 = __Pyx_PyInt_As_npy_uint32(__pyx_t_5);<span class='error_goto'> if (unlikely((__pyx_t_9 == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    (__pyx_v_indexes[__pyx_v_i]) = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line1151")'> 1151:         codelens[i] = &lt;int&gt;len(word.code)</pre>
<pre id='line1151' class='code' style='background-color: #FFFF8d'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_10 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    (__pyx_v_codelens[__pyx_v_i]) = ((int)__pyx_t_10);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1152")'> 1152:         codes[i] = &lt;np.uint8_t *&gt;np.PyArray_DATA(word.code)</pre>
<pre id='line1152' class='code' style='background-color: #FFFF9f'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_code);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_codes[__pyx_v_i]) = ((__pyx_t_5numpy_uint8_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_5)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1153")'> 1153:         points[i] = &lt;np.uint32_t *&gt;np.PyArray_DATA(word.point)</pre>
<pre id='line1153' class='code' style='background-color: #FFFF9f'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_word, __pyx_n_s_point);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    (__pyx_v_points[__pyx_v_i]) = ((__pyx_t_5numpy_uint32_t *)<span class='py_macro_api'>PyArray_DATA</span>(((PyArrayObject *)__pyx_t_5)));
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1154")'> 1154:         result += 1</pre>
<pre id='line1154' class='code' style='background-color: #FFFFff'>    __pyx_v_result = (__pyx_v_result + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1155")'> 1155:         i += 1</pre>
<pre id='line1155' class='code' style='background-color: #FFFFff'>    __pyx_v_i = (__pyx_v_i + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1156")'> 1156:         if i == MAX_SENTENCE_LEN:</pre>
<pre id='line1156' class='code' style='background-color: #FFFFff'>    __pyx_t_8 = ((__pyx_v_i == 10000) != 0);
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line1157")'> 1157:             break  # TODO: log warning, tally overflow?</pre>
<pre id='line1157' class='code' style='background-color: #FFFFe7'>      goto __pyx_L4_break;
    }
    __pyx_L3_continue:;
  }
  __pyx_L4_break:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1158")'> 1158:     sentence_len = i</pre>
<pre id='line1158' class='code' style='background-color: #FFFFff'>  __pyx_v_sentence_len = __pyx_v_i;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1159")'> 1159: </pre>
<pre id='line1159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1160")'> 1160:     # release GIL &amp; train on the sentence</pre>
<pre id='line1160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1161")'> 1161:     work[0] = 0.0</pre>
<pre id='line1161' class='code' style='background-color: #FFFFff'>  (__pyx_v_work[0]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1162")'> 1162:     with nogil:</pre>
<pre id='line1162' class='code' style='background-color: #FFFFff'>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L9;
        }
        __pyx_L9:;
      }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1163")'> 1163:         for i in range(sentence_len):</pre>
<pre id='line1163' class='code' style='background-color: #FFFFff'>        __pyx_t_2 = __pyx_v_sentence_len;
        for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_2; __pyx_t_11+=1) {
          __pyx_v_i = __pyx_t_11;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1164")'> 1164:             if codelens[i] == 0:</pre>
<pre id='line1164' class='code' style='background-color: #FFFFff'>          __pyx_t_8 = (((__pyx_v_codelens[__pyx_v_i]) == 0) != 0);
          if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1165")'> 1165:                 continue</pre>
<pre id='line1165' class='code' style='background-color: #FFFFff'>            goto __pyx_L10_continue;
          }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1166")'> 1166:             j = i - window</pre>
<pre id='line1166' class='code' style='background-color: #FFFFff'>          __pyx_v_j = (__pyx_v_i - __pyx_v_window);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1167")'> 1167:             if j &lt; 0:</pre>
<pre id='line1167' class='code' style='background-color: #FFFFff'>          __pyx_t_8 = ((__pyx_v_j &lt; 0) != 0);
          if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1168")'> 1168:                 j = 0</pre>
<pre id='line1168' class='code' style='background-color: #FFFFff'>            __pyx_v_j = 0;
            goto __pyx_L13;
          }
          __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1169")'> 1169:             k = i + window + 1</pre>
<pre id='line1169' class='code' style='background-color: #FFFFff'>          __pyx_v_k = ((__pyx_v_i + __pyx_v_window) + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1170")'> 1170:             if k &gt; sentence_len:</pre>
<pre id='line1170' class='code' style='background-color: #FFFFff'>          __pyx_t_8 = ((__pyx_v_k &gt; __pyx_v_sentence_len) != 0);
          if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1171")'> 1171:                 k = sentence_len</pre>
<pre id='line1171' class='code' style='background-color: #FFFFff'>            __pyx_v_k = __pyx_v_sentence_len;
            goto __pyx_L14;
          }
          __pyx_L14:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1172")'> 1172:             score_pair_cbow_hs(points[i], codes[i], codelens, neu1, syn0, syn1, size, indexes, work, i, j, k, cbow_mean)</pre>
<pre id='line1172' class='code' style='background-color: #FFFFff'>          __pyx_f_14word2vec_inner_score_pair_cbow_hs((__pyx_v_points[__pyx_v_i]), (__pyx_v_codes[__pyx_v_i]), __pyx_v_codelens, __pyx_v_neu1, __pyx_v_syn0, __pyx_v_syn1, __pyx_v_size, __pyx_v_indexes, __pyx_v_work, __pyx_v_i, __pyx_v_j, __pyx_v_k, __pyx_v_cbow_mean);
          __pyx_L10_continue:;
        }
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1173")'> 1173: </pre>
<pre id='line1173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line1174")'> 1174:     return work[0]</pre>
<pre id='line1174' class='code' style='background-color: #FFFF9f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_work[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1175")'> 1175: </pre>
<pre id='line1175' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1176")'> 1176: cdef void score_pair_cbow_hs(</pre>
<pre id='line1176' class='code' style='background-color: #FFFFff'>static void __pyx_f_14word2vec_inner_score_pair_cbow_hs(__pyx_t_5numpy_uint32_t const *__pyx_v_word_point, __pyx_t_5numpy_uint8_t const *__pyx_v_word_code, int *__pyx_v_codelens, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_neu1, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn0, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_syn1, int const __pyx_v_size, __pyx_t_5numpy_uint32_t const *__pyx_v_indexes, __pyx_t_14word2vec_inner_REAL_t *__pyx_v_work, int __pyx_v_i, int __pyx_v_j, int __pyx_v_k, int __pyx_v_cbow_mean) {
  PY_LONG_LONG __pyx_v_b;
  PY_LONG_LONG __pyx_v_row2;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_f;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_count;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_inv_count;
  __pyx_t_14word2vec_inner_REAL_t __pyx_v_sgn;
  int __pyx_v_m;
/* … */
  /* function exit code */
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1177")'> 1177:     const np.uint32_t *word_point, const np.uint8_t *word_code, int codelens[MAX_SENTENCE_LEN],</pre>
<pre id='line1177' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1178")'> 1178:     REAL_t *neu1, REAL_t *syn0, REAL_t *syn1, const int size,</pre>
<pre id='line1178' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1179")'> 1179:     const np.uint32_t indexes[MAX_SENTENCE_LEN], REAL_t *work,</pre>
<pre id='line1179' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1180")'> 1180:     int i, int j, int k, int cbow_mean) nogil:</pre>
<pre id='line1180' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1181")'> 1181: </pre>
<pre id='line1181' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1182")'> 1182:     cdef long long a, b</pre>
<pre id='line1182' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1183")'> 1183:     cdef long long row2</pre>
<pre id='line1183' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1184")'> 1184:     cdef REAL_t f, g, count, inv_count, sgn</pre>
<pre id='line1184' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1185")'> 1185:     cdef int m</pre>
<pre id='line1185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1186")'> 1186: </pre>
<pre id='line1186' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1187")'> 1187:     memset(neu1, 0, size * cython.sizeof(REAL_t))</pre>
<pre id='line1187' class='code' style='background-color: #FFFFff'>  memset(__pyx_v_neu1, 0, (__pyx_v_size * (sizeof(__pyx_t_14word2vec_inner_REAL_t))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1188")'> 1188:     count = &lt;REAL_t&gt;0.0</pre>
<pre id='line1188' class='code' style='background-color: #FFFFff'>  __pyx_v_count = ((__pyx_t_14word2vec_inner_REAL_t)0.0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1189")'> 1189:     for m in range(j, k):</pre>
<pre id='line1189' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_k;
  for (__pyx_t_2 = __pyx_v_j; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_m = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1190")'> 1190:         if m == i or codelens[m] == 0:</pre>
<pre id='line1190' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = ((__pyx_v_m == __pyx_v_i) != 0);
    if (!__pyx_t_3) {
      __pyx_t_4 = (((__pyx_v_codelens[__pyx_v_m]) == 0) != 0);
      __pyx_t_5 = __pyx_t_4;
    } else {
      __pyx_t_5 = __pyx_t_3;
    }
    if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1191")'> 1191:             continue</pre>
<pre id='line1191' class='code' style='background-color: #FFFFff'>      goto __pyx_L3_continue;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1192")'> 1192:         else:</pre>
<pre id='line1192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1193")'> 1193:             count += ONEF</pre>
<pre id='line1193' class='code' style='background-color: #FFFFff'>      __pyx_v_count = (__pyx_v_count + __pyx_v_14word2vec_inner_ONEF);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1194")'> 1194:             our_saxpy(&amp;size, &amp;ONEF, &amp;syn0[indexes[m] * size], &amp;ONE, neu1, &amp;ONE)</pre>
<pre id='line1194' class='code' style='background-color: #FFFFff'>      __pyx_v_14word2vec_inner_our_saxpy((&amp;__pyx_v_size), (&amp;__pyx_v_14word2vec_inner_ONEF), (&amp;(__pyx_v_syn0[((__pyx_v_indexes[__pyx_v_m]) * __pyx_v_size)])), (&amp;__pyx_v_14word2vec_inner_ONE), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    }
    __pyx_L3_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1195")'> 1195:     if count &gt; (&lt;REAL_t&gt;0.5):</pre>
<pre id='line1195' class='code' style='background-color: #FFFFff'>  __pyx_t_5 = ((__pyx_v_count &gt; ((__pyx_t_14word2vec_inner_REAL_t)0.5)) != 0);
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1196")'> 1196:         inv_count = ONEF/count</pre>
<pre id='line1196' class='code' style='background-color: #FFFFff'>    __pyx_v_inv_count = (__pyx_v_14word2vec_inner_ONEF / __pyx_v_count);
    goto __pyx_L6;
  }
  __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1197")'> 1197:     if cbow_mean:</pre>
<pre id='line1197' class='code' style='background-color: #FFFFff'>  __pyx_t_5 = (__pyx_v_cbow_mean != 0);
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1198")'> 1198:         sscal(&amp;size, &amp;inv_count, neu1, &amp;ONE)</pre>
<pre id='line1198' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_sscal((&amp;__pyx_v_size), (&amp;__pyx_v_inv_count), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE));
    goto __pyx_L7;
  }
  __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1199")'> 1199: </pre>
<pre id='line1199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1200")'> 1200:     for b in range(codelens[i]):</pre>
<pre id='line1200' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_codelens[__pyx_v_i]);
  for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_1; __pyx_t_6+=1) {
    __pyx_v_b = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1201")'> 1201:         row2 = word_point[b] * size</pre>
<pre id='line1201' class='code' style='background-color: #FFFFff'>    __pyx_v_row2 = ((__pyx_v_word_point[__pyx_v_b]) * __pyx_v_size);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1202")'> 1202:         f = our_dot(&amp;size, neu1, &amp;ONE, &amp;syn1[row2], &amp;ONE)</pre>
<pre id='line1202' class='code' style='background-color: #FFFFff'>    __pyx_v_f = __pyx_v_14word2vec_inner_our_dot((&amp;__pyx_v_size), __pyx_v_neu1, (&amp;__pyx_v_14word2vec_inner_ONE), (&amp;(__pyx_v_syn1[__pyx_v_row2])), (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1203")'> 1203:         sgn = (-1)**word_code[b] # ch function: 0-&gt; 1, 1 -&gt; -1</pre>
<pre id='line1203' class='code' style='background-color: #FFFFff'>    __pyx_v_sgn = __Pyx_pow_long(-1, ((long)(__pyx_v_word_code[__pyx_v_b])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1204")'> 1204:         f = sgn*f</pre>
<pre id='line1204' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_sgn * __pyx_v_f);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1205")'> 1205:         if f &lt;= -MAX_EXP or f &gt;= MAX_EXP:</pre>
<pre id='line1205' class='code' style='background-color: #FFFFff'>    __pyx_t_5 = ((__pyx_v_f &lt;= -6.0) != 0);
    if (!__pyx_t_5) {
      __pyx_t_3 = ((__pyx_v_f &gt;= 6.0) != 0);
      __pyx_t_4 = __pyx_t_3;
    } else {
      __pyx_t_4 = __pyx_t_5;
    }
    if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1206")'> 1206:             continue</pre>
<pre id='line1206' class='code' style='background-color: #FFFFff'>      goto __pyx_L8_continue;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1207")'> 1207:         f = LOG_TABLE[&lt;int&gt;((f + MAX_EXP) * (EXP_TABLE_SIZE / MAX_EXP / 2))]</pre>
<pre id='line1207' class='code' style='background-color: #FFFFff'>    __pyx_v_f = (__pyx_v_14word2vec_inner_LOG_TABLE[((int)((__pyx_v_f + 6.0) * 83.0))]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1208")'> 1208:         work[0] += f</pre>
<pre id='line1208' class='code' style='background-color: #FFFFff'>    __pyx_t_7 = 0;
    (__pyx_v_work[__pyx_t_7]) = ((__pyx_v_work[__pyx_t_7]) + __pyx_v_f);
    __pyx_L8_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1209")'> 1209: </pre>
<pre id='line1209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1210")'> 1210: </pre>
<pre id='line1210' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line1211")'> 1211: def init():</pre>
<pre id='line1211' class='code' style='background-color: #FFFF6e'>/* Python wrapper */
static PyObject *__pyx_pw_14word2vec_inner_15init(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_14word2vec_inner_14init[] = "\n    Precompute function `sigmoid(x) = 1 / (1 + exp(-x))`, for x values discretized\n    into table EXP_TABLE.  Also calculate log(sigmoid(x)) into LOG_TABLE.\n\n    ";
static PyMethodDef __pyx_mdef_14word2vec_inner_15init = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("init"), (PyCFunction)__pyx_pw_14word2vec_inner_15init, METH_NOARGS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_14word2vec_inner_14init)};
static PyObject *__pyx_pw_14word2vec_inner_15init(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("init (wrapper)", 0);
  __pyx_r = __pyx_pf_14word2vec_inner_14init(__pyx_self);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_14word2vec_inner_14init(CYTHON_UNUSED PyObject *__pyx_self) {
  int __pyx_v_i;
  float *__pyx_v_x;
  float *__pyx_v_y;
  float __pyx_v_expected;
  int __pyx_v_size;
  double __pyx_v_d_res;
  float *__pyx_v_p_res;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("init", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__32 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_i, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_expected, __pyx_n_s_size, __pyx_n_s_d_res, __pyx_n_s_p_res);<span class='error_goto'> if (unlikely(!__pyx_tuple__32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__32);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__32);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_14word2vec_inner_15init, NULL, __pyx_n_s_word2vec_inner);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_init, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1212")'> 1212:     """</pre>
<pre id='line1212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1213")'> 1213:     Precompute function `sigmoid(x) = 1 / (1 + exp(-x))`, for x values discretized</pre>
<pre id='line1213' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1214")'> 1214:     into table EXP_TABLE.  Also calculate log(sigmoid(x)) into LOG_TABLE.</pre>
<pre id='line1214' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1215")'> 1215: </pre>
<pre id='line1215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1216")'> 1216:     """</pre>
<pre id='line1216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1217")'> 1217:     global our_dot</pre>
<pre id='line1217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1218")'> 1218:     global our_saxpy</pre>
<pre id='line1218' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1219")'> 1219: </pre>
<pre id='line1219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1220")'> 1220:     cdef int i</pre>
<pre id='line1220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1221")'> 1221:     cdef float *x = [&lt;float&gt;10.0]</pre>
<pre id='line1221' class='code' style='background-color: #FFFFff'>  __pyx_t_1[0] = ((float)10.0);
  __pyx_v_x = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1222")'> 1222:     cdef float *y = [&lt;float&gt;0.01]</pre>
<pre id='line1222' class='code' style='background-color: #FFFFff'>  __pyx_t_2[0] = ((float)0.01);
  __pyx_v_y = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1223")'> 1223:     cdef float expected = &lt;float&gt;0.1</pre>
<pre id='line1223' class='code' style='background-color: #FFFFff'>  __pyx_v_expected = ((float)0.1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1224")'> 1224:     cdef int size = 1</pre>
<pre id='line1224' class='code' style='background-color: #FFFFff'>  __pyx_v_size = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1225")'> 1225:     cdef double d_res</pre>
<pre id='line1225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1226")'> 1226:     cdef float *p_res</pre>
<pre id='line1226' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1227")'> 1227: </pre>
<pre id='line1227' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1228")'> 1228:     # build the sigmoid table</pre>
<pre id='line1228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1229")'> 1229:     for i in range(EXP_TABLE_SIZE):</pre>
<pre id='line1229' class='code' style='background-color: #FFFFff'>  for (__pyx_t_3 = 0; __pyx_t_3 &lt; 1000; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1230")'> 1230:         EXP_TABLE[i] = &lt;REAL_t&gt;exp((i / &lt;REAL_t&gt;EXP_TABLE_SIZE * 2 - 1) * MAX_EXP)</pre>
<pre id='line1230' class='code' style='background-color: #FFFFff'>    (__pyx_v_14word2vec_inner_EXP_TABLE[__pyx_v_i]) = ((__pyx_t_14word2vec_inner_REAL_t)exp(((((__pyx_v_i / ((__pyx_t_14word2vec_inner_REAL_t)1000)) * 2.0) - 1.0) * 6.0)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1231")'> 1231:         EXP_TABLE[i] = &lt;REAL_t&gt;(EXP_TABLE[i] / (EXP_TABLE[i] + 1))</pre>
<pre id='line1231' class='code' style='background-color: #FFFFff'>    (__pyx_v_14word2vec_inner_EXP_TABLE[__pyx_v_i]) = ((__pyx_t_14word2vec_inner_REAL_t)((__pyx_v_14word2vec_inner_EXP_TABLE[__pyx_v_i]) / ((__pyx_v_14word2vec_inner_EXP_TABLE[__pyx_v_i]) + 1.0)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1232")'> 1232:         LOG_TABLE[i] = &lt;REAL_t&gt;log( EXP_TABLE[i] )</pre>
<pre id='line1232' class='code' style='background-color: #FFFFff'>    (__pyx_v_14word2vec_inner_LOG_TABLE[__pyx_v_i]) = ((__pyx_t_14word2vec_inner_REAL_t)log((__pyx_v_14word2vec_inner_EXP_TABLE[__pyx_v_i])));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1233")'> 1233: </pre>
<pre id='line1233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1234")'> 1234:     # check whether sdot returns double or float</pre>
<pre id='line1234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1235")'> 1235:     d_res = dsdot(&amp;size, x, &amp;ONE, y, &amp;ONE)</pre>
<pre id='line1235' class='code' style='background-color: #FFFFff'>  __pyx_v_d_res = __pyx_v_14word2vec_inner_dsdot((&amp;__pyx_v_size), __pyx_v_x, (&amp;__pyx_v_14word2vec_inner_ONE), __pyx_v_y, (&amp;__pyx_v_14word2vec_inner_ONE));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1236")'> 1236:     p_res = &lt;float *&gt;&amp;d_res</pre>
<pre id='line1236' class='code' style='background-color: #FFFFff'>  __pyx_v_p_res = ((float *)(&amp;__pyx_v_d_res));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1237")'> 1237:     if (abs(d_res - expected) &lt; 0.0001):</pre>
<pre id='line1237' class='code' style='background-color: #FFFFff'>  __pyx_t_4 = ((fabs((__pyx_v_d_res - __pyx_v_expected)) &lt; 0.0001) != 0);
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1238")'> 1238:         our_dot = our_dot_double</pre>
<pre id='line1238' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_dot = __pyx_f_14word2vec_inner_our_dot_double;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1239")'> 1239:         our_saxpy = saxpy</pre>
<pre id='line1239' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy = __pyx_v_14word2vec_inner_saxpy;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1240")'> 1240:         return 0  # double</pre>
<pre id='line1240' class='code' style='background-color: #FFFFd4'>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
    __pyx_r = __pyx_int_0;
    goto __pyx_L0;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1241")'> 1241:     elif (abs(p_res[0] - expected) &lt; 0.0001):</pre>
<pre id='line1241' class='code' style='background-color: #FFFFff'>  __pyx_t_4 = ((fabsf(((__pyx_v_p_res[0]) - __pyx_v_expected)) &lt; 0.0001) != 0);
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1242")'> 1242:         our_dot = our_dot_float</pre>
<pre id='line1242' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_dot = __pyx_f_14word2vec_inner_our_dot_float;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1243")'> 1243:         our_saxpy = saxpy</pre>
<pre id='line1243' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy = __pyx_v_14word2vec_inner_saxpy;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1244")'> 1244:         return 1  # float</pre>
<pre id='line1244' class='code' style='background-color: #FFFFd4'>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
    __pyx_r = __pyx_int_1;
    goto __pyx_L0;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1245")'> 1245:     else:</pre>
<pre id='line1245' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1246")'> 1246:         # neither =&gt; use cython loops, no BLAS</pre>
<pre id='line1246' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1247")'> 1247:         # actually, the BLAS is so messed up we'll probably have segfaulted above and never even reach here</pre>
<pre id='line1247' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1248")'> 1248:         our_dot = our_dot_noblas</pre>
<pre id='line1248' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_dot = __pyx_f_14word2vec_inner_our_dot_noblas;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1249")'> 1249:         our_saxpy = our_saxpy_noblas</pre>
<pre id='line1249' class='code' style='background-color: #FFFFff'>    __pyx_v_14word2vec_inner_our_saxpy = __pyx_f_14word2vec_inner_our_saxpy_noblas;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line1250")'> 1250:         return 2</pre>
<pre id='line1250' class='code' style='background-color: #FFFFd4'>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
    __pyx_r = __pyx_int_2;
    goto __pyx_L0;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line1251")'> 1251: </pre>
<pre id='line1251' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1252")'> 1252: FAST_VERSION = init()  # initialize the module</pre>
<pre id='line1252' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_init);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_FAST_VERSION, __pyx_t_7) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line1253")'> 1253: MAX_WORDS_IN_BATCH = MAX_SENTENCE_LEN</pre>
<pre id='line1253' class='code' style='background-color: #FFFFaa'>  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_MAX_WORDS_IN_BATCH, __pyx_int_10000) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre></body></html>
